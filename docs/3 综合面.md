# ç›®å½•
* æ¡†æ¶ (ä¸»React, å‰¯Vue)
* è®¾è®¡æ¨¡å¼ (è§‚å¯Ÿè€…æ¨¡å¼ã€ç­–ç•¥æ¨¡å¼ç­‰)
* å·¥ç¨‹åŒ– (Webpack, Git)
* æ€§èƒ½ä¼˜åŒ–
* æœåŠ¡ç«¯ (Node.js)

============================================== fè®¾è®¡æ¨¡å¼ ==============================================
# å¹³æ—¶å·¥ä½œä¸­æœ‰ç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ
TODO: 
1.å•ä¾‹æ¨¡å¼ ç»§å“¥å†™çš„åŸºç¡€åº“ï¼Ÿ reduxçš„store
2.è§‚å¯Ÿè€…æ¨¡å¼ reduxçš„subscribeå’Œdispatch (å¦‚æœé¢è¯•å®˜è¦æ±‚ä¸¾å‡ºæ›´å¤šä¾‹å­ï¼Œå†è®² Vueçš„Watcherè®¢é˜…å’ŒDataå‘å¸ƒ)

# få•ä¾‹æ¨¡å¼
å•ä¾‹æ¨¡å¼å³ä¸€ä¸ªç±»åªèƒ½æ„é€ å‡ºå”¯ä¸€çš„å®ä¾‹ï¼Œå•ä¾‹æ¨¡å¼çš„æ„ä¹‰åœ¨äºå…±äº«ã€å”¯ä¸€ã€‚
## ä¾‹å­
Redux çš„ storeã€‚ (å¦‚æœé¢è¯•å®˜è¦æ±‚ä¸¾å‡ºæ›´å¤šä¾‹å­ï¼Œå†è®² Vuexçš„store, JQçš„$, ä¸šåŠ¡åœºæ™¯çš„è´­ç‰©è½¦ğŸ›’ç­‰)
## ä»£ç 
```js
class Singleton {
  constructor(name) {
    this.name = name;
  }
  static getInstance(name) {
    if (!this.instance) {
      this.instance = new Singleton(name);
    }
    return this.instance;
  }
}
const instance1 = Singleton.getInstance('name1');
const instance2 = Singleton.getInstance('name2');
console.log(instance1 === instance2);  // trueï¼Œåªæœ‰ä¸€ä¸ªå®ä¾‹
console.log(instance1.name);  // name1
console.log(instance2.name);  // ä¾ç„¶æ˜¯ name1
```

# å·¥å‚æ¨¡å¼
å·¥å‚æ¨¡å¼å³å¯¹åˆ›å»ºå¯¹è±¡é€»è¾‘çš„å°è£…ï¼Œæˆ–è€…å¯ä»¥ç®€å•ç†è§£ä¸ºå¯¹newçš„å°è£…ï¼Œè¿™ç§å°è£…å°±åƒåˆ›å»ºå¯¹è±¡çš„å·¥å‚ï¼Œæ•…åå·¥å‚æ¨¡å¼ã€‚
## ä¾‹å­
å·¥å‚æ¨¡å¼å¸¸è§äºå¤§å‹é¡¹ç›®ï¼Œæ¯”å¦‚JQçš„$å¯¹è±¡ï¼Œæˆ‘ä»¬åˆ›å»ºé€‰æ‹©å™¨å¯¹è±¡æ—¶ä¹‹æ‰€ä»¥æ²¡æœ‰new selectorå°±æ˜¯å› ä¸º$()å·²ç»æ˜¯ä¸€ä¸ªå·¥å‚æ–¹æ³•ï¼Œå…¶ä»–ä¾‹å­ä¾‹å¦‚React.createElement()ã€Vue.component()éƒ½æ˜¯å·¥å‚æ¨¡å¼çš„å®ç°ã€‚
## ä»£ç 
```js
class User {
  constructor(name, auth) {
    this.name = name;
    this.auth = auth;
  }
}
class UserFactory {
  static createUser(name, auth) {
    // å·¥å‚å†…éƒ¨å°è£…äº†åˆ›å»ºå¯¹è±¡çš„é€»è¾‘ã€‚
    // ä½¿ç”¨è€…åœ¨å¤–éƒ¨åˆ›å»ºå¯¹è±¡æ—¶,ä¸éœ€è¦çŸ¥é“å„ä¸ªæƒé™å¯¹åº”å“ªä¸ªå­—æ®µ, ä¸éœ€è¦çŸ¥é“èµ‹æƒçš„é€»è¾‘ï¼Œåªéœ€è¦çŸ¥é“åˆ›å»ºäº†ä¸€ä¸ªç®¡ç†å‘˜å’Œä¸€ä¸ªæ™®é€šç”¨æˆ·ã€‚
    if (auth === 'admin') {
      return new User(name, 1);
    }
    if (auth === 'user') {
      return new User(name, 2);
    }
  }
}
const admin = UserFactory.createUser('boss', 'admin');
const user = UserFactory.createUser('mike', 'user');
```

# è§‚å¯Ÿè€…æ¨¡å¼
è§‚å¯Ÿè€…ç›‘å¬è¢«è§‚å¯Ÿè€…çš„å˜åŒ–ï¼Œè¢«è§‚å¯Ÿè€…å‘ç”Ÿæ”¹å˜æ—¶ï¼Œé€šçŸ¥æ‰€æœ‰çš„è§‚å¯Ÿè€…ã€‚
## ä¾‹å­
Reduxçš„subscribeå’Œdispatchã€‚
## ä»£ç 
```js
// è§‚å¯Ÿè€…
class Observer {
  constructor(fn) {
    this.update = fn;
  }
}
// è¢«è§‚å¯Ÿè€…
class Subject {
  constructor() {
    this.observers = [];
  }
  register(ob) {
    this.observers.push(ob);
  }
  notify() {
    this.observers.forEach((ob) => {
      ob.update();
    })
  }
}
const ob1 = new Observer(() => console.log('ob1 update!'));
const ob2 = new Observer(() => console.log('ob2 update!'));
const ob3 = new Observer(() => console.log('ob3 update!'));
const subject = new Subject();
subject.register(ob1);
subject.register(ob2);
subject.register(ob3);
subject.notify();
```

# fè£…é¥°å™¨æ¨¡å¼
è£…é¥°å™¨æ¨¡å¼ï¼Œå¯ä»¥ç†è§£ä¸ºå¯¹ç±»çš„ä¸€ä¸ªåŒ…è£…ï¼ŒåŠ¨æ€åœ°æ‹“å±•ç±»çš„åŠŸèƒ½ï¼ŒES7çš„è£…é¥°å™¨è¯­æ³•ä»¥åŠReactä¸­çš„é«˜é˜¶ç»„ä»¶ï¼ˆHOCï¼‰éƒ½æ˜¯è¿™ä¸€æ¨¡å¼çš„å®ç°ã€‚
## ä»£ç 
```js
// ES7çš„è£…é¥°å™¨
function Info(target) {
  target.prototype.name = 'mike';
}

@Info
class Man {}

const man = new Man();
console.log(man.name);  // info
```

# fé€‚é…å™¨æ¨¡å¼
é€‚é…å™¨æ¨¡å¼ï¼Œå°†ä¸€ä¸ªæ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦ä¸€ä¸ªæ¥å£ï¼Œä½¿æ¥å£ä¸å…¼å®¹çš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚æˆ‘ä»¬åœ¨ç”Ÿæ´»ä¸­å°±å¸¸å¸¸æœ‰ä½¿ç”¨é€‚é…å™¨çš„åœºæ™¯ï¼Œä¾‹å¦‚å‡ºå¢ƒæ—…æ¸¸æ’å¤´æ’åº§ä¸åŒ¹é…ï¼Œè¿™æ—¶æˆ‘ä»¬å°±éœ€è¦ä½¿ç”¨è½¬æ¢æ’å¤´ï¼Œä¹Ÿå°±æ˜¯é€‚é…å™¨æ¥å¸®æˆ‘ä»¬è§£å†³é—®é¢˜ã€‚
## ä»£ç 
```js
class Adaptee {
  test() {
      return 'æ—§æ¥å£';
  }
}
class Target {
  constructor() {
      this.adaptee = new Adaptee()
  }
  test() {
      const info = this.adaptee.test()
      return `é€‚é…${info}`;
  }
}
const target = new Target()
console.log(target.test());
```

# fä»£ç†æ¨¡å¼
ä»£ç†æ¨¡å¼ï¼Œä¸ºä¸€ä¸ªå¯¹è±¡æ‰¾ä¸€ä¸ªæ›¿ä»£å¯¹è±¡ï¼Œä»¥ä¾¿å¯¹åŸå¯¹è±¡è¿›è¡Œè®¿é—®ã€‚å³åœ¨è®¿é—®è€…ä¸ç›®æ ‡å¯¹è±¡ä¹‹é—´åŠ ä¸€å±‚ä»£ç†ï¼Œé€šè¿‡ä»£ç†åšæˆæƒå’Œæ§åˆ¶ã€‚
## ä¾‹å­
æœ€å¸¸è§çš„ä¾‹å­æ˜¯ç»çºªäººä»£ç†æ˜æ˜Ÿä¸šåŠ¡ï¼Œå‡è®¾ä½ ä½œä¸ºä¸€ä¸ªæŠ•èµ„è€…ï¼Œæƒ³è”ç³»æ˜æ˜Ÿæ‰“å¹¿å‘Šï¼Œé‚£ä¹ˆä½ å°±éœ€è¦å…ˆç»è¿‡ä»£ç†ç»çºªäººï¼Œç»çºªäººå¯¹ä½ çš„èµ„è´¨è¿›è¡Œè€ƒå¯Ÿï¼Œå¹¶é€šçŸ¥ä½ æ˜æ˜Ÿæ’æœŸï¼Œæ›¿æ˜æ˜Ÿæœ¬äººè¿‡æ»¤ä¸å¿…è¦çš„ä¿¡æ¯ã€‚äº‹ä»¶ä»£ç†ã€JQueryçš„$.proxyã€ES6çš„proxyéƒ½æ˜¯è¿™ä¸€æ¨¡å¼çš„å®ç°ã€‚
## ä»£ç 
```js
const idol = {
  name: 'mike',
  phone: 10086,
  price: 1000000
}
const agent = new Proxy(idol, {
  get: function(target) {
    //æ‹¦æˆªæ˜æ˜Ÿç”µè¯çš„è¯·æ±‚,åªæä¾›ç»çºªäººç”µè¯
    return 'ç»çºªäººç”µè¯:10010'
  },
  set: function(target, key, value) {
    if(key === 'price' ) {
      //ç»çºªäººè¿‡æ»¤èµ„è´¨
      if(value < target.price) throw new Error('æŠ¥ä»·è¿‡ä½')
      target.price = value
    }
  }
})
agent.phone        //ç»çºªäººç”µè¯:10010
agent.price = 100  //Uncaught Error: æŠ¥ä»·è¿‡ä½
```


============================================== få·¥ç¨‹åŒ– ================================================
# fGit
Gitæ˜¯ä¸€ä¸ªå…è´¹çš„ã€å¼€æºçš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œæ—¨åœ¨ä»¥å¿«é€Ÿé«˜æ•ˆçš„æ–¹å¼å¤„ç†ä»å°å‹åˆ°å¤§å‹çš„æ‰€æœ‰é¡¹ç›®ã€‚
Gitæ˜“äºå­¦ä¹ ã€å ç”¨ç©ºé—´å°ã€æ€§èƒ½æå¿«ã€‚å®ƒå…·æœ‰æ–¹ä¾¿çš„å·¥ä½œåŒºã€æš‚å­˜åŒºã€æœ¬åœ°åº“å’Œå¤šä¸ªå·¥ä½œæµåˆ†æ”¯ç­‰ç‰¹æ€§ã€‚

## æ¶æ„
è¿œç¨‹åº“
â¬†ï¸git push(æ¨é€ç»™è¿œç¨‹), â¬‡ï¸git pull(æ‹‰å–æ›´æ–°), â¬‡ï¸git clone(åˆå§‹åŒ–åˆ°æœ¬åœ°), â¬‡ï¸git remote add <è¿œç¨‹åˆ«å>ï¼ˆå¦‚ originï¼‰ <è¿œç¨‹é“¾æ¥>(æœ¬åœ°å·²ç»æœ‰é¡¹ç›®ï¼Œæ·»åŠ ä¸€ä¸ªè¿œç¨‹åº“)
æœ¬åœ°åº“
â¬†ï¸git commit(æäº¤ï¼Œç”Ÿæˆä¸€ä¸ªå†å²ç‰ˆæœ¬), â¬‡ï¸git branch <åˆ†æ”¯å>(å¢åŠ åˆ†æ”¯), â¬‡ï¸git checkout (åˆ‡æ¢åˆ†æ”¯), â¬‡ï¸git log/git reflog(æŸ¥çœ‹æäº¤æ—¥å¿—)
æš‚å­˜åŒº
â¬†ï¸git add(æ·»åŠ åˆ°æš‚å­˜åŒº), â¬‡ï¸git restore --stage <file>(å–æ¶ˆæ·»åŠ )
å·¥ä½œåŒº   

## æœ¬åœ°åº“ç»“æ„
-------- commit1 ----------- commit2 -------- commit3  ---------------- commit 4 -----------------------   åˆ†æ”¯ä¸€
            |                                                                      | åˆå¹¶ç»™åˆ†æ”¯ä¸€
            -------- commit1 --------------------------------   åˆ†æ”¯äºŒ              |
                              |                                                    | åˆ†æ”¯ä¸‰å¯ä»¥ç»§ç»­èµ°ï¼Œæ— å½±å“
                              ------- commit 1 ------------------------------------|-------- åˆ†æ”¯ä¸‰ 

### åˆ†æ”¯
å¤šä¸ªåˆ†æ”¯æ˜¯æœ¬åœ°åº“ä¸­çš„å¤šä¸ªå·¥ä½œæµï¼Œæ¯ä¸ªåˆ†æ”¯ç‹¬ç«‹ç®¡ç†è‡ªå·±çš„æäº¤å†å²ã€‚

å½“å‰æ‰€åœ¨çš„åˆ†æ”¯ï¼Œæ˜¯ç”± HEAD å†³å®šçš„ã€‚
master,hot-fix è¿™ä¸¤ä¸ªåˆ†æ”¯å…¶å®æ˜¯ä¸¤ä¸ªæŒ‡é’ˆï¼ŒHEAD æŒ‡å‘è°ï¼Œè°å°±æ˜¯å½“å‰åˆ†æ”¯ï¼Œåˆ‡æ¢åˆ†æ”¯çš„æœ¬è´¨å°±æ˜¯æ”¹å˜ HEAD æŒ‡å‘ã€‚

#### ä¾‹å­
ä¸¤ä¸ªåˆ†æ”¯ï¼Œæ¯ä¸ªåˆ†æ”¯æœ‰ç‹¬ç«‹çš„æäº¤å†å²:
first ---- second  ---- third --- fourth ----- fifth  [master]   
                          |
                        third --------- fourth        [hot-fix]   <= HEAD (å½“å‰åˆ†æ”¯æ˜¯ hot-fix)
 
#### ä¼˜ç‚¹
åŒæ—¶å¹¶è¡Œæ¨è¿›å¤šä¸ªåŠŸèƒ½å¼€å‘ï¼Œæé«˜å¼€å‘æ•ˆç‡ã€‚
å„ä¸ªåˆ†æ”¯åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœæŸä¸€ä¸ªåˆ†æ”¯å¼€å‘å¤±è´¥ï¼Œä¸ä¼šå¯¹å…¶ä»–åˆ†æ”¯é€ æˆå½±å“ã€‚å¤±è´¥çš„åˆ†æ”¯åˆ é™¤äº†ï¼Œé‡æ–°å¼€å§‹å³å¯ã€‚

git branch <åˆ†æ”¯å>: å¢åŠ åˆ†æ”¯
git branch: æŸ¥çœ‹æœ¬åœ°åº“çš„åˆ†æ”¯ï¼Œä»¥åŠå½“å‰å¤„åœ¨å“ªä¸ªåˆ†æ”¯ä¸Š
git checkout <åˆ†æ”¯å>: åˆ‡æ¢åˆ†æ”¯  (æ”¹å˜HEADæŒ‡å‘)
git reflog: æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯çš„æäº¤å†å²

#### åˆå¹¶å†²çªçš„åˆ†æ”¯
åœ¨å½“å‰åˆ†æ”¯ä¸‹ï¼Œåˆå¹¶å…¶ä»–åˆ†æ”¯çš„ä¿®æ”¹ã€‚(æ³¨æ„åˆå¹¶åªä¼šå½±å“å½“å‰åˆ†æ”¯çš„å†…å®¹ï¼Œå¯¹å…¶ä»–åˆ†æ”¯æ¯«æ— å½±å“)

##### èƒŒæ™¯
åˆå¹¶åˆ†æ”¯æ—¶ï¼Œä¸¤ä¸ªåˆ†æ”¯åœ¨åŒä¸€ä¸ªæ–‡ä»¶çš„åŒä¸€ä¸ªä½ç½®æœ‰ä¸¤å¥—å®Œå…¨ä¸åŒçš„ä¿®æ”¹ï¼ŒGitæ— æ³•å¸®æˆ‘ä»¬ä½œå‡ºå†³å®šï¼Œè¿™æ—¶å°±æœ‰å†²çªã€‚
å†²çªå‘ç”Ÿæ—¶ï¼Œéœ€è¦äººä¸ºå†³å®šæ–°ä»£ç çš„å†…å®¹ã€‚

#### æ­¥éª¤
1. æ‰§è¡Œåˆå¹¶
git merge <å…¶ä»–åˆ†æ”¯>

```shell
Auto-merging test.md  // æ­£åœ¨è‡ªåŠ¨åˆå¹¶ test.md...
CONFLICT (content): Merge conflict in test.md   // test.md é‡Œæœ‰åˆå¹¶å†²çª
Automatic merge failed; fix conflicts and then commit the result.   // è‡ªåŠ¨åˆå¹¶å¤±è´¥
```

2. vim test.md æŸ¥çœ‹å†²çªæ–‡ä»¶
<<<HEAD
<å½“å‰åˆ†æ”¯çš„ä»£ç >
======
<è¦åˆå¹¶è¿›æ¥çš„åˆ†æ”¯çš„ä»£ç >
>>>>> hot-fix

3. æ‰‹åŠ¨ä¿®æ”¹
ä¿®æ”¹`<<<HEAD`å’Œ`======`ä¸­é—´çš„å†…å®¹ï¼Œç•™ä¸‹ä½ è¦çš„éƒ¨åˆ†ï¼Œç„¶åæŠŠåˆ†å‰²çº¿åˆ æ‰ã€‚

4. ä¿å­˜
wq, git add, git commit, å®Œæˆä»¥åï¼Œ`å…¶ä»–åˆ†æ”¯`çš„ä¿®æ”¹å°±åˆå¹¶åˆ°`æœ¬åˆ†æ”¯`äº†ã€‚


## åˆ†æ”¯å†…ç‰ˆæœ¬ç©¿æ¢­ (å›åˆ°æŸä¸€ä¸ªæäº¤å†å²)  fç‰ˆæœ¬ç©¿æ¢­
å›åˆ°æŸä¸€ä¸ªæäº¤å†å²ï¼Œä½œå‡ºä¿®æ”¹åï¼Œå†æäº¤åˆ°æœ€æ–°ä¿®æ”¹çš„åé¢ã€‚ å®ç°å›åˆ°è¿‡å»ï¼Œé€†è½¬ç°åœ¨!

first ---- second  ---- third --- fourth ----- fifth                å½“å‰åœ¨ fifth æäº¤
                                              [master]

first ---- second  ---- third --- fourth ----- fifth                å›åˆ° third æäº¤
                      [master]       

first ---- second  ---- third --- fourth ----- fifth ---- sixth     åŸºäº third ä¿®æ”¹ï¼Œæäº¤ sixth
                                                        [master]                
### å‘½ä»¤
git reset --hard [commitCode]


## git frebase vs git fmerge
git rebase:  æ‰¾åˆ°å½“å‰åˆ†æ”¯å’Œç›®æ ‡åˆ†æ”¯çš„äº¤å‰ç‚¹ï¼Œäº¤å‰ç‚¹åˆ°å½“å‰åˆ†æ”¯å°¾çš„éƒ¨åˆ†æ‹†å‡ºæ¥ï¼Œåˆåˆ°ç›®æ ‡åˆ†æ”¯çš„æœ«å°¾ï¼Œä¹Ÿå°±æ˜¯åˆæˆä¸€æ¡ commit çº¿ã€‚
git merge: æ–°å»ºä¸€ä¸ª commit ç»“ç‚¹ï¼Œä¸¤ä¸ªåˆ†æ”¯æœ«å°¾éƒ½æŒ‡å‘è¿™ä¸ªæ–°çš„ commit ç»“ç‚¹ã€‚

 

# fRedux fredux
Redux æ˜¯ JavaScript çŠ¶æ€å®¹å™¨ï¼Œæä¾›å¯é¢„æµ‹åŒ–çš„çŠ¶æ€ç®¡ç†ã€‚ 

Redux å¯ä»¥ç”¨è¿™ä¸‰ä¸ªåŸºæœ¬åŸåˆ™æ¥æè¿°:
1. å•ä¸€æ•°æ®æº
æ•´ä¸ªåº”ç”¨çš„ state è¢«å‚¨å­˜åœ¨ä¸€æ£µ object tree ä¸­ï¼Œå¹¶ä¸”è¿™ä¸ª object tree åªå­˜åœ¨äºå”¯ä¸€ä¸€ä¸ª store ä¸­ã€‚
è¿™è®©åŒæ„åº”ç”¨å¼€å‘å˜å¾—éå¸¸å®¹æ˜“ã€‚æ¥è‡ªæœåŠ¡ç«¯çš„ state å¯ä»¥åœ¨æ— éœ€ç¼–å†™æ›´å¤šä»£ç çš„æƒ…å†µä¸‹è¢«åºåˆ—åŒ–å¹¶æ³¨å…¥åˆ°å®¢æˆ·ç«¯ä¸­ã€‚ç”±äºæ˜¯å•ä¸€çš„ state tree ï¼Œè°ƒè¯•ä¹Ÿå˜å¾—éå¸¸å®¹æ˜“ã€‚åœ¨å¼€å‘ä¸­ï¼Œä½ å¯ä»¥æŠŠåº”ç”¨çš„ state ä¿å­˜åœ¨æœ¬åœ°ï¼Œä»è€ŒåŠ å¿«å¼€å‘é€Ÿåº¦ã€‚æ­¤å¤–ï¼Œå—ç›Šäºå•ä¸€çš„ state tree ï¼Œä»¥å‰éš¾ä»¥å®ç°çš„å¦‚â€œæ’¤é”€/é‡åšâ€è¿™ç±»åŠŸèƒ½ä¹Ÿå˜å¾—è½»è€Œæ˜“ä¸¾ã€‚

2. State æ˜¯åªè¯»çš„
å”¯ä¸€æ”¹å˜ state çš„æ–¹æ³•å°±æ˜¯è§¦å‘ actionï¼Œaction æ˜¯ä¸€ä¸ªç”¨äºæè¿°å·²å‘ç”Ÿäº‹ä»¶çš„æ™®é€šå¯¹è±¡ã€‚
è¿™æ ·ç¡®ä¿äº†è§†å›¾å’Œç½‘ç»œè¯·æ±‚éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹ stateï¼Œç›¸åå®ƒä»¬åªèƒ½è¡¨è¾¾æƒ³è¦ä¿®æ”¹çš„æ„å›¾ã€‚å› ä¸ºæ‰€æœ‰çš„ä¿®æ”¹éƒ½è¢«é›†ä¸­åŒ–å¤„ç†ï¼Œä¸”ä¸¥æ ¼æŒ‰ç…§ä¸€ä¸ªæ¥ä¸€ä¸ªçš„é¡ºåºæ‰§è¡Œï¼Œå› æ­¤ä¸ç”¨æ‹…å¿ƒ race condition çš„å‡ºç°ã€‚ Action å°±æ˜¯æ™®é€šå¯¹è±¡è€Œå·²ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥è¢«æ—¥å¿—æ‰“å°ã€åºåˆ—åŒ–ã€å‚¨å­˜ã€åæœŸè°ƒè¯•æˆ–æµ‹è¯•æ—¶å›æ”¾å‡ºæ¥ã€‚

3. ä½¿ç”¨çº¯å‡½æ•°æ¥æ‰§è¡Œä¿®æ”¹
ä¸ºäº†æè¿° action å¦‚ä½•æ”¹å˜ state tree ï¼Œä½ éœ€è¦ç¼–å†™ reducersã€‚
Reducer åªæ˜¯ä¸€äº›çº¯å‡½æ•°ï¼Œå®ƒæ¥æ”¶å…ˆå‰çš„ state å’Œ actionï¼Œå¹¶è¿”å›æ–°çš„ stateã€‚åˆšå¼€å§‹ä½ å¯ä»¥åªæœ‰ä¸€ä¸ª reducerï¼Œéšç€åº”ç”¨å˜å¤§ï¼Œä½ å¯ä»¥æŠŠå®ƒæ‹†æˆå¤šä¸ªå°çš„ reducersï¼Œåˆ†åˆ«ç‹¬ç«‹åœ°æ“ä½œ state tree çš„ä¸åŒéƒ¨åˆ†ï¼Œå› ä¸º reducer åªæ˜¯å‡½æ•°ï¼Œä½ å¯ä»¥æ§åˆ¶å®ƒä»¬è¢«è°ƒç”¨çš„é¡ºåºï¼Œä¼ å…¥é™„åŠ æ•°æ®ï¼Œç”šè‡³ç¼–å†™å¯å¤ç”¨çš„ reducer æ¥å¤„ç†ä¸€äº›é€šç”¨ä»»åŠ¡ï¼Œå¦‚åˆ†é¡µå™¨ã€‚

## æ‰‹å†™æºç 
https://github.com/ronnycyy/state-manager/tree/main/redux

### fcreateStore.js
è§‚å¯Ÿè€…æ¨¡å¼: è®¢é˜…ã€å–æ¶ˆè®¢é˜…ã€å‘å¸ƒã€‚
```js
export default function createStore(reducer, initState, rewriteCreateStoreFunction) {
  if (rewriteCreateStoreFunction) {
    const newCreateStore = rewriteCreateStoreFunction(createStore);
    return newCreateStore(reducer, initState);
  }

  let state = initState;
  let listeners = [];

  function subscribe(listener) {
    // è®¢é˜…
    listeners.push(listener);
    // å–æ¶ˆè®¢é˜…
    return function unsubscribe(listener) {
      const index = listeners.indexOf(listener);
      listeners.splice(index, 1);
    }
  }

  function getState() {
    return state;
  }

  function dispatch(action) {
    // é€šçŸ¥ç”¨æˆ·å®šä¹‰çš„ reducer å¾—åˆ°æ–°çš„çŠ¶æ€
    state = reducer(state, action);
    // å‘å¸ƒ 
    // æ— è®ºå“ªä¸ªå°çŠ¶æ€å˜åŒ–ï¼Œéƒ½å°†å…¨é‡é€šçŸ¥
    for (let i = 0, len = listeners.length; i < len; i++) {
      const listener = listeners[i];
      listener();
    }
  }

  // æ‰§è¡Œæ‰€æœ‰çš„ reducerï¼Œä½¿å¾— `ä»¥reducerä¸ºkeyçš„æ¯ä¸ªstore`ï¼Œåœ¨æ€»çŠ¶æ€é‡Œåˆå§‹åŒ–ã€‚
  // ä½¿ç”¨ symbol é¿å…å’Œç”¨æˆ·çš„ action.type é‡å
  dispatch({ type: Symbol('__init_store__') });
  /**
   * å®ç°ä¸€ä¸ª Symbol?
   * 
   * function MySymbol(name) {
   *    const obj = Object.create({
   *      toString: function() {
   *         return name;
   *      }
   *    })
   *    return obj;
   * }
   */

  function replaceReducer(nextReducer) {
    reducer = nextReducer;
    dispatch({ type: Symbol('__init_store__') });
  }

  return {
    subscribe,
    getState,
    dispatch,
    replaceReducer,
  }
}
```




### fcombineReducer.js
ç»„åˆç”¨æˆ·æ‰€æœ‰çš„ reducerï¼Œæ¯ä¸ª reducer ç»´æŠ¤è‡ªå·±çš„é‚£ä»½ state (totalState[key])ï¼Œä½†æ˜¯æ¯æ¬¡æ›´æ–°éƒ½ä¼šåˆ›å»ºä¸€ä¸ªå…¨ä½“çš„æ–°çš„ state è¿”å›ã€‚
å¦‚æœç¡®å®æ²¡æœ‰å˜æ›´ï¼Œ(éå¸¸å°‘è§ï¼Œæ¯”å¦‚å‘äº†ä¸€ä¸ªæ‰€æœ‰ reducer éƒ½ä¸å—ç†çš„ action)ï¼Œæ‰ä¼šè¿”å›ä¹‹å‰çš„ state å¼•ç”¨ã€‚
```js
export default function combineReducers(reducers) {
  const reducerKeys = Object.keys(reducers);

  // æœ€ååˆå¹¶å¥½çš„ reducer
  return function combine(state = {}, action) {
    // æ‰€æœ‰çš„ action, éƒ½æ˜¯æ‰§è¡Œè¿™ä¸ª combine å‡½æ•°ï¼Œæ”¹å˜è‡ªå·±çš„ state (state[key])ï¼Œè¿”å›æ•´ä½“çš„ state ä¸­ï¼Œæœ€åæ”¹å˜æ•´ä½“çš„ state (å¼•ç”¨)ã€‚
    const nextState = {}
    // éå†æ‰€æœ‰ reducer
    for (let i = 0; i < reducerKeys.length; i++) {
      const key = reducerKeys[i];
      const reducer = reducers[key];  // counterReducer, infoReducer
      // æŸä¸ª reducer çš„æ—§åº“
      const prevStateForKey = state[key];
      // æ‰§è¡ŒåŠ¨ä½œï¼ŒçŠ¶æ€æ”¹å˜ï¼Œå¾—åˆ°è¯¥ reducer çš„æ–°åº“
      const nextStateForKey = reducer(prevStateForKey, action);
      // reducerçš„keyå’Œstateçš„keyè¦ä¿æŒä¸€è‡´
      // è¯¥ reducer çš„ä¿å­˜åˆ°ä¸€ä»½æ–°çš„æ€»çŠ¶æ€é‡Œ
      nextState[key] = nextStateForKey;
    }
    return nextState;
  }
}
```


### fapplyMiddleware.js  fä¸­é—´ä»¶åŸç† (ä¸­é—´ä»¶ä»¬æŠŠstore.dipatchä½œä¸º`ğŸ§…çš„æœ€å†…æ ¸`åŒ…è£¹èµ·æ¥)
reduxçš„ä¸­é—´ä»¶åŸç†æ˜¯:
1. å…ˆæŠŠ store ä¼ å…¥æ¯ä¸€ä¸ªä¸­é—´ä»¶ï¼Œå®ƒä»¬éƒ½è¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°æ¥å—ä¸€ä¸ªnextå‡½æ•°ï¼Œè¿”å›å¦ä¸€ä¸ªå‡½æ•°ï¼Œå¦‚ `(next) => (action) => {...}`
2. æŠŠè¿™äº›å‡½æ•°é€šè¿‡ compose ç»„åˆèµ·æ¥ï¼Œå¾—åˆ°ä¸€ä¸ªæ€»ä½“çš„å‡½æ•°ï¼Œä¹Ÿæ˜¯æ¥å—ä¸€ä¸ªnextå‡½æ•°ï¼Œè¿”å›å¦ä¸€ä¸ªå‡½æ•°: `(next) => ex(time(log(next)))`
3. æŠŠ `store.dispatch` ä½œä¸º `next` å‚æ•°ï¼Œä¼ ç»™è¿™ä¸ªå‡½æ•°ï¼Œæ‰§è¡Œï¼Œæœ€ç»ˆè¿”å›ä¸€ä¸ªç¬¦åˆæ´‹è‘±æ¨¡å‹ğŸ§…çš„å‡½æ•°ï¼Œæ´‹è‘±æ¨¡å‹æœ€å†…å±‚å°±æ˜¯åŸå§‹çš„ store.dispatch:
`(action) => { ex1(nextå‰),  time1,log1,store.dispatch,log2,time2 (next),  ex2(nextå)  }`

å¦‚æœä¼ å…¥çš„é¡ºåºæ˜¯ applyMiddleware(å·¦1,å·¦2,å·¦3),  é‚£ä¹ˆæœ€ç»ˆçš„æ‰§è¡Œé¡ºåºæ˜¯ å·¦1,å·¦2,å·¦3,store.disptach,å·¦3,å·¦2,å·¦1ã€‚

```js
// dispatch çš„æ—¶å€™ï¼Œä¾æ¬¡æ‰§è¡Œæ‰€æœ‰çš„ middlewareã€‚
const applyMiddleware = function (...middlewares) {

  // è¿”å›è¿™ä¸ªå‡½æ•°ï¼Œç»™ createStore.js é‡Œçš„ rewriteCreateStoreFunction è°ƒç”¨ï¼Œå†è¿”å›ä¸€ä¸ªæ–°çš„ createStore å‡½æ•°
  return function (oldCreateStore) {

    // è¿™ä¸ªç©æ„å„¿æ˜¯æ–°çš„ createStore å‡½æ•°ï¼ŒæŠŠä¸­é—´ä»¶åµŒå…¥åˆ° dispatch æµç¨‹ä¸­ã€‚
    return function (reducer, initState) {
      const store = oldCreateStore(reducer, initState);
      const simpleStore = { getState: store.getState };

      // ä¸­é—´ä»¶å…ˆä¾æ¬¡æ‰§è¡Œä¸€éï¼Œè½¬æˆ (next) => xxx, ç»“æœæ”¾åˆ°é“¾ä¸­ï¼Œå½¢æˆæ•°ç»„
      // æ¯ä¸€ä¸ª middleware å˜æˆä¸€ä¸ª m(simpleStore) çš„æ‰§è¡Œç»“æœ ----> ä¸€ä¸ªå‡½æ•°: (next) => (action) => {...}
      // [
      //  (next) => (action) => {...log...}, 
      //  (next) => (action) => {...exception...},
      //  ...
      // ]
      const chain = middlewares.map(m => m(simpleStore));
      // ç°åœ¨ä¸­é—´ä»¶å·²ç»å˜æˆäº† (next) => (action) => xxx è¿™ä¸ªé¬¼æ ·å­,
      // ç„¶å compose ä»å³åˆ°å·¦æŠŠä¸­é—´ä»¶ç»„åˆèµ·æ¥:
      // ex, time, log ä¸‰ä¸ªè½¬æˆ (next) => .. çš„ä¸­é—´ä»¶ï¼Œå˜æˆ (...args) => ex(time(log(...args))) 

      // ä¼ å…¥ store.dispatch æ‰§è¡Œï¼Œè¿”å› ex(time(log(store.dispatch))) çš„æ‰§è¡Œç»“æœ, æ‰§è¡Œè¿‡ç¨‹æ˜¯:

      // 1. log ä¸­é—´ä»¶ â€(next) => (action) => xxxâ€œ æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸º next ç»™ time ä¸­é—´ä»¶
      // ex(time(   (action) => {..log1..., store.dispatch, ..log2...}       ))

      // 2. time ä¸­é—´ä»¶æ‰§è¡Œï¼Œè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œä½œä¸º next ç»™ exception ä¸­é—´ä»¶
      // ex(   (action) => {..time..}   )

      // 3. æœ€åè¿”å›ä¸€ä¸ªå‡½æ•°ï¼Œç»™ dispatch
      // (action) => { é”™è¯¯å¤„ç†(nextä¹‹å‰)...,  timeä¸­é—´ä»¶æ‰§è¡Œä¼ è¿‡æ¥çš„å‡½æ•°(action) => {...} (next),  xxx(nextä¹‹å)  }

      // æ‰€ä»¥ï¼Œåœ¨ dispatch çš„æ—¶å€™ï¼Œä¸­é—´ä»¶æ ¹æ®ä¼ å…¥ applyMiddleware çš„é¡ºåºï¼Œä»å·¦å¾€å³ï¼ŒæŒ‰æ´‹è‘±æ¨¡å‹ğŸ§…æ‰§è¡Œã€‚(å·¦1,å·¦2,å·¦3,store.disptach,å·¦3,å·¦2,å·¦1)
      const dispatch = compose(...chain)(store.dispatch);

      console.log('dispatch', dispatch);

      return {
        ...store,
        dispatch
      }
    }
  }
}
export default applyMiddleware;
```

### fbindActionCreators.js
æŠŠæ‰€æœ‰åˆ›å»º action çš„å‡½æ•°é›†ä¸­åˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚
æ¯”å¦‚ const actions = bindActionCreators({ Add, setName }, store.dispatch);  
ä½¿ç”¨æ—¶ actions.Add(); ç›¸å½“äº store.dispatch({ type: 'ADD' });
```js
/**
 * @param {Function} actionCreator ç”¨æˆ·å®šä¹‰çš„ action å‡½æ•°ï¼Œæ¯”å¦‚ setName å‡½æ•°ã€‚
 * @param {Function} dispatch store.dispatch
 */
function bindActionCreator(actionCreator, dispatch) {
  return function () {
    return dispatch(actionCreator.apply(null, arguments));
  }
}
export default function bindActionCreators(actionCreators, dispatch) {
  const b = {};
  // æŠŠæ‰€æœ‰åˆ›å»º action çš„å‡½æ•°é›†ä¸­åˆ°ä¸€ä¸ªå¯¹è±¡ä¸Šï¼Œä½¿ç”¨æ—¶å¯ä»¥ç›´æ¥è°ƒç”¨ã€‚
  // for..in  éå†æ‰€æœ‰å¯æšä¸¾å±æ€§ï¼Œå®ƒä¼šæŠŠåŸå‹ä¸Šçš„å±æ€§ä¹Ÿæ‰¾å‡ºæ¥ï¼Œåªä¸è¿‡ Object.prototype ä¸Šçš„å±æ€§æ˜¯ä¸å¯æšä¸¾çš„ï¼Œæ‰€ä»¥æ²¡å‡ºæ¥ã€‚
  for (const key in actionCreators) {
    const action = actionCreators[key];
    if (typeof action === 'function') {
      b[key] = bindActionCreator(action, dispatch);
    }
  }
  return b;
}
```

## fcompose.js
ä»å³å¾€å·¦ç»„åˆå‡½æ•°ï¼Œæ¯”å¦‚ compose(f, g, h) è¿”å›ä¸€ä¸ªå‡½æ•°: (...args) => f(g(h(...args)))
```js
export default function compose(...funcs) {
  if (funcs.length === 0) {
    return (arg) => arg
  }
  if (funcs.length === 1) {
    return funcs[0]
  }
  // a ç›¸å½“äºä¹‹å‰æ‰€æœ‰ç»„åˆå¥½çš„å‡½æ•°, b æ˜¯æœ¬æ¬¡è¦ç»„åˆçš„å‡½æ•°, 
  // æ¯”å¦‚: (f(g(...args)), h) => (...args) => f(g(h(...args)))
  return funcs.reduce((a, b) => (...args) => a(b(...args)))
}
```

# fRedux-Toolkit fredux-toolkit fToolkit
redux å®˜æ–¹æ¨èçš„å·¥å…·é›†ï¼Œæ¯” redux æ›´åŠ è½»é‡ã€‚æœ€ä½³å®è·µã€‚

# react-redux
`react-redux`æ˜¯å°†`Redux store`å’Œ`React UI`ç›¸ç»“åˆçš„`å®˜æ–¹ç»‘å®šå±‚`ã€‚
å®ƒä½¿ react ç»„ä»¶å¯ä»¥ä» redux store è¯»å–æ•°æ®ï¼Œä¹Ÿå¯ä»¥å‘ store å‘èµ· action ä»¥æ›´æ–°çŠ¶æ€ã€‚
åŸºäº context API å°è£…ã€‚
## æ‰‹å†™æºç 
https://github.com/ronnycyy/state-manager/tree/main/react-redux (ã€æ‰‹å†™æºç ç³»åˆ—ã€‘40åˆ†é’Ÿå¸¦ä½ ä»0åˆ°1å®ç°ä¸€ä¸ªreact-redux)


# fRecoil frecoil fåŸå­åŒ–
Recoil æ˜¯ React çš„çŠ¶æ€ç®¡ç†åº“ï¼Œåªèƒ½ç”¨åœ¨ React é‡Œè¾¹ã€‚
## ç›®æ ‡
reduxå¤ªå¤æ‚, å¾—åˆ›å»º store, reducer, action, ..., å’Œ react åˆèµ·æ¥è¿˜å¾—åˆ›å»º react-reduxã€‚é¡¹ç›®å¤æ‚æ—¶ï¼Œä¼šæœ‰å¤šå±‚ Provider æ ‘ğŸŒ².
å› æ­¤ï¼ŒRecoilçš„ç›®æ ‡æ˜¯: æœ€å°åŒ–stateï¼Œä¸è¦æœ‰åŒ…è£…ï¼Œä¸è¦å¤šå±‚æ¬¡çš„Providerã€‚
## æ ¸å¿ƒ
åŸå­çŠ¶æ€å˜åŒ–(text) -> è¡ç”ŸçŠ¶æ€å˜åŒ–(text.length) -> è§†å›¾æ›´æ–°ã€‚
## æ‰‹å†™æºç 
https://github.com/ronnycyy/state-manager/tree/main/recoil  (å‰ç«¯ä¸­çš„æ•°æ®ç»“æ„å’Œç®—æ³•2)

# fvuex
å¤§åƒåœ¾ åªæœ‰ä¸€ä¸ªæ–‡ä»¶ ä¹Ÿæ˜¯åŸºäº reduxã€‚


# fçŠ¶æ€ä¼˜åŒ–
https://github.com/ronnycyy/state-manager/tree/main/react
ä¸¤ç‚¹åŸåˆ™:
1. å°†å˜çš„å’Œä¸å˜çš„åˆ†ç¦»ã€‚
2. å°†`å¼•ç”¨æ¯”è¾ƒ`æ”¹ä¸º`æµ…æ¯”è¾ƒ`ã€‚

## å°†å˜çš„ä¸ä¸å˜çš„åˆ†ç¦»
é€‚ç”¨äº: çˆ¶ç»„ä»¶çš„stateå¯åˆ†ç¦»ç»™å­ç»„ä»¶ã€‚
å°†stateå˜åŒ–çš„å­ç»„ä»¶ä»çˆ¶ç»„ä»¶ä¸­æŠ½ç¦»å‡ºæ¥, ä½¿å­ç»„ä»¶å•ç‹¬æ¸²æŸ“ï¼Œè€Œä¸å½±å“çˆ¶/å…„å¼Ÿç»„ä»¶ã€‚
```js
function App() {
  console.log('App render~');
  return (
    <div>
      <h1>å°†å˜çš„éƒ¨åˆ†å’Œä¸å˜çš„éƒ¨åˆ†åˆ†ç¦»</h1>
      {/* æŠ½ç¦»äº†å˜çš„éƒ¨åˆ†ï¼Œç°åœ¨åªæ˜¯ Input ç»„ä»¶é‡æ–°æ¸²æŸ“ Expensive ä¸ä¼š render äº† */}
      <Input />
      {/* beginWork ä¸­å–å¾— newProps å’Œ oldPropsï¼Œåˆ¤æ–­æ˜¯ç›¸ç­‰çš„ */}
      <Expensive />
    </div>
  );
}
function Input() {
  console.log('Input render~');
  const [text, setText] = useState('');
  // åè°ƒé˜¶æ®µ:  App -> div -> h1 -> Input(æ‰§è¡Œ) -> Expensive (æ·±åº¦ä¼˜å…ˆéå†)
  // å‰é¢éƒ½å¯¹æ¯”å¯¹æ¯”, æ²¡å˜åŒ–æ²¡å˜åŒ–,  bailout bailout..., ç›´åˆ° Input, å‘ç°å‰å state ä¸ä¸€è‡´ï¼Œäºæ˜¯æ‰§è¡Œã€‚ 
  // App è¢« bailout äº†ï¼Œä¸ä¼šæ‰§è¡Œçš„!  "App render~" ä¸ä¼šæ‰“å°ã€‚
  return (
    <Fragment>
      <input value={text} onChange={(e) => setText(e.target.value)} />
      <p>text is {text}</p>
    </Fragment>
  )
}
// è¿™ä¸ªç»„ä»¶æ¯æ¬¡æ¸²æŸ“éƒ½è¦èŠ±è´¹è‡³å°‘100ms
function Expensive() {
  console.log('Expensive render~');
  let now = performance.now();
  while (performance.now() - now < 100) { }
  console.log('è€—æ—¶çš„ç»„ä»¶render');
  return <p>è€—æ—¶çš„ç»„ä»¶</p>
}
```
## å°†`å¼•ç”¨æ¯”è¾ƒ`æ”¹ä¸º`æµ…æ¯”è¾ƒ`
é€‚ç”¨äº: çˆ¶ç»„ä»¶çš„stateä¸å¯åˆ†ç¦»ã€‚
çˆ¶ç»„ä»¶stateå˜åŒ–ï¼Œå¯¼è‡´æœ¬æ¥ä¸ç”¨å˜åŒ–çš„å­ç»„ä»¶ä¹Ÿè·Ÿç€é‡æ–°æ¸²æŸ“ï¼Œä¸ºäº†é¿å…è¿™ç§æƒ…å†µï¼Œåº”åœ¨çˆ¶ç»„ä»¶å¤–éƒ¨ä½¿ç”¨ React.memo åŒ…è£¹å­ç»„ä»¶ï¼Œå†å¼•å…¥åˆ°çˆ¶ç»„ä»¶ã€‚
```js
// åœ¨çˆ¶ç»„ä»¶å¤–å±‚åŒ…è£¹ï¼Œè¿™æ · Input æ‰§è¡Œæ—¶å°±ä¸ä¼šå½±å“ã€‚
const MemoUnderInput = React.memo(UnderInput);
function Input() {
  console.log('Input render~');
  const [text, setText] = useState('');
  return (
    <Fragment>
      <input value={text} onChange={(e) => setText(e.target.value)} />
      <p>text is {text}</p>
      {/* <UnderInput /> */}
      {/*
        React.memo é»˜è®¤æƒ…å†µä¸‹ä¼šå¯¹å¤æ‚ props å¯¹è±¡åšæµ…æ¯”è¾ƒã€‚(æ¯”å¦‚ shallowEqual({},{}) === true, è¿™ä¸¤ä¸ªç©ºå¯¹è±¡å¦‚æœç”¨å¼•ç”¨æ¯”è¾ƒç»“æœæ˜¯false)
        æ‰€ä»¥ä¸æ˜¯å¼•ç”¨æ¯”è¾ƒäº†ï¼Œé‚£ä¹ˆå°±ä¸ä¼šå— Input å½±å“é‡æ–°æ‰§è¡Œï¼Œè€Œæ˜¯ä¸æ‰§è¡Œã€‚
      */}
      <MemoUnderInput />
    </Fragment>
  )
}
```

# å‰ç«¯çŠ¶æ€ç®¡ç†åº“çš„å¯¹æ¯”
Redux `æ—¶é—´æ—…è¡Œ`çš„ç†å¿µéå¸¸ç»å…¸ï¼Œç”±è¿™ä¸ªç†å¿µå‘å±•å‡ºäº†å¾ˆå¤šçŠ¶æ€ç®¡ç†åº“ã€‚
åº”è¯¥æ€ä¹ˆé€‰æ‹© React çŠ¶æ€ç®¡ç†åº“ï¼Ÿä»ä¸¤ä¸ªè§’åº¦è¯´:
1. é¡¹ç›®è§„æ¨¡
2. é¡¹ç›®ç±»å‹

## é¡¹ç›®è§„æ¨¡
1. å¾ˆå°çš„é¡¹ç›®ï¼Œç©å…·é¡¹ç›®ï¼Œæ²¡å¿…è¦ç”¨åº“äº†ï¼Œç›´æ¥ context API å°±è¡Œã€‚
2. å¤§ä¸€ä¸¢ä¸¢çš„é¡¹ç›®ï¼Œä½†è¿˜æ˜¯ä¸€ä¸ªäººå†™çš„ï¼Œæ¯”å¦‚çŸ­æœŸçš„æ´»åŠ¨é¡µï¼Œå¯ä»¥ç”¨ä¸€äº›è¿·ä½ çš„åº“ï¼Œæ¯”å¦‚ unstated(åŸºäºcontextå°è£…)
3. å†å¤§ä¸€ç‚¹ï¼Œéœ€è¦å‡ ä¸ªå°ä¼™ä¼´åˆä½œçš„ï¼Œå°±å¯ä»¥ç”¨ dva, mobx, jotai, recoil ç­‰åŸºäº`åŸå­çŠ¶æ€`ç†å¿µçš„ã€‚

## é¡¹ç›®ç±»å‹
1. æ™®é€šçš„åå°ç®¡ç†é¡µï¼Œè¦å¡«å¾ˆå¤šè¡¨å• => åŒå‘æ•°æ®ç»‘å®š => é€‚åˆç”¨ mobxã€‚
2. å¯Œæ–‡æœ¬ç¼–è¾‘å™¨ï¼Œæˆ‘éœ€è¦å®Œæˆ `æ’¤é”€/é‡åš` è¿™æ ·çš„åŠŸèƒ½ï¼Œé‚£å°±é€‚åˆç”¨ redux ç³»åˆ—çš„`æ—¶é—´æ—…è¡Œ`çš„åº“ã€‚


==============================  fReact  ==============================
# fScheduler
Scheduler æ˜¯ä¸€ä¸ªåœ¨æµè§ˆå™¨ç¯å¢ƒä¸­å®ç°`è°ƒåº¦åŠŸèƒ½`çš„åŒ…ï¼Œå½“å‰ç”¨äº react å†…éƒ¨ï¼Œä½†æ˜¯ react å›¢é˜Ÿè®¡åˆ’å°†å®ƒä½œä¸ºä¸€ä¸ªç‹¬ç«‹çš„åŒ…ã€‚
*åŠŸèƒ½*
1. æ—¶é—´åˆ‡ç‰‡
2. ä¼˜å…ˆçº§è°ƒåº¦
## fæ—¶é—´åˆ‡ç‰‡
*TODO*
0. è®²æ¦‚å¿µã€è¯´ç”¨é€”ã€ä¼˜ç¼ºç‚¹
1. React ä¸ºä»€ä¹ˆé€‰æ‹© MessageChannel ?
2. æ—¶é—´åˆ‡ç‰‡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ
*å‚è€ƒ*
1. React18 é¦–å±æ¸²æŸ“å¹¶æ²¡æœ‰å¼€å¯ concurrent æ¨¡å¼ï¼Œå¦‚ä½•å¼€å¯ï¼Œä»¥è°ƒè¯•ï¼Ÿ
2. SchedulerPostTask é‡Œæ‰æ˜¯å¡é¢‚è¯´çš„ unstable_shouldYieldã€‚
## fä¼˜å…ˆçº§è°ƒåº¦
*TODO*
0. è®²æ¦‚å¿µã€è¯´ç”¨é€”ã€ä¼˜ç¼ºç‚¹
1. 
*å‚è€ƒ*
1. ï½/scheduler/src/forks/Scheduler.js æš´éœ²çš„ unstable_runWithPriorityã€‚
*æ³¨æ„*
Scheduler æ˜¯ç‹¬ç«‹äº React çš„åŒ…ï¼Œæ‰€ä»¥å®ƒçš„ä¼˜å…ˆçº§ä¹Ÿæ˜¯ç‹¬ç«‹äº React çš„ä¼˜å…ˆçº§çš„ã€‚

# flane
lane æ˜¯ React å†…éƒ¨çš„ä¼˜å…ˆçº§æ¨¡å‹ï¼Œå’Œ Scheduler çš„ä¼˜å…ˆçº§æ¨¡å‹æ˜¯åˆ†éš”å¼€çš„ã€‚æºç ä½äº ~/react-reconciler/src/ReactFiberLane.js
*å¯¹laneçš„è¦æ±‚*
1. èƒ½å¤Ÿè¡¨ç¤ºä¸åŒçš„ä¼˜å…ˆçº§
2. å¯èƒ½å­˜åœ¨å¤šä¸ªç›¸åŒä¼˜å…ˆçº§çš„æ›´æ–°ï¼Œæ‰€ä»¥è¦èƒ½è¡¨ç¤º`æ‰¹`çš„æ¦‚å¿µ
3. æ–¹ä¾¿è¿›è¡Œä¼˜å…ˆçº§çš„è¿ç®—
*è¡¨ç¤ºä¸åŒä¼˜å…ˆçº§*
lane æ¨¡å‹å€Ÿé‰´äº†å¡ä¸è½¦æ¯”èµ›çš„åŸç†ï¼Œèµ›åœºä¸Šæœ‰å¤šä¸ªèµ›é“ï¼ŒReact ç”¨ 31 ä¸ªä¸åŒçš„äºŒè¿›åˆ¶ä½ï¼Œæ¥è¡¨ç¤ºä¸åŒçš„èµ›é“ï¼Œä¸åŒèµ›é“å°±è¡¨ç¤ºä¸åŒçš„ä¼˜å…ˆçº§ã€‚
æ¯”å¦‚ SyncLane å é¢†ç¬¬ 1 ä½ï¼Œæ˜¯æ¯”è¾ƒé«˜çš„ä¼˜å…ˆçº§ï¼Œè¶Šå¾€ä¸‹çš„ä½ï¼Œä¼˜å…ˆçº§è¶Šä½ã€‚
*è¡¨è¾¾ æ‰¹ çš„æ¦‚å¿µ*
é™¤äº† Lane ç±»å‹çš„å˜é‡ï¼ŒReact è¿˜å®šä¹‰äº† Lanes ç±»å‹çš„å˜é‡ï¼Œå®ƒä»¬ä¼šå é¢†å¤šä¸ªè¿ç»­çš„äºŒè¿›åˆ¶ä½ï¼Œè¡¨ç¤ºè¿™äº›ä¼˜å…ˆçº§åœ¨åŒä¸€ä¸ªæ‰¹æ¬¡é‡Œã€‚
*æ–¹ä¾¿è®¡ç®—*
lane ä¼˜å…ˆçº§çš„è®¡ç®—ï¼Œå…¶å®å°±æ˜¯äºŒè¿›åˆ¶ä½çš„è®¡ç®—ï¼Œæ¯”å¦‚`æŒ‰ä½ä¸`ã€`æŒ‰ä½æˆ–`ç­‰ã€‚ä½è¿ç®—æ˜¯éå¸¸å¿«é€Ÿçš„ã€‚
## fé¥¥é¥¿é—®é¢˜
ä½ä¼˜å…ˆçº§ä»»åŠ¡å§‹ç»ˆè¢«é«˜ä¼˜å…ˆçº§ä»»åŠ¡æ‰“æ–­ï¼Œæ²¡æœ‰æœºä¼šè¢«æ‰§è¡Œï¼Œè¿™ç§é—®é¢˜å°±æ˜¯é¥¥é¥¿é—®é¢˜ã€‚


# fbatchedUpdates
ä¸€æ¬¡å›è°ƒä¸­è§¦å‘å¤šæ¬¡ setStateï¼Œå°†è¿™å¤šæ¬¡æ›´æ–°åˆå¹¶ä¸ºä¸€æ¬¡æ›´æ–°çš„ä¼˜åŒ–æ‰‹æ®µï¼Œå°±å« batchedUpdatesã€‚
## legacyæ¨¡å¼
*ç‰ˆæœ¬*
é€‚ç”¨äº React18 ä»¥å‰ï¼Œä½¿ç”¨ `ReactDOM.render(<App />, root)` æ¸²æŸ“çš„åº”ç”¨ã€‚
*æºç *
æºç ä½äº ~/react-reconciler/src/ReactFiberWorkLoop.js çš„ batchedUpdates æ–¹æ³•:
1. æ¥æ”¶ä¸€ä¸ªå‡½æ•° fn, fn é€šå¸¸æ˜¯ç»„ä»¶çš„ onClick ç­‰äº‹ä»¶å›è°ƒï¼Œå…¶ä¸­åŒ…å«å¤šä¸ª setState æ–¹æ³•ã€‚
2. fn æ‰§è¡Œä¹‹å‰ï¼Œå°†å®ƒçš„ä¸Šä¸‹æ–‡`æˆ–ä¸Š`ä¸€ä¸ª BatchedContextï¼Œfn æ‰§è¡Œå®Œæˆåï¼Œå†æ¢å¤æˆä¹‹å‰çš„ä¸Šä¸‹æ–‡ã€‚
3. fn æ‰§è¡Œæ—¶ï¼Œå…¶ä¸­çš„ setState ä¼šè·å–åˆ° executionContext, è¿™æ—¶å°±ä¼šå¾—åˆ° BatchedContextï¼Œé‚£ä¹ˆå°±ä¸ä¼šç«‹é©¬è§¦å‘æ›´æ–°ï¼Œè€Œæ˜¯åœ¨ batchedUpdate çš„ finally é‡Œï¼Œæ‰§è¡Œ flushSyncCallbackQueue é‡Œè§¦å‘æ›´æ–°ã€‚
*ç¼ºç‚¹*
1. æ•´ä¸ªè¿‡ç¨‹åŒæ­¥æ‰§è¡Œï¼Œå¦‚æœå°† setState ä½œä¸ºå¼‚æ­¥è°ƒç”¨ï¼Œé‚£ä¹ˆæ‰§è¡Œ setState æ—¶å·²ç»ç¦»å¼€äº† batchedUpdates çš„ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±è·å–ä¸åˆ° BatchedContext äº†ã€‚
## concurrentæ¨¡å¼
*ç‰ˆæœ¬*
React18, é€šè¿‡ `ReactDOM.createRoot(root).render(<App />)` å¼€å¯ï¼Œæ³¨æ„ `import ReactDOM from 'react-dom/client';`ã€‚
*æºç *
this.setState çš„æºç ä½äº: ~/react-reconciler/src/ReactFiberClassComponent.js çš„ classComponentUpdate.enqueueSetState æ–¹æ³•, é€šè¿‡ç±»å®ä¾‹ instance.updater.enqueueSetState æ¥è°ƒç”¨ã€‚
*åŸç†*
1. ç¬¬ä¸€ä¸ª setState è¿›æ¥ï¼Œè·å– lane, è½¬åŒ–æˆ Scheduler çš„ä¼˜å…ˆçº§ï¼Œé€šè¿‡ Scheduler æš´éœ²çš„ scheduleCallback è°ƒåº¦ performConcurrentWorkOnRootï¼ŒåŒæ—¶æ•´ä¸ªReactåº”ç”¨çš„æ ¹ç»“ç‚¹ FiberRootNode è®°å½•è¿™ä¸ªè¢«è°ƒåº¦çš„ä»»åŠ¡å’Œå®ƒçš„ä¼˜å…ˆçº§ã€‚
2. ç¬¬äºŒä¸ª setState è¿›æ¥, å¾—åˆ°ä¸€æ ·çš„ lane, ç„¶ååˆ° ensureRootIsSchedule æ—¶ï¼Œè·å–åˆ°çš„ root.callbackNode æ˜¯ä¸Šä¸€ä¸ª setState è°ƒåº¦çš„ä»»åŠ¡ï¼Œä¸ä¸ºç©ºã€‚æ—¢ç„¶ä¸ä¸ºç©ºï¼Œé‚£ä¹ˆè¡¨ç¤º Reactåº”ç”¨ æœ‰ä»»åŠ¡æ­£åœ¨è°ƒåº¦ï¼Œäºæ˜¯å–å‡ºè¿™ä¸ªä»»åŠ¡çš„ä¼˜å…ˆçº§ root.callbackPriority å’Œæ­¤åˆ»æƒ³è¦è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§å¯¹æ¯”ï¼Œå‘ç°ä¸€è‡´(å› ä¸º lane ä¸€è‡´)ï¼Œé‚£ä¹ˆç¬¬äºŒæ¬¡æ›´æ–°å°±ä¸ä¼šè¢«è°ƒåº¦ï¼Œè€Œæ˜¯ç›´æ¥ return äº†ï¼Œä¹Ÿå°±æ˜¯å¤ç”¨äº†æ­£åœ¨è°ƒåº¦çš„ä»»åŠ¡ã€‚
3. å…³é”®å°±åœ¨äºï¼ŒåŒä¸€ä¸ª onClick é‡Œçš„æ‰€æœ‰ setStateï¼Œå¾—åˆ°çš„ lane éƒ½æ˜¯ä¸€è‡´çš„ï¼Œä»è€Œäº§ç”Ÿçš„ä¼˜å…ˆçº§ä¸€è‡´ï¼Œå°±å¯ä»¥å¤ç”¨ä»»åŠ¡ã€‚


# fé«˜ä¼˜æ›´æ–°å¦‚ä½•æ’é˜Ÿ é«˜ä¼˜æ›´æ–°å¦‚ä½•æ‰“æ–­ä½ä¼˜æ›´æ–°
*DEMO*
ä¸¤æ¬¡æ›´æ–°ï¼Œä¸€æ¬¡æ˜¯ NormalPriority çš„æ›´æ–°ï¼Œä¸€æ¬¡æ˜¯ 1ms å UserBlockingPriority çš„æ›´æ–°ï¼Œåé¢çš„æ›´æ–°ä¼˜å…ˆçº§é«˜ï¼Œä¼šæ‰“æ–­å‰é¢çš„æ›´æ–°ã€‚
```jsx
setTimeout(() => updateCount(1), 1000);
setTimeout(() => button.click(), 1001);
```
*åŸç†*
React18ï¼ŒuseState çš„ dispatchï¼Œä» dispatchSetState å¼€å§‹ã€‚
1. è°ƒåº¦ä½ä¼˜æ›´æ–° (NormalPriority, å¦‚ useState è¿”å›çš„ dispatch)
requestUpdateLaneè·å–lane -> ä½¿ç”¨laneåˆ›å»ºupdateå¯¹è±¡ -> scheduleUpdateOnFiberåœ¨å½“å‰fiberä¸Šè°ƒåº¦laneæ›´æ–° -> ensureRootIsScheduledè°ƒåº¦æ•´ä¸ªåº”ç”¨çš„æ ¹ç»“ç‚¹ -> lane è½¬ Schedule Priority -> è°ƒåº¦ä¸€æ¬¡ NormalPriority çš„ performConcurrentWorkOnRoot
2. é«˜ä¼˜æ›´æ–° (UserBlockingPriority, å¦‚ onClick è§¦å‘çš„æ›´æ–°)
**2.1 æ‰“æ–­ä½ä¼˜æ›´æ–°ï¼Œè°ƒåº¦é«˜ä¼˜æ›´æ–°**
å‰é¢éƒ½ä¸€æ ·ï¼Œç›´åˆ° ensureRootIsScheduledï¼Œå¾—åˆ°çš„ æ–°ä»»åŠ¡ä¼˜å…ˆçº§(newCallbackPriority) é«˜äº å·²å­˜åœ¨çš„ä»»åŠ¡ä¼˜å…ˆçº§(existingCallbackPriority)ï¼Œæ‰€ä»¥å–æ¶ˆæ­£åœ¨è°ƒåº¦ä¸­çš„ä½ä¼˜ä»»åŠ¡ï¼Œè°ƒåº¦æœ¬æ¬¡æ›´é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ã€‚
```js
// æ‰“æ–­ä½ä¼˜ä»»åŠ¡
if (existingCallbackNode != null) { cancelCallback$1(existingCallbackNode); }
...
// è°ƒåº¦é«˜ä¼˜ä»»åŠ¡
scheduleCallback(æ›´é«˜çš„ä¼˜å…ˆçº§, renderä»»åŠ¡);
```
**2.2 æ¸…é™¤ä½ä¼˜æ›´æ–°äº§ç”Ÿçš„å½±å“**
[æºç ä½äº ~/react-reconciler/src/ReactFiberWorkLoop.js: prepareFreshStack]
é«˜ä¼˜å…ˆçº§ä»»åŠ¡åˆ°è¾¾æ‰§è¡Œæ—¶é—´ï¼Œå¼€å§‹è°ƒç”¨renderä»»åŠ¡(performConcurrentWorkOnRoot), åœ¨ render é˜¶æ®µå‰ï¼Œå…ˆæ‰§è¡Œ prepareFreshStackï¼Œå°† workInProgress é‡ç½®ä¸º rootFiberï¼Œæ¸…ç©ºä¸Šä¸€æ¬¡æ›´æ–°äº§ç”Ÿçš„ fiber æ ‘ï¼Œé‡æ–°å¼€å§‹åè°ƒã€‚


# fsuspense
React è¦å®ç°å¿«é€Ÿå“åº”ï¼Œéœ€è¦è§£å†³ 2 ä¸ªé—®é¢˜ï¼Œä¸€ä¸ªæ˜¯ CPU çš„ç“¶é¢ˆï¼Œä¸€ä¸ªæ˜¯ IO çš„ç“¶é¢ˆã€‚CPU ç“¶é¢ˆçš„è§£å†³æ–¹æ¡ˆæ˜¯`æ—¶é—´åˆ‡ç‰‡`ï¼Œè€Œ IO ç“¶é¢ˆçš„è§£å†³æ–¹æ¡ˆå°±æ˜¯ Suspenseã€‚
*åŸç†*
Suspense ç»„ä»¶è¿›å…¥åè°ƒé˜¶æ®µï¼Œæ‰§è¡Œ updateSuspenseComponentï¼Œè¿”å›ä¸€ä¸ª`ç¦»å±Fiberç»“ç‚¹`ä½œä¸ºå­ç»“ç‚¹ã€‚è¿™ä¸ªç¦»å± fiber çš„ pendingProps é‡Œæœ‰ä¸€ä¸ª childern å±æ€§ä»£è¡¨ Suspense å­ç»„ä»¶çš„é›†åˆï¼Œè¿˜æœ‰ä¸€ä¸ª mode å±æ€§ä»£è¡¨å­ç»„ä»¶å½“å‰æ˜¯å¦å¯è§ã€‚å¦‚æœå¯è§å°±æ¸²æŸ“çœŸå®çš„å­ç»„ä»¶ï¼Œå¦‚æœä¸å¯è§å°±æ¸²æŸ“ Suspense çš„ fallback å±æ€§é‡Œå®šä¹‰çš„ç»„ä»¶ã€‚
*ç¦»å±ç»„ä»¶*
fiber.elementType = Symbol(react.offscreen);
*ç»„ä»¶æ ‘*
Suspenseç»„ä»¶ -> OffscreenFiber -> SuspenseåŒ…è£¹çš„å­ç»„ä»¶
*ç»“æŸfallback*
1. thrownValue: è¿™é‡Œå¯ä»¥æ•è·åˆ° Suspense å†…éƒ¨å­ç»„ä»¶å½“æˆé”™è¯¯æŠ›å‡ºçš„ Promise å¯¹è±¡ã€‚
2. root: FiberRootNode
renderRootConcurrent æ–¹æ³•ä¸­:
```js
do {
  try {
    workLoopConcurrent();
    break;
  } catch (thrownValue) {
    handleError(root, thrownValue);
  }
} while (true);
```
renderRootConcurrent -> æ•è·åˆ° Promise å¯¹è±¡ -> handleError -> throwException -> åˆ¤æ–­æ˜¯ä¸€ä¸ª thenable å¯¹è±¡ -> æ‰¾åˆ°ä¸Šé¢æœ€è¿‘çš„ Suspense ç»„ä»¶ -> æ¸²æŸ“ fallback ç»„ä»¶ -> attachPingListenerç›‘å¬æŠ›å‡ºçš„Promise -> Promise.then -> æ‰§è¡Œ pingSuspendedRoot -> ensureRootIsScheduled -> æ›´æ–° React åº”ç”¨ï¼Œæ¸²æŸ“ Suspense çš„å­ç»„ä»¶ã€‚


# fuseTransition
*åŸç†*
mountTransition
*TODO*
ä¸€æ¬¡é«˜ä¼˜æ›´æ–° isPending ä¸º true, ä¸€æ¬¡ä½ä¼˜æ›´æ–° isPending ä¸º falseï¼Œæ ¹æ®è®¾å¤‡è°ƒæ•´ç­‰å¾…çš„æ—¶é•¿ï¼Œåœ¨æ€§èƒ½è¾ƒå·®çš„è®¾å¤‡ä¸Šï¼Œé—´éš”æ—¶é—´å°±ä¼šå˜é•¿ã€‚



# fAPI fReacté¡¶å±‚API
*ç»„ä»¶*
* React.Component
* React.PureComponent
* React.memo
*åˆ›å»ºReactå…ƒç´ *
* React.createElement
* React.createFactory  [å·²åºŸå¼ƒ]
*è½¬æ¢å…ƒç´ *
* React.cloneElement
* React.isValidElement
* React.Children
*Fragments*
* React.Fragment
*Refs*
* React.createRef
* React.forwardRef
*Suspenses*
* React.lazy
* React.Suspense
*Transitions*
* React.startTransition
* React.useTransition
*Hooks*
**åŸºç¡€Hook**
* React.useState
* React.useEffect
* React.useContext
**é¢å¤–çš„Hook**
* React.useReducer
* React.useCallback
* React.useMemo
* React.useRef
* React.useImperativeHandle
* React.useLayoutEffect
* React.useDebugValue
* React.useDeferredValue
* React.useTransition
* React.useId
**Library Hooks**
* React.useInsertionEffect
* React.useSyncExternalStore

# fuseState
React.useState æ¥æ”¶ä¸€ä¸ªåˆå§‹å€¼æˆ–ä¸€ä¸ªåˆå§‹åŒ–å‡½æ•°, è¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ç¬¬ä¸€é¡¹æ˜¯çŠ¶æ€å€¼stateï¼Œç¬¬äºŒé¡¹æ˜¯æ”¹å˜çŠ¶æ€çš„å‡½æ•°setStateã€‚

1. åˆå§‹åŒ–çš„æ—¶å€™ï¼Œè¿”å›çš„ state å’Œ initialState ç›¸åŒã€‚
2. setState æ¥æ”¶ä¸€ä¸ªå€¼æˆ–è€…ä¸€ä¸ªå‡½æ•°ï¼Œè°ƒç”¨åï¼Œå°†ä¸€æ¬¡æ›´æ–°ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ã€‚
3. å¦‚æœä½¿ç”¨ setState æ›´æ–°çš„ state å’Œä¹‹å‰çš„ state ç›¸åŒï¼ŒReact ä¸ä¼šé‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚

*ä¾‹å­ å‡½æ•°å¼æ›´æ–° è®¡æ•°å™¨*
```jsx
function Counter({initialCount}) {
  const [count, setCount] = useState(initialCount);
  return (
    <>
      æ•°é‡: {count}
      <button onClick={() => setCount(initialCount)}>é‡ç½®</button>
      <button onClick={() => setCount(prevCount => prevCount - 1)}>å‡å°‘</button>
      <button onClick={() => setCount(prevCount => prevCount + 1)}>å¢åŠ </button>
    </>
  );
}
```
*ä¾‹å­ åˆå§‹åŒ–å‡½æ•°*
```jsx
const [state, setState] = useState(() => {
  const initialState = someExpensiveComputation(props);
  return initialState;
});
```
*ç”¨æ³•*
```jsx
const [state, setState] = React.useState(initialState);
```

# fuseEffect
React.useEffect æ¥æ”¶ä¸€ä¸ªcreateå‡½æ•°ï¼Œä»¥åŠä¸€ä¸ª deps ä¾èµ–æ•°ç»„ã€‚å½“ä¾èµ–æ•°ç»„ä¸­çš„ä»»ä½•ä¸€é¡¹æ”¹å˜æ—¶ï¼ŒReact ä¼šåœ¨ç»„ä»¶æ›´æ–°å®Œæˆåï¼Œå¼‚æ­¥æ‰§è¡Œ create å‡½æ•°ï¼Œå¹¶è¿”å›ä¸€ä¸ª destory å‡½æ•°ã€‚
*è¦ç‚¹*
1. create å‡½æ•°ä¼šåœ¨ commit é˜¶æ®µå®Œæˆåå¼‚æ­¥æ‰§è¡Œ(å®ä»»åŠ¡)ï¼Œè¿™æ—¶å€™æµè§ˆå™¨å·²ç»å®Œæˆäº†`å¸ƒå±€`ä¸`ç»˜åˆ¶`ï¼Œå¯ä»¥è·å–åˆ°æœ€æ–°çš„ DOM ç»“ç‚¹ã€‚ ä¹‹æ‰€ä»¥è®¾ç½®æˆå¼‚æ­¥ï¼Œæ˜¯å› ä¸ºè¯·æ±‚ã€è®¢é˜…è¿™ç§å‰¯ä½œç”¨æ“ä½œï¼Œä¸åº”è¯¥é˜»å¡æµè§ˆå™¨çš„å¯¹å±å¹•çš„æ›´æ–°ã€‚
2. create å‡½æ•°ä¸€èˆ¬ç”¨æ¥æ‰§è¡Œä¸€äº›å‰¯ä½œç”¨ï¼Œå¦‚è®¾ç½®å®šæ—¶å™¨, è¯·æ±‚æ•°æ®, è®¢é˜…æ•°æ® ç­‰ï¼Œdestory å‡½æ•°ç”¨æ¥ä½œæ¸…é™¤å·¥ä½œï¼Œå¦‚é€€è®¢æ•°æ®ã€‚
3. destory å‡½æ•°ä¼šåœ¨ç»„ä»¶å¸è½½å‰æ‰§è¡Œï¼Œé€šå¸¸æƒ…å†µä¸‹ç»„ä»¶ä¼šå¤šæ¬¡æ¸²æŸ“ï¼Œé‚£ä¹ˆåœ¨æ‰§è¡Œä¸‹ä¸€ä¸ª effect ä¹‹å‰ï¼Œä¸Šä¸€ä¸ª effect å°±å·²ç»è¢«æ¸…é™¤ã€‚
4. å¦‚æœæƒ³è¦æ‰§è¡Œåªè¿è¡Œä¸€æ¬¡çš„ effect, å¯ä»¥ä¼ é€’ä¸€ä¸ªç©ºæ•°ç»„ã€‚
*å¯¹æ¯” useLayoutEffect*
å¹¶éæ‰€æœ‰çš„å‰¯ä½œç”¨éƒ½å¯ä»¥è¢«å»¶è¿Ÿæ‰§è¡Œï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ªå¯¹ç”¨æˆ·å¯è§çš„ DOM æ“ä½œå°±å¿…é¡»åœ¨æµè§ˆå™¨æ‰§è¡Œä¸‹ä¸€æ¬¡ç»˜åˆ¶ä¹‹å‰è¢«åŒæ­¥æ‰§è¡Œï¼Œè¿™æ—¶å€™å°±åº”è¯¥ç”¨ useLayoutEffectï¼Œå®ƒä¼šåœ¨ commit é˜¶æ®µçš„ layout é˜¶æ®µè§¦å‘ï¼Œå¯¹ DOM çš„æ›´æ–°ä¼šè¢«æµè§ˆå™¨åŒæ­¥æ¸²æŸ“ã€‚
*ç”¨æ³•*
```jsx
useEffect(create, deps);
```
*ä¾‹å­*
```jsx
useEffect(() => {
    const subscription = props.source.subscribe();
    return () => {
      subscription.unsubscribe();
    };
  }, [props.source],
);
```

# fuseContext
React.useContext æ¥æ”¶ä¸€ä¸ª context å¯¹è±¡ï¼Œè¿”å›è¯¥ context å¯¹è±¡çš„å½“å‰å€¼ã€‚context å¯¹è±¡ä¸€èˆ¬æ˜¯ React.createContext(obj) çš„è¿”å›å€¼ã€‚
å½“å‰çš„ context å€¼ç”±ä¸Šå±‚ç»„ä»¶ä¸­è·ç¦»å½“å‰ç»„ä»¶æœ€è¿‘çš„`Context.Provider`çš„`value`å±æ€§å†³å®šã€‚
å½“ç»„ä»¶ä¸Šå±‚æœ€è¿‘çš„`Context.Provider`æ›´æ–°æ—¶ï¼Œè¯¥`Hook`ä¼šè§¦å‘é‡æ¸²æŸ“ï¼Œå¹¶ä½¿ç”¨æœ€æ–°ä¼ é€’ç»™`Context.Provider`çš„`value`å€¼ã€‚å³ä½¿ç¥–å…ˆä½¿ç”¨ React.memo æˆ– shouldComponentUpdateï¼Œä¹Ÿä¼šåœ¨ç»„ä»¶æœ¬èº«ä½¿ç”¨ useContext æ—¶é‡æ–°æ¸²æŸ“ã€‚

*ä¾‹å­ åˆ‡æ¢ä¸»é¢˜*
```jsx
import React, { useContext, useState } from 'react';
const themes = {
  light: {
    foreground: "#000000",
    background: "#eeeeee"
  },
  dark: {
    foreground: "#ffffff",
    background: "#222222"
  }
};
const ThemeContext = React.createContext(themes.light);
function App() {
  const [theme, setTheme] = useState(themes.dark);
  const onChangeTheme = () => {
    setTheme(theme === themes.dark ? themes.light : themes.dark);
  }
  return (
    <ThemeContext.Provider value={theme}>
      <Toolbar />
      <button onClick={onChangeTheme}>change theme</button>
    </ThemeContext.Provider>
  );
}
function Toolbar(props) {
  return (
    <div>
      <ThemedButton />
    </div>
  );
}
function ThemedButton() {
  const theme = useContext(ThemeContext);
  return (
    <button style={{ background: theme.background, color: theme.foreground }}>
      I am styled by theme context!
    </button>
  );
}
```

# fuseReducer
React.useReducer æ¥æ”¶ä¸‰ä¸ªå‚æ•°ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚

ä¸‰ä¸ªå‚æ•°åˆ†åˆ«æ˜¯:
1. reducer      ä¸€ä¸ªè°ƒåº¦å‡½æ•°ï¼Œä¼ å…¥å½“å‰çŠ¶æ€stateå’Œæ”¹å˜çŠ¶æ€çš„æ–¹æ³•action, è¿”å›å…¨æ–°çš„çŠ¶æ€ã€‚
2. initialArg   ä¼ é€’ç»™ç¬¬ä¸‰ä¸ªå‚æ•°initå‡½æ•°çš„å€¼ï¼Œä¸€èˆ¬æ˜¯stateçš„åˆå§‹å€¼
3. init         åˆå§‹å€¼ç”Ÿæˆå‡½æ•°ï¼Œæ¥æ”¶ç¬¬äºŒä¸ªå‚æ•° initialArgï¼Œè¿”å›å€¼ä½œä¸º state çš„åˆå§‹å€¼ã€‚

è¿”å›å€¼æ˜¯ä¸€ä¸ªæ•°ç»„ï¼ŒåŒ…å«ä¸¤é¡¹:
1. state        å½“å‰çš„çŠ¶æ€
2. dispatch     ä¸€ä¸ªå‡½æ•°ï¼Œä»£è¡¨æ”¹å˜çŠ¶æ€çš„æ–¹æ³•ï¼Œæ¥æ”¶ actionï¼Œä» reducer é‡Œå¾—åˆ°ç›¸åº”çš„çŠ¶æ€ã€‚

**æ³¨æ„**
1. å¦‚æœ Reducer Hook çš„è¿”å›å€¼ä¸å½“å‰ state ç›¸åŒï¼ŒReact å°†è·³è¿‡å­ç»„ä»¶çš„æ¸²æŸ“åŠå‰¯ä½œç”¨çš„æ‰§è¡Œï¼ŒReact å†…éƒ¨é€šè¿‡ Object.is è¿™ä¸ª API æ¥å†³å®šå‰å state æ˜¯å¦ç›¸åŒã€‚

*ç”¨æ³•*
```jsx
const [state, dispatch] = useReducer(reducer, initialArg, init);
```
*ä¾‹å­*
```jsx
function init(initialCount) {
  return {count: initialCount};
}
function reducer(state, action) {
  switch (action.type) {
    case 'increment':
      return {count: state.count + 1};
    case 'decrement':
      return {count: state.count - 1};
    case 'reset':
      return init(action.payload);
    default:
      throw new Error();
  }
}
function Counter({initialCount}) {
  const [state, dispatch] = useReducer(reducer, initialCount, init);
  return (
    <>
      Count: {state.count}
      <button
        onClick={() => dispatch({type: 'reset', payload: initialCount})}>
        Reset
      </button>
      <button onClick={() => dispatch({type: 'decrement'})}>-</button>
      <button onClick={() => dispatch({type: 'increment'})}>+</button>
    </>
  );
}
```

# fcallback fuseCallback
React.useCallback æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œç¬¬ä¸€ä¸ªæ˜¯`å¯èƒ½è¢«ç¼“å­˜çš„å‡½æ•°`ï¼Œç¬¬äºŒä¸ªæ˜¯`ä¾èµ–æ•°ç»„`ï¼Œè¿”å›ä¸€ä¸ª`ç¼“å­˜å‡½æ•°`ã€‚
è¿™ä¸ª`ç¼“å­˜å‡½æ•°`ä»…åœ¨`ä¾èµ–æ•°ç»„`çš„æŸä¸€é¡¹æ”¹å˜æ—¶æ‰ä¼šæ›´æ–°ã€‚
*ç”¨æ³•*
```jsx
const memoizedCallback = useCallback(
  () => { doSomething(a, b) },
  [a, b],
);
```
å®ƒçš„ä½œç”¨ä¸»è¦æ˜¯ä¿æŒå‡½æ•°çš„å¼•ç”¨ä¸å˜ï¼Œè¿™æ ·å¯ä»¥é¿å…ä¸€äº›ä¸å¿…è¦çš„`é‡æ–°æ¸²æŸ“`ã€‚
æ¯”å¦‚å­ç»„ä»¶æ¯”è¾ƒä¸¤ä¸ªå¼•ç”¨æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœçˆ¶ç»„ä»¶ç”¨äº† useCallback å‘½ä¸­äº†ç¼“å­˜ï¼Œé‚£ä¹ˆæ›´æ–°å‰åä¼ é€’ç»™å­ç»„ä»¶çš„å°±æ˜¯åŒä¸€ä¸ªå¼•ç”¨ï¼Œå­ç»„ä»¶å°±å¯ä»¥ä¸å¿…æ¸²æŸ“ï¼Œæé«˜æ€§èƒ½ã€‚

# fmemo fReact.memo [ä¸‹ä¸€é¡¹æ˜¯useMemo]
React.memo æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ª`å‡½æ•°ç»„ä»¶`ï¼Œä»¥åŠä¸€ä¸ª`æ¯”è¾ƒå‡½æ•°`ï¼Œè¿”å›ä¸€ä¸ª`ç¼“å­˜å€¼`ã€‚
å½“`æ¯”è¾ƒå‡½æ•°`è¿”å› true æ—¶ï¼ŒReact å°†è·³è¿‡è¢« React.memo åŒ…è£¹çš„ç»„ä»¶çš„æ¸²æŸ“ï¼Œç›´æ¥è¿”å›æœ€è¿‘ä¸€æ¬¡çš„æ¸²æŸ“ç»“æœ;
å½“`æ¯”è¾ƒå‡½æ•°`è¿”å› false æ—¶ï¼Œç»„ä»¶é‡æ–°æ¸²æŸ“ï¼ŒReact.memo è¿”å›é‡æ–°æ¸²æŸ“çš„ç»“æœã€‚
*æ³¨æ„*
1. æ¯”è¾ƒå‡½æ•°é»˜è®¤æƒ…å†µä¸‹ä¼š`æµ…æ¯”è¾ƒ`æ›´æ–°å‰åçš„ propsï¼Œå¦‚æœä¸€è‡´è¿”å› true, ä¸ä¸€è‡´è¿”å› falseã€‚
2. React.memo é»˜è®¤ä»…æ£€æŸ¥ propsã€‚å¦‚æœè¢«åŒ…è£¹çš„å‡½æ•°ç»„ä»¶ä½¿ç”¨äº† useStateï¼ŒuseReducer æˆ– useContext çš„ Hookï¼Œå½“ state æˆ– context å‘ç”Ÿå˜åŒ–æ—¶ï¼Œå®ƒä»ä¼šé‡æ–°æ¸²æŸ“ã€‚
*ç”¨æ³•*
```jsx
const MemoComponent = React.memo(MyComponent, areEqual);
```
*ä¾‹å­*
```jsx
function MyComponent(props) { /* ä½¿ç”¨ props æ¸²æŸ“ */ }
function areEqual(prevProps, nextProps) { /* è¿”å› true è·³è¿‡æ¸²æŸ“ï¼Œè¿”å› false æ­£å¸¸æ¸²æŸ“ã€‚ */ }
export default React.memo(MyComponent, areEqual);
```

# fuseMemo [ä¸Šä¸€é¡¹æ˜¯React.memo]
useMemo æ¥æ”¶ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯`createå‡½æ•°`ï¼Œä¸€ä¸ªæ˜¯`ä¾èµ–æ•°ç»„`ï¼Œè¿”å›ä¸€ä¸ªç¼“å­˜å€¼ã€‚
å½“å‡½æ•°ç»„ä»¶é‡æ–°æ¸²æŸ“æ—¶ï¼Œå¦‚æœ`ä¾èµ–æ•°ç»„`ä¸­çš„ä»»ä½•ä¸€é¡¹å‘ç”Ÿäº†æ”¹å˜ï¼Œ`createå‡½æ•°`å°±ä¼šé‡æ–°æ‰§è¡Œï¼Œè¿”å›æ–°çš„ç¼“å­˜å€¼ã€‚
è¿™ç§ä¼˜åŒ–æœ‰åŠ©äºé¿å…åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½è¿›è¡Œé«˜å¼€é”€çš„è®¡ç®—ã€‚
*ç”¨æ³•*
```jsx
const memoizedValue = useMemo(create, deps);
```
*æ³¨æ„*
1. å¦‚æœæ²¡æœ‰æä¾›ä¾èµ–é¡¹æ•°ç»„ï¼ŒuseMemo åœ¨æ¯æ¬¡æ¸²æŸ“æ—¶éƒ½ä¼šè®¡ç®—æ–°çš„å€¼ã€‚
2. å¦‚æœä¼ å…¥ deps ä¸€ä¸ªç©ºæ•°ç»„ï¼Œé‚£ä¹ˆ useMemo å°†åªä¿ç•™ç¬¬ä¸€æ¬¡çš„ç¼“å­˜ï¼Œä¸ä¼šåˆ·æ–°ç¼“å­˜ã€‚
3. ä¸è¦æŠŠå‰¯ä½œç”¨è¿™ç±»çš„æ“ä½œæ”¾åœ¨ create å‡½æ•°ä¸­ï¼Œè¿™å±äº useEffect çš„é€‚ç”¨èŒƒç•´ã€‚ä¼ å…¥ useMemo çš„å‡½æ•°ä¼šåœ¨æ¸²æŸ“æœŸé—´æ‰§è¡Œï¼Œè€Œä¸æ˜¯æ¸²æŸ“å®Œæˆåã€‚

# få›è°ƒref
ç»™ React åŸç”ŸDOMå…ƒç´ çš„ ref å±æ€§ä¼ é€’ä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œè¿™ä¸ªå›è°ƒå‡½æ•°å°†ä¼šæ”¶åˆ° DOM å®ä¾‹ã€‚
```jsx
class CustomTextInput extends React.Component {
  constructor(props) {
    super(props);
    this.textInput = null;
    this.setTextInputRef = (element) => { this.textInput = element };
  }
  componentDidMount() {
    // è·å¾— text è¾“å…¥æ¡† DOM ç»“ç‚¹
    console.log(this.textInput);
  }
  render() {
    // ä½¿ç”¨ `ref` çš„å›è°ƒå‡½æ•°å°† text è¾“å…¥æ¡† DOM èŠ‚ç‚¹çš„å¼•ç”¨å­˜å‚¨åˆ° React å®ä¾‹ä¸Š
    return (
      <div>
        <input type="text" ref={this.setTextInputRef}  />
      </div>
    );
  }
}
```

# fuseRef
React.useRef è¿”å›ä¸€ä¸ªå¯å˜çš„ ref å¯¹è±¡ï¼Œå…¶ .current å±æ€§è¢«åˆå§‹åŒ–ä¸º useRef æ¥æ”¶çš„å‚æ•°(initialValue)ã€‚
è¿”å›çš„ ref å¯¹è±¡åœ¨ç»„ä»¶çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸå†…æŒç»­å­˜åœ¨ã€‚

æœ¬è´¨ä¸Šï¼ŒuseRef å°±åƒæ˜¯å¯ä»¥åœ¨å…¶ .current å±æ€§ä¸­ä¿å­˜ä¸€ä¸ªå¯å˜å€¼çš„â€œç›’å­â€ã€‚

*ä¾‹å­ å‘½ä»¤å¼åœ°è®¿é—®å­ç»„ä»¶*
```jsx
function TextInputWithFocusButton() {
  const inputEl = useRef(null);
  const onButtonClick = () => {
    // `current` æŒ‡å‘å·²æŒ‚è½½åˆ° DOM ä¸Šçš„ input å…ƒç´ 
    inputEl.current.focus();
  };
  return (
    <>
      <input ref={inputEl} type="text" />
      <button onClick={onButtonClick}>Focus the input</button>
    </>
  );
}
```

# fuseImperativeHandle
ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¸å¯ä»¥ç›´æ¥å¼•ç”¨ä¸€ä¸ªå‡½æ•°ç»„ä»¶ã€‚ä½†æ˜¯ useImperativeHandle å¯ä»¥è®©ä½ ä½¿ç”¨ ref è°ƒç”¨ä¸€äº›å­ç»„ä»¶æš´éœ²çš„æ–¹æ³•ã€‚
useImperativeHandle åº”å½“ä¸ forwardRef ä¸€èµ·ä½¿ç”¨ã€‚
*ä¾‹å­ çˆ¶ç»„ä»¶è°ƒç”¨å­ç»„ä»¶æš´éœ²çš„æ–¹æ³•doit*
```jsx
// å­ç»„ä»¶
function FancyInput(props, ref) {
  const inputRef = useRef();
  useImperativeHandle(ref, () => ({
    doit: () => {
      // è¿™é‡Œå®Œå…¨å¯ä»¥æ¢æˆä¸€å¥ log å•¥çš„ï¼Œå’Œ useRef æ²¡æœ‰å…³ç³»çš„é‚£ç§ã€‚
      inputRef.current.focus();
    }
  }));
  return <input ref={inputRef} ... />;
}
FancyInput = forwardRef(FancyInput);

// çˆ¶ç»„ä»¶
function Parent() {
  const ref = useRef();
  useEffect(() => {
    ref.current.doit();
  })
  return (
    <div>
      <FancyInput ref={ref}>
    <div>
  )
}
```
*ç”¨æ³•*
```jsx
useImperativeHandle(ref, createHandle, [deps]);
```


# fuseLayoutEffect
1. åœ¨ commit é˜¶æ®µçš„ layout é˜¶æ®µåŒæ­¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰çš„ DOM å˜æ›´ä¹‹ååŒæ­¥è°ƒç”¨ã€‚
2. ä½¿ç”¨æ–¹æ³•å’Œ useEffect ç›¸åŒã€‚
3. å¯ä»¥ä½¿ç”¨å®ƒæ¥è¯»å– DOM å¸ƒå±€å¹¶åŒæ­¥è§¦å‘é‡æ¸²æŸ“ã€‚åœ¨æµè§ˆå™¨æ‰§è¡Œç»˜åˆ¶ä¹‹å‰ï¼ŒuseLayoutEffect å†…éƒ¨çš„æ›´æ–°è®¡åˆ’å°†è¢«åŒæ­¥åˆ·æ–°ã€‚
æ³¨æ„: å°½å¯èƒ½ä½¿ç”¨æ ‡å‡†çš„ useEffect ä»¥é¿å…é˜»å¡è§†è§‰æ›´æ–°ã€‚
*ç”¨æ³•*
```jsx
useLayoutEffect(create, deps);
```
*ä¾‹å­*
```jsx
function Demo() {
  React.useLayoutEffect(() => {
    console.log('commité˜¶æ®µ-layouté˜¶æ®µåŒæ­¥æ‰§è¡Œ')
  }, []);
  return <div>Demo</div>
}
```


# fuseDebugValue
React.useDebugValue å¯ç”¨äºåœ¨ React å¼€å‘è€…å·¥å…·ä¸­æ˜¾ç¤ºè‡ªå®šä¹‰ hook çš„æ ‡ç­¾ã€‚
*ä¾‹å­*
```jsx
function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);
  // åœ¨å¼€å‘è€…å·¥å…·ä¸­çš„è¿™ä¸ª Hook æ—è¾¹æ˜¾ç¤ºæ ‡ç­¾
  // e.g. "FriendStatus: Online"
  useDebugValue(isOnline ? 'Online' : 'Offline');
  return isOnline;
}
```
**å»¶è¿Ÿæ ¼å¼åŒ– debug å€¼**
åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ ¼å¼åŒ–å€¼çš„æ˜¾ç¤ºå¯èƒ½æ˜¯ä¸€é¡¹å¼€é”€å¾ˆå¤§çš„æ“ä½œã€‚é™¤ééœ€è¦æ£€æŸ¥ Hookï¼Œå¦åˆ™æ²¡æœ‰å¿…è¦è¿™ä¹ˆåšã€‚
å› æ­¤ï¼ŒuseDebugValue æ¥å—ä¸€ä¸ªæ ¼å¼åŒ–å‡½æ•°ä½œä¸ºå¯é€‰çš„ç¬¬äºŒä¸ªå‚æ•°ã€‚è¯¥å‡½æ•°åªæœ‰åœ¨ Hook è¢«æ£€æŸ¥æ—¶æ‰ä¼šè¢«è°ƒç”¨ã€‚å®ƒæ¥å— debug å€¼ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¸”ä¼šè¿”å›ä¸€ä¸ªæ ¼å¼åŒ–çš„æ˜¾ç¤ºå€¼ã€‚
ä¾‹å¦‚ï¼Œä¸€ä¸ªè¿”å› Date å€¼çš„è‡ªå®šä¹‰ Hook å¯ä»¥é€šè¿‡æ ¼å¼åŒ–å‡½æ•°æ¥é¿å…ä¸å¿…è¦çš„ toDateString å‡½æ•°è°ƒç”¨:
```jsx
useDebugValue(date, date => date.toDateString());
```

# fuseDeferredValue
React.useDeferredValue æ¥å—ä¸€ä¸ªå€¼ï¼Œå¹¶è¿”å›è¯¥å€¼çš„æ–°å‰¯æœ¬ï¼Œè¯¥å‰¯æœ¬å°†æ¨è¿Ÿåˆ°æ›´ç´§æ€¥çš„æ›´æ–°ä¹‹åã€‚
å¦‚æœå½“å‰æ¸²æŸ“æ˜¯ä¸€ä¸ªç´§æ€¥æ›´æ–°çš„ç»“æœï¼Œæ¯”å¦‚ç”¨æˆ·è¾“å…¥ï¼ŒReact å°†è¿”å›ä¹‹å‰çš„å€¼ï¼Œç„¶ååœ¨ç´§æ€¥æ¸²æŸ“å®Œæˆåæ¸²æŸ“æ–°çš„å€¼ã€‚

è¯¥ hook ä¸ä½¿ç”¨é˜²æŠ–å’ŒèŠ‚æµå»å»¶è¿Ÿæ›´æ–°çš„ç”¨æˆ·ç©ºé—´ hooks ç±»ä¼¼ã€‚
ä½¿ç”¨ useDeferredValue çš„å¥½å¤„æ˜¯ï¼ŒReact å°†åœ¨å…¶ä»–å·¥ä½œå®Œæˆåç«‹å³è¿›è¡Œæ›´æ–°ï¼Œè€Œä¸æ˜¯ç­‰å¾…ä»»æ„æ—¶é—´ã€‚å¹¶ä¸”åƒ startTransition ä¸€æ ·ï¼Œå»¶è¿Ÿå€¼å¯ä»¥æš‚åœï¼Œè€Œä¸ä¼šè§¦å‘ç°æœ‰å†…å®¹çš„æ„å¤–é™çº§ã€‚

useDeferredValue ä»…å»¶è¿Ÿä½ ä¼ é€’ç»™å®ƒçš„å€¼ã€‚
å¦‚æœä½ æƒ³è¦åœ¨ç´§æ€¥æ›´æ–°æœŸé—´é˜²æ­¢å­ç»„ä»¶é‡æ–°æ¸²æŸ“ï¼Œåˆ™è¿˜å¿…é¡»ä½¿ç”¨ React.memo æˆ– React.useMemo è®°å¿†è¯¥å­ç»„ä»¶:
*ä¾‹å­ å»¶è¿Ÿå¹¶é˜²æ­¢å­ç»„ä»¶é‡æ¸²æŸ“*
```jsx
function Typeahead() {
  const query = useSearchQuery('');
  const deferredQuery = useDeferredValue(query);
  // Memoizing å‘Šè¯‰ React ä»…å½“ deferredQuery æ”¹å˜ï¼Œ
  // è€Œä¸æ˜¯ query æ”¹å˜çš„æ—¶å€™æ‰é‡æ–°æ¸²æŸ“
  const suggestions = useMemo(() =>
    <SearchSuggestions query={deferredQuery} />,
    [deferredQuery]
  );
  return (
    <>
      <SearchInput query={query} />
      <Suspense fallback="Loading results...">
        {suggestions}
      </Suspense>
    </>
  );
}
```
è®°å¿†è¯¥å­ç»„ä»¶å‘Šè¯‰ React å®ƒä»…å½“ deferredQuery æ”¹å˜è€Œä¸æ˜¯ query æ”¹å˜çš„æ—¶å€™æ‰éœ€è¦å»é‡æ–°æ¸²æŸ“ã€‚
è¿™ä¸ªé™åˆ¶ä¸æ˜¯ useDeferredValue ç‹¬æœ‰çš„ï¼Œå®ƒå’Œä½¿ç”¨é˜²æŠ–æˆ–èŠ‚æµçš„ hooks ç±»ä¼¼ã€‚


# fuseId
useId æ˜¯ä¸€ä¸ªç”¨äºç”Ÿæˆæ¨ªè·¨æœåŠ¡ç«¯å’Œå®¢æˆ·ç«¯çš„ç¨³å®šçš„å”¯ä¸€ ID çš„åŒæ—¶é¿å… hydration ä¸åŒ¹é…çš„ hookã€‚
æ³¨æ„: useId ç”Ÿæˆä¸€ä¸ªåŒ…å« : çš„å­—ç¬¦ä¸² tokenã€‚è¿™æœ‰åŠ©äºç¡®ä¿ token æ˜¯å”¯ä¸€çš„ï¼Œä½†åœ¨ CSS é€‰æ‹©å™¨æˆ– querySelectorAll ç­‰ API ä¸­ä¸å—æ”¯æŒã€‚
*ä¾‹å­*
```jsx
import { useId } from 'react';

// ç›´æ¥ä¼ é€’ id ç»™éœ€è¦å®ƒçš„å…ƒç´ 
function Checkbox() {
  const id = useId();
  return (
    <>
      <label htmlFor={id}>Do you like React?</label>
      <input id={id} type="checkbox" name="react"/>
    </>
  );
};

// å¯¹äºåŒä¸€ç»„ä»¶ä¸­çš„å¤šä¸ª IDï¼Œä½¿ç”¨ç›¸åŒçš„ id å¹¶æ·»åŠ åç¼€
function NameFields() {
  const id = useId();
  return (
    <div>
      <label htmlFor={id + '-firstName'}>First Name</label>
      <div>
        <input id={id + '-firstName'} type="text" />
      </div>
      <label htmlFor={id + '-lastName'}>Last Name</label>
      <div>
        <input id={id + '-lastName'} type="text" />
      </div>
    </div>
  );
}
```

# fComponent
React.Component æ˜¯ä½¿ç”¨ ES6 class è¯­æ³•å®šä¹‰ React ç»„ä»¶çš„åŸºç±»:
```jsx
class Greeting extends React.Component {
  render() {
    return <h1>Hello, {this.props.name}</h1>;
  }
}
```

# fPureComponent  fCompoenntå’ŒPureCompoenntçš„åŒºåˆ«
1. React.PureComponent ä¸ React.Component å¾ˆç›¸ä¼¼ã€‚ä¸¤è€…çš„åŒºåˆ«åœ¨äº React.Component å¹¶æœªå®ç° shouldComponentUpdate()ï¼Œè€Œ React.PureComponent ä¸­ä»¥`æµ…å±‚å¯¹æ¯”` prop å’Œ state çš„æ–¹å¼æ¥å®ç°äº†è¯¥å‡½æ•°ã€‚
2. å¦‚æœ prop æˆ– state ä¸­åŒ…å«å¤æ‚çš„æ•°æ®ç»“æ„ï¼Œåˆ™æœ‰å¯èƒ½å› ä¸ºæ— æ³•æ£€æŸ¥æ·±å±‚çš„å·®åˆ«ï¼Œäº§ç”Ÿé”™è¯¯çš„æ¯”å¯¹ç»“æœã€‚
ä»…åœ¨ä½ çš„ props å’Œ state è¾ƒä¸ºç®€å•æ—¶ï¼Œæ‰ä½¿ç”¨ React.PureComponentï¼Œæˆ–è€…åœ¨æ·±å±‚æ•°æ®ç»“æ„å‘ç”Ÿå˜åŒ–æ—¶è°ƒç”¨ forceUpdate() æ¥ç¡®ä¿ç»„ä»¶è¢«æ­£ç¡®åœ°æ›´æ–°ã€‚
3. React.PureComponent ä¸­çš„ shouldComponentUpdate() å°†è·³è¿‡æ‰€æœ‰å­ç»„ä»¶æ ‘çš„ prop æ›´æ–°ã€‚å› æ­¤ï¼Œè¯·ç¡®ä¿æ‰€æœ‰å­ç»„ä»¶ä¹Ÿéƒ½æ˜¯â€œçº¯â€çš„ç»„ä»¶ã€‚
4. ä½ ä¹Ÿå¯ä»¥è€ƒè™‘ä½¿ç”¨ immutable å¯¹è±¡åŠ é€ŸåµŒå¥—æ•°æ®çš„æ¯”è¾ƒã€‚

# fcreateElement
åˆ›å»ºå¹¶è¿”å›æŒ‡å®šç±»å‹çš„æ–° React å…ƒç´ ã€‚å…¶ä¸­çš„ç±»å‹å‚æ•°æ—¢å¯ä»¥æ˜¯æ ‡ç­¾åå­—ç¬¦ä¸²ï¼ˆå¦‚ 'div' æˆ– 'span'ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯ React ç»„ä»¶ ç±»å‹ (ç±»ç»„ä»¶æˆ–å‡½æ•°ç»„ä»¶)ï¼Œæˆ–æ˜¯ React.Fragment ç±»å‹ã€‚

*ç”¨æ³•*
```js
React.createElement(type, [props], [...children])
```

ä½¿ç”¨ JSX ç¼–å†™çš„ä»£ç å°†ä¼šè¢«è½¬æ¢æˆä½¿ç”¨ React.createElement() çš„å½¢å¼ã€‚
å¦‚æœä½¿ç”¨äº† JSX æ–¹å¼ï¼Œé‚£ä¹ˆä¸€èˆ¬æ¥è¯´å°±ä¸éœ€è¦ç›´æ¥è°ƒç”¨ React.createElement()ã€‚
*JSX*
```jsx
<div>Hello {this.props.toWhat}</div>;
```
*React.createElement*
```js
React.createElement('div', null, `Hello ${this.props.toWhat}`);
```

# fcreateFactory
æ­¤è¾…åŠ©å‡½æ•°å·²åºŸå¼ƒï¼Œç”¨ React.createElement ä»£æ›¿å®ƒã€‚
è¿”å›ç”¨äºç”ŸæˆæŒ‡å®šç±»å‹ React å…ƒç´ çš„å‡½æ•°ï¼Œå¦‚ 'div', 'span', Reactç»„ä»¶ç­‰ã€‚


# fcloneElement
ä»¥ element å…ƒç´ ä¸ºæ ·æ¿å…‹éš†å¹¶è¿”å›æ–°çš„ React å…ƒç´ ã€‚config ä¸­åº”åŒ…å«æ–°çš„ propsï¼Œkey æˆ– refã€‚è¿”å›å…ƒç´ çš„ props æ˜¯å°†æ–°çš„ props ä¸åŸå§‹å…ƒç´ çš„ props æµ…å±‚åˆå¹¶åçš„ç»“æœã€‚æ–°çš„å­å…ƒç´ å°†å–ä»£ç°æœ‰çš„å­å…ƒç´ ï¼Œå¦‚æœåœ¨ config ä¸­æœªå‡ºç° key æˆ– refï¼Œé‚£ä¹ˆåŸå§‹å…ƒç´ çš„ key å’Œ ref å°†è¢«ä¿ç•™ã€‚
*ç”¨æ³•*
```js
React.cloneElement(element,[config],[...children])
```
React.cloneElement() å‡ ä¹ç­‰åŒäº:
```jsx
<element.type {...element.props} {...props}>{children}</element.type>
```
ä½†æ˜¯ï¼Œè¿™ä¹Ÿä¿ç•™äº†ç»„ä»¶çš„ refã€‚è¿™æ„å‘³ç€å½“é€šè¿‡ ref è·å–å­èŠ‚ç‚¹æ—¶ï¼Œä½ å°†ä¸ä¼šæ„å¤–åœ°ä»ä½ ç¥–å…ˆèŠ‚ç‚¹ä¸Šçªƒå–å®ƒã€‚ç›¸åŒçš„ ref å°†æ·»åŠ åˆ°å…‹éš†åçš„æ–°å…ƒç´ ä¸­ã€‚å¦‚æœå­˜åœ¨æ–°çš„ ref æˆ– key å°†è¦†ç›–ä¹‹å‰çš„ã€‚
å¼•å…¥æ­¤ API æ˜¯ä¸ºäº†æ›¿æ¢å·²å¼ƒç”¨çš„ React.addons.cloneWithProps()ã€‚


# fisValidElement
*ç”¨æ³•*
```js
React.isValidElement(object);
```
*è§£é‡Š*
ä¼ å…¥ä¸€ä¸ªå¯¹è±¡ï¼ŒéªŒè¯å¯¹è±¡æ˜¯å¦ä¸º React å…ƒç´ ï¼Œè¿”å›å€¼ä¸º true æˆ– falseã€‚


# fChildren
React.Children æä¾›äº†ç”¨äºå¤„ç† this.props.children çš„å®ç”¨æ–¹æ³•, ç±»ä¼¼äºæ•°ç»„çš„æ–¹æ³•ã€‚
*React.Children.map*
```js
React.Children.map(children, function[(thisArg)])
```
åœ¨ children é‡Œçš„æ¯ä¸ªç›´æ¥å­èŠ‚ç‚¹ä¸Šè°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå¹¶å°† this è®¾ç½®ä¸º thisArgï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚
å¦‚æœ children æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå®ƒå°†è¢«éå†å¹¶ä¸ºæ•°ç»„ä¸­çš„æ¯ä¸ªå­èŠ‚ç‚¹è°ƒç”¨è¯¥å‡½æ•°ã€‚å¦‚æœå­èŠ‚ç‚¹ä¸º null æˆ–æ˜¯ undefinedï¼Œåˆ™æ­¤æ–¹æ³•å°†è¿”å› null æˆ–æ˜¯ undefinedï¼Œè€Œä¸ä¼šè¿”å›æ•°ç»„ã€‚
*React.Children.forEach*
```js
React.Children.forEach(children, function[(thisArg)])
```
ä¸ React.Children.map() ç±»ä¼¼ï¼Œä½†å®ƒåªä¼šéå†ï¼Œä¸ä¼šè¿”å›ä¸€ä¸ªæ•°ç»„ã€‚
*React.Children.count*
```js
React.Children.count(children)
```
è¿”å› children ä¸­çš„ç»„ä»¶æ€»æ•°é‡ï¼Œç­‰åŒäºé€šè¿‡ map æˆ– forEach è°ƒç”¨å›è°ƒå‡½æ•°çš„æ¬¡æ•°ã€‚
*React.Children.only*
```js
React.Children.only(children)
```
children å¯èƒ½æ˜¯ä¸ªæ•°ç»„ï¼Œè¿™ä¸ª API èƒ½éªŒè¯ children æ˜¯å¦åªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹ï¼ˆä¸€ä¸ª React å…ƒç´ ï¼‰ï¼Œå¦‚æœæœ‰åˆ™è¿”å›å®ƒï¼Œå¦åˆ™æ­¤æ–¹æ³•ä¼šæŠ›å‡ºé”™è¯¯ã€‚
*React.Children.toArray*
```js
React.Children.toArray(children)
```
å°† children è¿™ä¸ªå¤æ‚çš„æ•°æ®ç»“æ„ä»¥æ•°ç»„çš„æ–¹å¼æ‰å¹³å±•å¼€å¹¶è¿”å›ï¼Œå¹¶ä¸ºæ¯ä¸ªå­èŠ‚ç‚¹åˆ†é…ä¸€ä¸ª keyã€‚å½“ä½ æƒ³è¦åœ¨æ¸²æŸ“å‡½æ•°ä¸­æ“ä½œå­èŠ‚ç‚¹çš„é›†åˆæ—¶ï¼Œå®ƒä¼šéå¸¸å®ç”¨ï¼Œç‰¹åˆ«æ˜¯å½“ä½ æƒ³è¦åœ¨å‘ä¸‹ä¼ é€’ this.props.children ä¹‹å‰å¯¹å†…å®¹é‡æ–°æ’åºæˆ–è·å–å­é›†æ—¶ã€‚


# fFragment
React.Fragment ç»„ä»¶èƒ½å¤Ÿåœ¨ä¸é¢å¤–åˆ›å»º DOM å…ƒç´ çš„æƒ…å†µä¸‹ï¼Œè®© render() æ–¹æ³•ä¸­è¿”å›å¤šä¸ªå…ƒç´ ã€‚
æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ç®€å†™è¯­æ³• <></>ã€‚
```jsx
render() {
  return (
    <React.Fragment>
      Some text.
      <h2>A heading</h2>
    </React.Fragment>
  );
}
```


# fcreateRef
React.createRef åˆ›å»ºä¸€ä¸ªèƒ½å¤Ÿé€šè¿‡ ref å±æ€§é™„åŠ åˆ° React å…ƒç´ çš„ refã€‚
```jsx
class MyComponent extends React.Component {
  constructor(props) {
    super(props);
    this.inputRef = React.createRef();
  }
  render() {
    return <input type="text" ref={this.inputRef} />;
  }
  componentDidMount() {
    this.inputRef.current.focus();
  }
}
```


# fforwardRef
React.forwardRef ä¼šåˆ›å»ºä¸€ä¸ªReactç»„ä»¶ï¼Œè¿™ä¸ªç»„ä»¶èƒ½å¤Ÿå°†å…¶æ¥å—çš„ ref å±æ€§è½¬å‘åˆ°å…¶ç»„ä»¶æ ‘ä¸‹çš„å¦ä¸€ä¸ªç»„ä»¶ä¸­ã€‚
React.forwardRef æ¥å—æ¸²æŸ“å‡½æ•°ä½œä¸ºå‚æ•°ã€‚React å°†ä½¿ç”¨ props å’Œ ref ä½œä¸ºå‚æ•°æ¥è°ƒç”¨æ­¤å‡½æ•°ã€‚æ­¤å‡½æ•°åº”è¿”å› React èŠ‚ç‚¹ã€‚
```jsx
const FancyButton = React.forwardRef((props, ref) => (
  <button ref={ref} className="FancyButton">
    {props.children}
  </button>
));
const ref = React.createRef();
<FancyButton ref={ref}>Click me!</FancyButton>;
```
åœ¨ä¸Šè¿°çš„ç¤ºä¾‹ä¸­ï¼ŒReact ä¼šå°† <FancyButton ref={ref}> å…ƒç´ çš„ ref ä½œä¸ºç¬¬äºŒä¸ªå‚æ•°ä¼ é€’ç»™ React.forwardRef å‡½æ•°ä¸­çš„æ¸²æŸ“å‡½æ•°ã€‚
è¯¥æ¸²æŸ“å‡½æ•°ä¼šå°† ref ä¼ é€’ç»™ <button ref={ref}> å…ƒç´ ã€‚
å› æ­¤ï¼Œå½“ React é™„åŠ äº† ref å±æ€§ä¹‹åï¼Œref.current å°†ç›´æ¥æŒ‡å‘ <button> DOM å…ƒç´ å®ä¾‹ã€‚


# flazy
React.lazy() å…è®¸ä½ å®šä¹‰ä¸€ä¸ªåŠ¨æ€åŠ è½½çš„ç»„ä»¶ã€‚è¿™æœ‰åŠ©äºç¼©å‡ bundle çš„ä½“ç§¯ï¼Œå¹¶å»¶è¿ŸåŠ è½½åœ¨åˆæ¬¡æ¸²æŸ“æ—¶æœªç”¨åˆ°çš„ç»„ä»¶ã€‚
*åŠ¨æ€åŠ è½½ä¸€ä¸ªç»„ä»¶*
```js
const SomeComponent = React.lazy(() => import('./SomeComponent'));
```
æ³¨æ„: æ¸²æŸ“ lazy ç»„ä»¶ä¾èµ–è¯¥ç»„ä»¶æ¸²æŸ“æ ‘ä¸Šå±‚çš„ <React.Suspense> ç»„ä»¶ã€‚è¿™æ˜¯æŒ‡å®šåŠ è½½æŒ‡ç¤ºå™¨ï¼ˆloading indicatorï¼‰çš„æ–¹å¼ã€‚


# fSuspense
React.Suspense ä½¿å¾—ç»„ä»¶å¯ä»¥â€œç­‰å¾…â€æŸäº›æ“ä½œç»“æŸåï¼Œå†è¿›è¡Œæ¸²æŸ“, å®ƒé€šè¿‡ fallback å±æ€§æŒ‡å®š Loading çŠ¶æ€å±•ç¤ºçš„ç»„ä»¶ã€‚
*æ˜¾ç¤º Spinner ç›´è‡³ OtherComponent åŠ è½½å®Œæˆ*
```js
const OtherComponent = React.lazy(() => import('./OtherComponent'));
function MyComponent() {
  return (
    <React.Suspense fallback={<Spinner />}>
      <div>
        <OtherComponent />
      </div>
    </React.Suspense>
  );
}
```
æ³¨æ„: lazy ç»„ä»¶å¯ä»¥ä½äº Suspense ç»„ä»¶æ ‘çš„æ·±å¤„â€”â€”å®ƒä¸å¿…åŒ…è£…æ ‘ä¸­çš„æ¯ä¸€ä¸ªå»¶è¿ŸåŠ è½½ç»„ä»¶ã€‚
æœ€ä½³å®è·µæ˜¯å°† <Suspense> ç½®äºä½ æƒ³å±•ç¤º Loading çš„ä½ç½®ï¼Œè€Œ lazy() åˆ™å¯è¢«æ”¾ç½®äºä»»ä½•ä½ æƒ³è¦åšä»£ç åˆ†å‰²çš„åœ°æ–¹ã€‚


# fstartTransition
é…åˆ React.useTransition ä½¿ç”¨ã€‚React.startTransition è®©ä½ æŠŠæä¾›çš„ fallback é‡Œé¢çš„æ›´æ–°æ ‡è®°ä¸º transitionsã€‚
*ç”¨æ³•*
```js
React.startTransition(callback)
```
*æ³¨æ„*
* è¿‡æ¸¡æœŸçš„æ›´æ–°ä¼šè¢«æ›´ç´§æ€¥çš„æ›´æ–°å–ä»£ï¼Œå¦‚ç‚¹å‡»æ“ä½œã€‚
* è¿‡æ¸¡æœŸçš„æ›´æ–°ä¸ä¼šæ˜¾ç¤ºé‡æ–°æŒ‚èµ·å†…å®¹çš„ fallbackï¼Œå…è®¸ç”¨æˆ·åœ¨æ¸²æŸ“æ›´æ–°æ—¶ç»§ç»­è¿›è¡Œäº¤äº’ã€‚ (TODO: æŸ¥çœ‹æ˜é‡‘å°å†Œ)

# fuseTransition
è¿”å›ä¸€ä¸ªçŠ¶æ€å€¼è¡¨ç¤ºè¿‡æ¸¡ä»»åŠ¡çš„ç­‰å¾…çŠ¶æ€ï¼Œä»¥åŠä¸€ä¸ªå¯åŠ¨è¯¥è¿‡æ¸¡ä»»åŠ¡çš„å‡½æ•°ã€‚
*ç”¨æ³•*
```js
function App() {
  const [isPending, startTransition] = React.useTransition();
  const [count, setCount] = React.useState(0);
  function handleClick() {
    React.startTransition(() => {
      setCount(c => c + 1);
    })
  }
  return (
    <div>
      {isPending && <Spinner />}
      <button onClick={handleClick}>{count}</button>
    </div>
  );
}
```
*æ³¨æ„*
* startTransition å…è®¸ä½ é€šè¿‡æ ‡è®°æ›´æ–°å°†æä¾›çš„å›è°ƒå‡½æ•°ä½œä¸ºä¸€ä¸ªè¿‡æ¸¡ä»»åŠ¡
* isPending æŒ‡ç¤ºè¿‡æ¸¡ä»»åŠ¡ä½•æ—¶æ´»è·ƒä»¥æ˜¾ç¤ºä¸€ä¸ªç­‰å¾…çŠ¶æ€
* è¿‡æ¸¡ä»»åŠ¡ä¸­è§¦å‘çš„æ›´æ–°ä¼šè®©æ›´ç´§æ€¥åœ°æ›´æ–°å…ˆè¿›è¡Œï¼Œæ¯”å¦‚ç‚¹å‡»ã€‚
* è¿‡æ¸¡ä»»åŠ¡ä¸­çš„æ›´æ–°å°†ä¸ä¼šå±•ç¤ºç”±äºå†æ¬¡æŒ‚èµ·è€Œå¯¼è‡´é™çº§çš„å†…å®¹ã€‚è¿™ä¸ªæœºåˆ¶å…è®¸ç”¨æˆ·åœ¨ React æ¸²æŸ“æ›´æ–°çš„æ—¶å€™ç»§ç»­ä¸å½“å‰å†…å®¹è¿›è¡Œäº¤äº’ã€‚


# fuseSyncExternalStore
**ä¸ºåº“ä½œè€…æä¾›çš„ï¼Œç”¨äºå°†åº“æ·±å…¥é›†æˆåˆ° React æ¨¡å‹ä¸­ï¼Œé€šå¸¸ä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨**
useSyncExternalStore æ˜¯ä¸€ä¸ªæ¨èç”¨äºè¯»å–å’Œè®¢é˜…å¤–éƒ¨æ•°æ®æºçš„ hookï¼Œå…¶æ–¹å¼ä¸é€‰æ‹©æ€§çš„ hydration å’Œæ—¶é—´åˆ‡ç‰‡ç­‰å¹¶å‘æ¸²æŸ“åŠŸèƒ½å…¼å®¹ã€‚

æ­¤æ–¹æ³•è¿”å›å­˜å‚¨çš„å€¼å¹¶æ¥å—ä¸‰ä¸ªå‚æ•°ï¼š
* subscribeï¼šç”¨äºæ³¨å†Œä¸€ä¸ªå›è°ƒå‡½æ•°ï¼Œå½“å­˜å‚¨å€¼å‘ç”Ÿæ›´æ”¹æ—¶è¢«è°ƒç”¨ã€‚
* getSnapshotï¼š è¿”å›å½“å‰å­˜å‚¨å€¼çš„å‡½æ•°ã€‚
* getServerSnapshotï¼šè¿”å›æœåŠ¡ç«¯æ¸²æŸ“æœŸé—´ä½¿ç”¨çš„å­˜å‚¨å€¼çš„å‡½æ•°
*ç”¨æ³•*
```jsx
const state = useSyncExternalStore(subscribe, getSnapshot[, getServerSnapshot]);
```

# fuseInsertionEffect
**ä¸ºåº“ä½œè€…æä¾›çš„ï¼Œç”¨äºå°†åº“æ·±å…¥é›†æˆåˆ° React æ¨¡å‹ä¸­ï¼Œé€šå¸¸ä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä»£ç ä¸­ä½¿ç”¨**
1. useInsertionEffect åœ¨æ‰€æœ‰ DOM çªå˜ä¹‹å‰åŒæ­¥è§¦å‘ã€‚ä¹Ÿå°±æ˜¯åœ¨ commit é˜¶æ®µçš„ beforeMutation é˜¶æ®µè§¦å‘ã€‚
2. ä½¿ç”¨å®ƒåœ¨è¯»å– useLayoutEffect ä¸­çš„å¸ƒå±€ä¹‹å‰å°†æ ·å¼æ³¨å…¥ DOMã€‚
3. ç”±äºè¿™ä¸ª hook çš„ä½œç”¨åŸŸæœ‰é™ï¼Œæ‰€ä»¥è¿™ä¸ª hook ä¸èƒ½è®¿é—® refsï¼Œä¹Ÿä¸èƒ½å®‰æ’æ›´æ–°ã€‚
*æ³¨æ„*
useInsertionEffect åº”ä»…é™äº css-in-js åº“ä½œè€…ä½¿ç”¨ã€‚ä¼˜å…ˆè€ƒè™‘ä½¿ç”¨ useEffect æˆ– useLayoutEffect æ¥æ›¿ä»£ã€‚
*ç”¨æ³•*
```jsx
useInsertionEffect(didUpdate);
```







# fsetStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥  fthis.setStateæ˜¯åŒæ­¥è¿˜æ˜¯å¼‚æ­¥
åœ¨`React`çš„ä¸åŒæ¨¡å¼ä¸‹ï¼Œ`this.setState`æœ‰ä¸åŒçš„è¡¨ç°:
1. åœ¨ legacy æ¨¡å¼ä¸‹ï¼Œå¦‚æœå‘½ä¸­äº† batchedUpdate é€»è¾‘ï¼Œå°±æ˜¯å¼‚æ­¥ï¼Œå¦‚æœæ²¡æœ‰å‘½ä¸­ batchedUpdate é€»è¾‘å°±æ˜¯åŒæ­¥ã€‚
2. åœ¨ concurrent æ¨¡å¼ä¸‹ï¼Œthis.setState å§‹ç»ˆè¡¨ç°ä¸ºå¼‚æ­¥ã€‚

# fé˜²æ­¢å­ç»„ä»¶é‡æ–°æ¸²æŸ“ fæ€§èƒ½ä¼˜åŒ–
1. React.memo(function SonComponent() {}, function areEqual(prevProps, nextProps) {...})
2. useMemo(() => <>{...SonComponent}</>, [])
3. PureComponent æµ…æ¯”è¾ƒ æ›´æ–°å‰åçš„props å’Œ æ›´æ–°å‰åçš„state
4. shouldComponentUpdate(nextProps, nextState)

åœ¨ React ä¸­ï¼Œæ§åˆ¶ç»„ä»¶æ˜¯å¦æ¸²æŸ“æœ‰ä¸‰ä¸ªæ–¹é¢: props, state å’Œ context, åªè¦è¿™ä¸‰è€…éƒ½ä¸å˜ï¼Œç»„ä»¶å°±ä¸ä¼šæ¸²æŸ“ã€‚
å¦‚æœæ˜¯çˆ¶ç»„ä»¶å¼•èµ·çš„å­ç»„ä»¶æ¸²æŸ“ï¼Œä¹Ÿå°±æ˜¯è¯´å­ç»„ä»¶çš„ state å’Œ context éƒ½ä¸å˜ï¼Œé‚£ä¹ˆåªéœ€è¦æ§åˆ¶ props ä¸å˜å³å¯ã€‚ä½†æ˜¯ React çš„é»˜è®¤ props æ¯”è¾ƒç­–ç•¥æ˜¯`å¼•ç”¨æ¯”è¾ƒ`ï¼Œè€Œä¸”æ¯æ¬¡æ›´æ–° props éƒ½æ˜¯ä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ï¼Œé‚£ä¹ˆå³ä½¿æ›´æ–°å‰å props çš„å±æ€§æ²¡æœ‰ä»»ä½•æ”¹å˜ï¼Œå­ç»„ä»¶ä¹Ÿä¼šé‡æ–°æ¸²æŸ“ã€‚
è¿™æ—¶å€™å°±è¦å°†`å¼•ç”¨æ¯”è¾ƒ`æ”¹ä¸º`æµ…æ¯”è¾ƒ`ï¼Œä½¿ç”¨ React çš„æ€§èƒ½ä¼˜åŒ– APIï¼Œå¦‚ React.memo, useMemo, PureComponent, shouldComponentUpdateã€‚


## fPureComponent   class Component extends React.PureComponent
ä»¥æµ…æ¯”è¾ƒæ›´æ–°å‰åçš„ prop å’Œ state çš„æ–¹å¼æ¥å®ç°äº† shouldComponentã€‚
## fshouldComponentUpdate
shouldComponentUpdate(nextProps, nextState), è¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œå†³å®šç±»ç»„ä»¶æ˜¯å¦é‡æ–°æ¸²æŸ“ã€‚

# fhooks
## è®²æ¦‚å¿µ
Hook æ˜¯ React 16.8.0 çš„æ–°å¢ç‰¹æ€§ã€‚å®ƒè®©å‡½æ•°ç»„ä»¶ä¹Ÿèƒ½åšç±»ç»„ä»¶èƒ½åšçš„å¤§éƒ¨åˆ†çš„äº‹ï¼Œé€šè¿‡hookså‡½æ•°ç»„ä»¶æœ‰äº†è‡ªå·±çš„çŠ¶æ€ï¼Œå¯ä»¥å¤„ç†å‰¯ä½œç”¨ï¼Œèƒ½è·å– ref ç­‰ã€‚
## è¯´ç”¨é€” (fè§£å†³äº†ä»€ä¹ˆé—®é¢˜ fé—®é¢˜)
1. åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘
2. ç»„åˆå¤æ‚ç»„ä»¶çš„ç›¸å…³é€»è¾‘
3. æ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹

* åœ¨ç»„ä»¶ä¹‹é—´å¤ç”¨çŠ¶æ€é€»è¾‘
ä½¿ç”¨ Hook å¯ä»¥ä»ç»„ä»¶ä¸­æå–çŠ¶æ€é€»è¾‘ï¼Œä½¿å¾—è¿™äº›é€»è¾‘å¯ä»¥å•ç‹¬æµ‹è¯•å¹¶å¤ç”¨ã€‚Hook ä½¿ä½ åœ¨æ— éœ€ä¿®æ”¹ç»„ä»¶ç»“æ„çš„æƒ…å†µä¸‹å¤ç”¨çŠ¶æ€é€»è¾‘ã€‚è¿™ä½¿å¾—åœ¨ç»„ä»¶é—´æˆ–ç¤¾åŒºå†…å…±äº« Hook å˜å¾—æ›´ä¾¿æ·ã€‚
* ç»„åˆå¤æ‚ç»„ä»¶çš„ç›¸å…³é€»è¾‘
åœ¨ hook ä¹‹å‰æˆ‘ä»¬å¸¸å¸¸åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ç¼–å†™ä¸€äº›ä¸ç›¸å…³çš„ä»£ç ï¼Œæ¯”å¦‚åœ¨ componentDidMount ä¸­è·å–æ•°æ®ï¼ŒåŒæ—¶åˆè®¾ç½®äº‹ä»¶ç›‘å¬ï¼Œç„¶ååœ¨ componentWillUnmount ä¸­æ¸…é™¤ï¼Œè¿™æ ·å°±æŠŠä¸ç›¸å…³çš„ä»£ç ç»„åˆåœ¨ä¸€èµ·ï¼Œè€Œç›¸å…³çš„ä»£ç åˆåˆ†åœ¨äº†ä¸åŒåœ°æ–¹ï¼Œè¿™ç§å†™æ³•å¾ˆå®¹æ˜“å¼•èµ· bugã€‚
ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒHook å°†ç»„ä»¶ä¸­ç›¸äº’å…³è”çš„éƒ¨åˆ†æ‹†åˆ†æˆæ›´å°çš„å‡½æ•°ï¼ˆæ¯”å¦‚è®¾ç½®è®¢é˜…æˆ–è¯·æ±‚æ•°æ®ï¼‰ï¼Œè€Œå¹¶éå¼ºåˆ¶æŒ‰ç…§ç”Ÿå‘½å‘¨æœŸåˆ’åˆ†ã€‚
* æ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹
æ ¹æ®å®˜ç½‘çš„æè¿°, ç¼–å†™ class çš„æ–¹å¼ä½¿å¾—ä»£ç ä¸èƒ½å¾ˆå¥½åœ°å‹ç¼©ï¼Œå¹¶ä¸”ä¼šä½¿çƒ­é‡è½½å‡ºç°ä¸ç¨³å®šçš„æƒ…å†µã€‚ä¸ºäº†è§£å†³è¿™äº›é—®é¢˜ï¼ŒHook ä½¿ä½ åœ¨é class çš„æƒ…å†µä¸‹å¯ä»¥ä½¿ç”¨æ›´å¤šçš„ React ç‰¹æ€§, æ¯”å¦‚ç»´æŠ¤çŠ¶æ€ï¼Œå¤„ç†å‰¯ä½œç”¨ï¼Œè·å–refç­‰ã€‚è¿™æ ·å°±èƒ½ç”¨å‡½æ•°ç»„ä»¶æ›¿ä»£å¤§éƒ¨åˆ†ç±»ç»„ä»¶ï¼Œæ‹¥æŠ±å‡½æ•°å¼ç¼–ç¨‹ã€‚
`å®˜ç½‘: æˆ‘ä»¬å‡†å¤‡è®© Hook è¦†ç›–æ‰€æœ‰ class ç»„ä»¶çš„ä½¿ç”¨åœºæ™¯ï¼Œä½†æ˜¯æˆ‘ä»¬å°†ç»§ç»­ä¸º class ç»„ä»¶æä¾›æ”¯æŒã€‚`
## ä¼˜ç¼ºç‚¹

## fåŸç† fhooksåŸç† fä½ æ¥èŠä¸€ä¸‹hooksçš„åŸç†æ˜¯ä»€ä¹ˆ
hooks æœ¬è´¨ä¸Šæ˜¯ä¸€æ¡å•å‘é“¾è¡¨ï¼Œå­˜åœ¨äºfiber.memoizedStateï¼Œå½“ç„¶è¿™ä¸ªfiberå¾—æ˜¯å‡½æ•°ç»„ä»¶çš„fiberï¼Œé€šè¿‡ next æŒ‡é’ˆå°†æœ¬å‡½æ•°ç»„ä»¶çš„æ‰€æœ‰ hook é¡ºåºè¿æ¥åˆ°ä¸€èµ·:`fiber.memoizedState: hook1 -> hook2 -> ...`ã€‚

å‡½æ•°ç»„ä»¶ render æ—¶ï¼Œåˆ†ä¸º é¦–æ¬¡æ‰§è¡Œ å’Œ æ›´æ–° ä¸¤ç§æƒ…å†µã€‚ä»¥ useState ä¸ºä¾‹, `é¦–æ¬¡æ‰§è¡Œ`åšçš„æ˜¯ç”Ÿæˆ hook åŠ å…¥åˆ° fiber.memoizedState, è¿”å›åˆå§‹å€¼å’Œæ›´æ–°å‡½æ•°ä¹Ÿå°±æ˜¯dispatchAction; è€Œ`æ›´æ–°`æ˜¯æ‰§è¡Œ dispathActionï¼Œæœ¬è´¨ä¸Šå°±æ˜¯åˆ›å»º update å¯¹è±¡ï¼ŒåŠ å…¥åˆ° hook.queue.pending;

ä¸¤ç§æƒ…å†µéƒ½ä¼šä¾æ¬¡æ‰§è¡Œ hook, è®¡ç®—æ¯ä¸ª hook çš„çŠ¶æ€ï¼Œæ”¾åˆ° hook.memoizedState ä¸­ã€‚çŠ¶æ€è®¡ç®—æ˜¯åŸºäº hook.queue.pending è¿™æ¡ç¯çŠ¶é“¾è¡¨ï¼Œé“¾è¡¨ä¸Šçš„æ¯ä¸ªç»“æ„éƒ½æ˜¯ä¸€ä¸ª Update å¯¹è±¡ï¼Œupdate ä¸Šä¿å­˜ç€ç”¨æˆ·ä¼ å…¥çš„action, æ¯”å¦‚ setCount(c => c + 1), å…¶ä¸­çš„ c => c + 1 è¿™ä¸ªç®­å¤´å‡½æ•°å°±æ˜¯ actionã€‚ Hook ä¼šåŸºäº hook åŸæœ‰çš„ memoizedStateï¼Œç„¶åæ‰§è¡Œä¸€åœˆçš„ç¯çŠ¶é“¾è¡¨ä¸Šçš„ Update å¯¹è±¡ï¼Œæœ€ç»ˆå¾—åˆ°æ–°çš„ memoizedState è¿”å›ã€‚
```ts
interface Hook {
  baseQueue: null;
  baseState: unknown;  // åŸºäºæŸä¸ªçŠ¶æ€ï¼Œè®¡ç®—æœ¬æ¬¡ memoizedState
  memoizedState: unknown;   // æœ¬ hook çš„çŠ¶æ€å€¼
  next: Hook;  // ä¸‹ä¸€ä¸ª hook
  queue: Update;  // hook ä¸Šçš„ Update å¯¹è±¡
}
interface Update {
  action: Function | unknown;  // å¦‚ c=>c+1
  next: Update;  // æŒ‡å‘ä¸‹ä¸€ä¸ª update å¯¹è±¡
}
```
## fä½¿ç”¨hooksçš„æ³¨æ„äº‹é¡¹
1. çº¦å®šå‘½åä»¥useXXå¼€å¤´
2. å¿…é¡»åœ¨å‡½æ•°ç»„ä»¶å†…ä½¿ç”¨ï¼Œä¸èƒ½åœ¨ç±»ç»„ä»¶é‡Œä½¿ç”¨
3. å¿…é¡»åœ¨å‡½æ•°ç»„ä»¶ä½œç”¨åŸŸé¡¶éƒ¨ä½¿ç”¨
4. æ¯æ¬¡ç»„ä»¶renderä¸èƒ½æ‰“ä¹±hooksçš„æ‰§è¡Œé¡ºåºï¼Œæ¯”å¦‚æ”¾åˆ°æ¡ä»¶è¯­å¥ã€æˆ–å¾ªç¯è¯­å¥ä¸­æ˜¯ä¸è¡Œçš„ã€‚
## ä¸ºä»€ä¹ˆhookä¸èƒ½æ”¾åœ¨æ¡ä»¶è¯­å¥ä¸­
æ¯æ¬¡Appæ›´æ–°çš„æ—¶å€™ï¼Œhookséƒ½å¿…é¡»éµç…§å®Œå…¨ä¸€æ ·çš„é¡ºåºï¼Œå› ä¸ºå®ƒä»¬æ˜¯ä¿å­˜åœ¨ä¸€æ¡é“¾è¡¨ä¸­çš„ï¼Œæ›´æ–°çš„æ—¶å€™åªä¼šæŒ‰é“¾è¡¨é¡ºåºæ›´æ–°ã€‚å¦‚æœæ‰“ä¹±äº†é¡ºåºï¼Œé“¾è¡¨ç»“ç‚¹å’Œç»„ä»¶hookçš„å¯¹åº”å…³ç³»å°±ä¼šå‡ºé”™ã€‚
## fè‡ªå®šä¹‰hooks fReactå¦‚ä½•å°è£…è‡ªå®šä¹‰hooks
è‡ªå®šä¹‰ Hook æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå…¶åç§°ä»¥ â€œuseâ€ å¼€å¤´ï¼Œå‡½æ•°å†…éƒ¨å¯ä»¥è°ƒç”¨å…¶ä»–çš„ Hookã€‚
è‡ªå®šä¹‰ hook çš„ state æ˜¯å®Œå…¨ç‹¬ç«‹çš„ï¼Œhook çš„æ¯æ¬¡è°ƒç”¨éƒ½æœ‰ä¸€ä¸ªå®Œå…¨ç‹¬ç«‹çš„ stateï¼Œå› ä¸ºåœ¨åŒä¸€ä¸ªç»„ä»¶ä¸­å¤šæ¬¡è°ƒç”¨åŒä¸€ä¸ªè‡ªå®šä¹‰hookï¼Œå®ƒä»¬çš„çŠ¶æ€ä¹Ÿäº’ä¸å½±å“ã€‚
### fè‡ªå®šä¹‰hookså¿…é¡»ä»¥"use"å¼€å¤´å—ï¼Ÿ
å¿…é¡»å¦‚æ­¤ã€‚è¿™ä¸ªçº¦å®šéå¸¸é‡è¦ã€‚ä¸éµå¾ªçš„è¯ï¼Œç”±äºæ— æ³•åˆ¤æ–­æŸä¸ªå‡½æ•°æ˜¯å¦åŒ…å«å¯¹å…¶å†…éƒ¨ Hook çš„è°ƒç”¨ï¼ŒReact å°†æ— æ³•è‡ªåŠ¨æ£€æŸ¥ä½ çš„ Hook æ˜¯å¦è¿åäº† Hook çš„è§„åˆ™ã€‚
### fè‡ªå®šä¹‰hooksçš„ç”¨é€”
è‡ªå®šä¹‰ Hook è§£å†³äº†ä»¥å‰åœ¨ React ç»„ä»¶ä¸­æ— æ³•çµæ´»å…±äº«é€»è¾‘çš„é—®é¢˜ã€‚
*å®šä¹‰è‡ªå®šä¹‰hooks*
```js
import { useState, useEffect } from 'react';
function useFriendStatus(friendID) {
  const [isOnline, setIsOnline] = useState(null);
  useEffect(() => {
    function handleStatusChange(status) {
      setIsOnline(status.isOnline);
    }
    ChatAPI.subscribeToFriendStatus(friendID, handleStatusChange);
    return () => {
      ChatAPI.unsubscribeFromFriendStatus(friendID, handleStatusChange);
    };
  });
  return isOnline;
}
```
*ä½¿ç”¨è‡ªå®šä¹‰hooks*
```js
function FriendStatus(props) {
  const isOnline = useFriendStatus(props.friend.id);
  if (isOnline === null) {
    return 'Loading...';
  }
  return isOnline ? 'Online' : 'Offline';
}
```

## fhookç›¸å…³å±æ€§
fiber.memoizedStateæ˜¯ hook
hook.memoizedState æ˜¯å½“å‰ hook çš„çŠ¶æ€
hook.next æ˜¯ä¸‹ä¸€ä¸ªhook
hook.queue.pending æ˜¯æœ€åä¸€ä¸ª updateï¼Œä¸‹ä¸€ä¸ªå°±æ˜¯ç¬¬ä¸€ä¸ª updateã€‚
update.nextæ˜¯ä¸‹ä¸€ä¸ªupdate
update.actionæ˜¯å¾…æ›´æ–°çš„æ“ä½œï¼Œå¦‚ num => num+1
## fuseEffect feffect
React åœ¨å®Œæˆå¯¹ DOM çš„æ›´æ”¹åè¿è¡Œâ€œå‰¯ä½œç”¨â€å‡½æ•°ã€‚åŸç†æ˜¯åœ¨ commit é˜¶æ®µç»“æŸåå¼‚æ­¥æ‰§è¡Œã€‚
## fuseLayoutEffect
åœ¨ commit é˜¶æ®µç»“æŸæ—¶åŒæ­¥æ‰§è¡Œã€‚
## fuseStateå‘ç”Ÿäº†ä»€ä¹ˆ
åŸºäºè¿™ä¸ªuseStateä»£è¡¨çš„hookçš„hook.memoizedStateï¼Œéå† hook çš„ update ç¯: hook.queue.pendingï¼Œé¡ºåºæ‰§è¡Œæ‰€æœ‰çš„updateï¼Œä¸Šä¸€ä¸ªçš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªçš„è¾“å…¥ï¼Œä¸€ç›´è®¡ç®—åˆ°æœ€åï¼Œå¾—åˆ°æœ€ç»ˆçš„stateï¼Œä½œä¸ºæ–°çš„hook.memoizedStateï¼Œæ¸…ç©ºæœ¬hookçš„updateç¯ï¼Œè¿”å›ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„çš„ç¬¬0é¡¹æ˜¯æ›´æ–°åçš„çŠ¶æ€ï¼Œç¬¬1é¡¹æ˜¯dispatch, ç„¶åæ›´æ–°å‡½æ•°ç»„ä»¶ã€‚
## fsetNumå‘ç”Ÿäº†ä»€ä¹ˆ
setNum -> æ”¾ç½®updateå¯¹è±¡åˆ°hookä¸Š(å¤šæ¬¡setNumå°±æœ‰å¤šä¸ªupdateå¯¹è±¡ï¼Œå½¢æˆä¸€ä¸ªç¯)Appé‡æ–°render -> æ‰§è¡Œ useState -> å¾—åˆ°æ–°çŠ¶æ€num -> åŸºäºæ–°çŠ¶æ€å¾—åˆ°æ–°çš„ReactElement -> æ¸²æŸ“æ–°è§†å›¾

## fé«˜é˜¶ç»„ä»¶ fHOC
é«˜é˜¶ç»„ä»¶æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œä»¥Reactç»„ä»¶ä¸ºå‚æ•°ï¼Œç»è¿‡ä¸€ç³»åˆ—é€»è¾‘ï¼Œè¿”å›ä¸€ä¸ªæ–°çš„ç»„ä»¶ã€‚
`const EnhancedComponent = higherOrderComponent(WrappedComponent);`
é«˜é˜¶ç»„ä»¶ä¸ä¼šä¿®æ”¹ä¼ å…¥çš„ç»„ä»¶ï¼Œå®ƒæ˜¯é€šè¿‡å°†ç»„ä»¶åŒ…è£…åœ¨å®¹å™¨ç»„ä»¶ä¸­æ¥ç»„æˆæ–°ç»„ä»¶ï¼Œé«˜é˜¶ç»„ä»¶æ˜¯çº¯å‡½æ•°ï¼Œæ²¡æœ‰å‰¯ä½œç”¨ã€‚
### ä¾‹å­
react-redux çš„ connect å‡½æ•°ã€‚

# fäº‹ä»¶æœºåˆ¶ fReactäº‹ä»¶æœºåˆ¶
1. Reactå¹¶ä¸æ˜¯å°†äº‹ä»¶å›è°ƒç»‘å®šåˆ°çœŸå®çš„DOMä¸Šï¼Œè€Œæ˜¯åœ¨æ ¹ç»“ç‚¹å¤„ç›‘å¬æ‰€æœ‰çš„äº‹ä»¶ã€‚åœ¨ v17 ä¹‹å‰ï¼ŒReact äº‹ä»¶æ˜¯ç»‘å®šåœ¨ document ä¸Šçš„ï¼Œv17 ä»¥åäº‹ä»¶ç»‘å®šåˆ°äº†åº”ç”¨å¯¹åº”çš„å®¹å™¨ç»“ç‚¹ä¸Š(#root)ã€‚
2. React å®ç°äº†è‡ªå·±çš„ä¸€å¥—äº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œå½“äº‹ä»¶å‘ç”Ÿå¹¶ä¸”å†’æ³¡åˆ°æ ¹ç»“ç‚¹tå¤„çš„æ—¶å€™ï¼ŒReactå°†äº‹ä»¶å†…å®¹å°è£…å¹¶äº¤ç”±çœŸæ­£çš„å¤„ç†å‡½æ•°è¿è¡Œã€‚è¿™æ ·çš„æ–¹å¼ä¸ä»…ä»…å‡å°‘äº†å†…å­˜çš„æ¶ˆè€—ï¼Œè¿˜èƒ½åœ¨ç»„ä»¶æŒ‚è½½é”€æ¯æ—¶ç»Ÿä¸€è®¢é˜…å’Œç§»é™¤äº‹ä»¶ã€‚
3. React çš„äº‹ä»¶å¹¶ä¸æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œè€Œæ˜¯ React åˆæˆçš„äº‹ä»¶ï¼Œæ¯”å¦‚ onClick æ˜¯ç”± click åˆæˆï¼ŒonChange æ˜¯ç”± blur ï¼Œchange ï¼Œfocus ç­‰å¤šä¸ªäº‹ä»¶åˆæˆã€‚
## fä¸ºä»€ä¹ˆè¦æœ‰äº‹ä»¶ç³»ç»Ÿ
æœ‰ä¸¤ç‚¹åŸå› ï¼Œä¸€æ˜¯å…¼å®¹ä¸åŒæµè§ˆå™¨ï¼ŒäºŒæ˜¯ä¸ºäº†ç»Ÿä¸€ç®¡ç†ã€‚
1. å¯¹äºä¸åŒçš„æµè§ˆå™¨ï¼Œå¯¹äº‹ä»¶å­˜åœ¨ä¸åŒçš„å…¼å®¹æ€§ï¼ŒReact æƒ³å®ç°ä¸€ä¸ªå…¼å®¹å…¨æµè§ˆå™¨çš„æ¡†æ¶ï¼Œ ä¸ºäº†å®ç°è¿™ä¸ªç›®æ ‡å°±éœ€è¦åˆ›å»ºä¸€ä¸ªå…¼å®¹å…¨æµè§ˆå™¨çš„äº‹ä»¶ç³»ç»Ÿï¼Œä»¥æ­¤æŠ¹å¹³ä¸åŒæµè§ˆå™¨çš„å·®å¼‚ã€‚
2. v17 ä¹‹å‰ React äº‹ä»¶éƒ½æ˜¯ç»‘å®šåœ¨ document ä¸Šï¼Œv17 ä¹‹å React æŠŠäº‹ä»¶ç»‘å®šåœ¨åº”ç”¨å¯¹åº”çš„å®¹å™¨ container ä¸Šï¼Œå°†äº‹ä»¶ç»‘å®šåœ¨åŒä¸€å®¹å™¨ç»Ÿä¸€ç®¡ç†ï¼Œé˜²æ­¢å¾ˆå¤šäº‹ä»¶ç›´æ¥ç»‘å®šåœ¨åŸç”Ÿçš„ DOM å…ƒç´ ä¸Šã€‚è¿™æ ·çš„æ–¹å¼ä¸ä»…å‡å°‘äº†å†…å­˜æ¶ˆè€—ï¼Œè¿˜èƒ½åœ¨ç»„ä»¶æŒ‚è½½é”€æ¯æ—¶ç»Ÿä¸€è®¢é˜…å’Œç§»é™¤äº‹ä»¶ã€‚
## fåˆæˆäº‹ä»¶
React åº”ç”¨ä¸­ï¼Œå…ƒç´ ç»‘å®šçš„äº‹ä»¶å¹¶ä¸æ˜¯åŸç”Ÿäº‹ä»¶ï¼Œè€Œæ˜¯ React åˆæˆçš„äº‹ä»¶ï¼Œæ¯”å¦‚ onClick æ˜¯ç”± click åˆæˆï¼ŒonChange æ˜¯ç”± blur ï¼Œchange ï¼Œfocus ç­‰å¤šä¸ªäº‹ä»¶åˆæˆã€‚
### ä¼˜ç‚¹
- å…¼å®¹æ‰€æœ‰æµè§ˆå™¨ï¼Œæ›´å¥½çš„è·¨å¹³å°ï¼›
- å°†äº‹ä»¶ç»Ÿä¸€å­˜æ”¾åœ¨ä¸€ä¸ªæ•°ç»„ï¼Œé¿å…é¢‘ç¹çš„æ–°å¢ä¸åˆ é™¤ï¼ˆåƒåœ¾å›æ”¶ï¼‰ã€‚
- æ–¹ä¾¿ react ç»Ÿä¸€ç®¡ç†å’Œäº‹åŠ¡æœºåˆ¶ã€‚
## fReactäº‹ä»¶ vs fåŸç”Ÿäº‹ä»¶
1. å¯¹äºäº‹ä»¶åç§°å‘½åæ–¹å¼ï¼ŒåŸç”Ÿäº‹ä»¶ä¸ºå…¨å°å†™ï¼Œreact äº‹ä»¶é‡‡ç”¨å°é©¼å³°ï¼›
2. å¯¹äºäº‹ä»¶å‡½æ•°å¤„ç†è¯­æ³•ï¼ŒåŸç”Ÿäº‹ä»¶ä¸ºå­—ç¬¦ä¸²ï¼Œreact äº‹ä»¶ä¸ºå‡½æ•°ï¼›
3. react äº‹ä»¶ä¸èƒ½é‡‡ç”¨ return false çš„æ–¹å¼æ¥é˜»æ­¢æµè§ˆå™¨çš„é»˜è®¤è¡Œä¸ºï¼Œè€Œå¿…é¡»è¦åœ°æ˜ç¡®åœ°è°ƒç”¨`preventDefault()`æ¥é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚
## fäº‹ä»¶æ•è· fäº‹ä»¶å†’æ³¡ fReactæ˜¯å¦‚ä½•æ¨¡æ‹Ÿäº‹ä»¶æ•è·å’Œäº‹ä»¶å†’æ³¡çš„
å½“äº‹ä»¶è§¦å‘æ—¶ï¼ŒReactä¼šä»å½“å‰fiberå‘ä¸Šéå†ï¼Œé‡åˆ°ç»‘å®šäº†äº‹ä»¶çš„fiberæ—¶ï¼Œå°±ä¼šç”¨ä¸€ä¸ªæ•°ç»„æ”¶é›†äº‹ä»¶ï¼ŒæŠŠå†’æ³¡é˜¶æ®µçš„äº‹ä»¶å›è°ƒç”¨pushæ”¾è¿›å»ï¼Œä¹Ÿå°±æ˜¯æ’å…¥åˆ°æ•°ç»„å°¾ï¼Œè€ŒæŠŠæ•è·é˜¶æ®µçš„äº‹ä»¶å›è°ƒç”¨unshiftæ”¾è¿›å»ï¼Œä¹Ÿå°±æ˜¯æ’å…¥åˆ°æ•°ç»„å¤´ã€‚ç›´åˆ°éå†åˆ°æ ¹ç»“ç‚¹ã€‚ç„¶åä¾æ¬¡æ‰§è¡Œæ•°ç»„é‡Œçš„äº‹ä»¶å›è°ƒã€‚
## fé˜»æ­¢é»˜è®¤è¡Œä¸º
åœ¨Reactåº”ç”¨ä¸­ï¼Œå¯ä»¥ç”¨`e.preventDefault()`é˜»æ­¢äº‹ä»¶é»˜è®¤è¡Œä¸ºï¼Œä½†ä¸èƒ½ç”¨ç±»ä¼¼åŸç”Ÿäº‹ä»¶çš„`return false`æ¥é˜»æ­¢ã€‚
è¿™æ˜¯å› ä¸ºåœ¨ React ä¸­ç»™å…ƒç´ çš„äº‹ä»¶å¹¶ä¸æ˜¯çœŸæ­£çš„äº‹ä»¶å¤„ç†å‡½æ•°ï¼Œå¯¼è‡´`return false`æ–¹æ³•åœ¨ React åº”ç”¨ä¸­å¤±å»äº†ä½œç”¨ï¼ŒpreventDefault ä¹Ÿæ˜¯å•ç‹¬å¤„ç†çš„ã€‚

# ffiber fReactä¸ºä»€ä¹ˆéœ€è¦fiber?
## fä»€ä¹ˆæ˜¯Fiber
Fiber åŒ…å«ä¸‰å±‚å«ä¹‰: åè°ƒå™¨çš„æ¶æ„ã€é™æ€çš„æ•°æ®ç»“æ„ã€åŠ¨æ€çš„å·¥ä½œå•å…ƒã€‚
1. æ¶æ„
ä½œä¸ºåè°ƒå™¨çš„æ¶æ„æ¥è¯´ï¼Œä¹‹å‰ React15 çš„åè°ƒå™¨é‡‡ç”¨é€’å½’çš„æ–¹å¼æ‰§è¡Œï¼Œæ•°æ®ä¿å­˜åœ¨é€’å½’è°ƒç”¨æ ˆä¸­ï¼Œæ‰€ä»¥è¢«ç§°ä¸º stack reconcilerã€‚
è€Œ React16 çš„åè°ƒå™¨åŸºäº Fiber ç»“ç‚¹å®ç°ï¼Œè¢«æˆä¸º fiber reconcilerã€‚
2. æ•°æ®ç»“æ„
ä½œä¸ºé™æ€æ•°æ®ç»“æ„æ¥è¯´ï¼Œæ¯ä¸ª fiber ç»“ç‚¹å¯¹åº”ä¸€ä¸ª React elementï¼Œä¿å­˜äº†è¯¥ç»„ä»¶çš„ç±»å‹ï¼ˆå‡½æ•°ç»„ä»¶/ç±»ç»„ä»¶/åŸç”Ÿç»„ä»¶...ï¼‰ã€å¯¹åº”çš„DOMèŠ‚ç‚¹ç­‰ä¿¡æ¯ã€‚
3. å·¥ä½œå•å…ƒ
ä½œä¸ºåŠ¨æ€çš„å·¥ä½œå•å…ƒæ¥è¯´ï¼Œæ¯ä¸ªFiberèŠ‚ç‚¹ä¿å­˜äº†æœ¬æ¬¡æ›´æ–°ä¸­è¯¥ç»„ä»¶æ”¹å˜çš„çŠ¶æ€ã€è¦æ‰§è¡Œçš„å·¥ä½œï¼ˆéœ€è¦è¢«åˆ é™¤/è¢«æ’å…¥é¡µé¢ä¸­/è¢«æ›´æ–°...ï¼‰ã€‚

## fçº¤ç¨‹
Fiber å¹¶ä¸æ˜¯è®¡ç®—æœºæœ¯è¯­ä¸­çš„æ–°åè¯ï¼Œä»–çš„ä¸­æ–‡ç¿»è¯‘å«åšçº¤ç¨‹ï¼Œä¸è¿›ç¨‹ï¼ˆProcessï¼‰ã€çº¿ç¨‹ï¼ˆThreadï¼‰ã€åç¨‹ï¼ˆCoroutineï¼‰åŒä¸ºç¨‹åºæ‰§è¡Œè¿‡ç¨‹ã€‚åœ¨å¾ˆå¤šæ–‡ç« ä¸­å°†çº¤ç¨‹ç†è§£ä¸ºåç¨‹çš„ä¸€ç§å®ç°ã€‚åœ¨JSä¸­ï¼Œåç¨‹çš„å®ç°ä¾¿æ˜¯Generatorã€‚æ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥å°†çº¤ç¨‹(Fiber)ã€åç¨‹(Generator)ç†è§£ä¸ºä»£æ•°æ•ˆåº”æ€æƒ³åœ¨JSä¸­çš„ä½“ç°ã€‚

Fiber ä¹Ÿç§°åç¨‹æˆ–è€…çº¤ç¨‹ã€‚å®ƒå’Œçº¿ç¨‹å¹¶ä¸ä¸€æ ·ï¼Œåç¨‹æœ¬èº«æ˜¯æ²¡æœ‰å¹¶å‘æˆ–è€…å¹¶è¡Œèƒ½åŠ›çš„ï¼ˆéœ€è¦é…åˆçº¿ç¨‹ï¼‰ï¼Œå®ƒåªæ˜¯ä¸€ç§æ§åˆ¶æµç¨‹çš„è®©å‡ºæœºåˆ¶ã€‚è®©å‡º CPU çš„æ‰§è¡Œæƒï¼Œè®© CPU èƒ½åœ¨è¿™æ®µæ—¶é—´æ‰§è¡Œå…¶ä»–çš„æ“ä½œã€‚æ¸²æŸ“çš„è¿‡ç¨‹å¯ä»¥è¢«ä¸­æ–­ï¼Œå¯ä»¥å°†æ§åˆ¶æƒäº¤å›æµè§ˆå™¨ï¼Œè®©ä½ç»™é«˜ä¼˜å…ˆçº§çš„ä»»åŠ¡ï¼Œæµè§ˆå™¨ç©ºé—²åå†æ¢å¤æ¸²æŸ“ã€‚

React Fiberå¯ä»¥ç†è§£ä¸º:
Reactå†…éƒ¨å®ç°çš„ä¸€å¥—çŠ¶æ€æ›´æ–°æœºåˆ¶ã€‚æ”¯æŒä»»åŠ¡ä¸åŒä¼˜å…ˆçº§ï¼Œå¯ä¸­æ–­ä¸æ¢å¤ï¼Œå¹¶ä¸”æ¢å¤åå¯ä»¥å¤ç”¨ä¹‹å‰çš„ä¸­é—´çŠ¶æ€ã€‚å…¶ä¸­æ¯ä¸ªä»»åŠ¡æ›´æ–°å•å…ƒä¸ºReact Elementå¯¹åº”çš„FiberèŠ‚ç‚¹ã€‚

## fä¸ºä»€ä¹ˆéœ€è¦fiber
React åœ¨ 16 ç‰ˆæœ¬ä¹‹å‰ï¼Œç”¨çš„æ˜¯`é€’å½’`çš„æ–¹å¼æ›´æ–°ç»„ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªåŒæ­¥çš„æ›´æ–°ï¼Œä¸€æ—¦å¼€å§‹å°±æ— æ³•ä¸­æ–­ï¼Œå¦‚æœè¿™ä¸€æ¬¡æ›´æ–°è¶…è¿‡äº†æµè§ˆå™¨ä¸€å¸§çš„æ—¶é—´ï¼Œä¸€èˆ¬æ˜¯ 16 msï¼Œç”¨æˆ·äº¤äº’å°±ä¼šå¡é¡¿ã€‚æ˜¾ç„¶è¿™ä¸æ»¡è¶³ React å¿«é€Ÿå“åº”çš„ç†å¿µï¼Œæ‰€ä»¥ 16 ç‰ˆæœ¬ä»¥å React æå‡ºäº†æ–°çš„ fiber æ¶æ„ï¼Œç”¨`å¼‚æ­¥å¯ä¸­æ–­çš„æ›´æ–°`æ›¿ä»£`åŒæ­¥çš„æ›´æ–°`ã€‚

## ffiberè§£å†³äº†å“ªäº›é—®é¢˜
1. è§£å†³äº† React15 åŒæ­¥æ›´æ–°é€ æˆçš„ç”¨æˆ·å¡é¡¿é—®é¢˜
2. æ”¯æŒé«˜ä¼˜å…ˆçº§ä»»åŠ¡æ’é˜Ÿä½ä¼˜å…ˆçº§ä»»åŠ¡
3. ä»»åŠ¡ä¸­æ–­ä»¥åå¯ä»¥æ¢å¤ï¼Œå¤ç”¨ä¹‹å‰çš„ä¸­é—´çŠ¶æ€

## fæ¶æ„ fReactçš„æ¶æ„ 16ä¹‹å‰æ˜¯ä»€ä¹ˆæ¶æ„ï¼Ÿ16ä¹‹åæ˜¯ä»€ä¹ˆæ¶æ„ï¼Ÿä¸ºä»€ä¹ˆè¿™ä¹ˆæ¼”å˜ï¼Ÿ
16 ä¹‹å‰ï¼ŒReact åªæœ‰ åè°ƒå™¨ å’Œ æ¸²æŸ“å™¨; 16 ä¹‹åï¼ŒReact æœ‰ è°ƒåº¦å™¨ã€åè°ƒå™¨ã€æ¸²æŸ“å™¨ã€‚
å„æ¨¡å—åŠŸèƒ½å¦‚ä¸‹:
* è°ƒåº¦å™¨: è°ƒåº¦ä»»åŠ¡çš„ä¼˜å…ˆçº§ï¼Œé«˜ä¼˜ä»»åŠ¡ä¼˜å…ˆè¿›å…¥åè°ƒå™¨ã€‚
* åè°ƒå™¨: è´Ÿè´£æ‰¾å‡ºå˜åŒ–çš„ç»„ä»¶ã€‚
* æ¸²æŸ“å™¨: è´Ÿè´£å°†å˜åŒ–çš„ç»„ä»¶æ¸²æŸ“åˆ°é¡µé¢ä¸Šã€‚
### Scheduler
Scheduler æ˜¯ React å›¢é˜Ÿä¸º requestIdleCallback åšçš„ polyfill,  å› ä¸º rIC æœ‰ä»¥ä¸‹ç¼ºç‚¹:
1. æµè§ˆå™¨å…¼å®¹æ€§ä¸å¥½;
2. è§¦å‘é¢‘ç‡ä¸ç¨³å®šï¼Œå—å¾ˆå¤šå› ç´ å½±å“ã€‚æ¯”å¦‚å½“æˆ‘ä»¬çš„æµè§ˆå™¨åˆ‡æ¢tabåï¼Œä¹‹å‰tabæ³¨å†Œçš„requestIdleCallbackè§¦å‘çš„é¢‘ç‡ä¼šå˜å¾—å¾ˆä½ã€‚
### Reconciler
Reconciler ä»é€’å½’çš„æ–¹å¼ï¼Œå˜ä¸ºå¯ä¸­æ–­çš„å¾ªç¯æ–¹å¼ï¼Œæ¯æ¬¡å¾ªç¯éƒ½ä¼šè°ƒç”¨ shouldYield(), å¦‚æœå½“å‰æœ‰å‰©ä½™æ—¶é—´æ‰ç»§ç»­ï¼Œæ²¡æœ‰å°±ä¸­æ–­å¾ªç¯ã€‚
* é‚£ä¹ˆReact16æ˜¯å¦‚ä½•è§£å†³ä¸­æ–­æ›´æ–°æ—¶DOMæ¸²æŸ“ä¸å®Œå…¨çš„é—®é¢˜å‘¢ï¼Ÿ
åœ¨React16ä¸­ï¼ŒReconcilerä¸Rendererä¸å†æ˜¯äº¤æ›¿å·¥ä½œã€‚å½“Schedulerå°†ä»»åŠ¡äº¤ç»™Reconcileråï¼ŒReconcilerä¼šä¸ºå˜åŒ–çš„è™šæ‹ŸDOMæ‰“ä¸Šä»£è¡¨å¢/åˆ /æ›´æ–°çš„æ ‡è®°ã€‚æ•´ä¸ªSchedulerä¸Reconcilerçš„å·¥ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œä¸å±•ç¤ºåˆ°è§†å›¾ä¸Šã€‚åªæœ‰å½“æ‰€æœ‰ç»„ä»¶éƒ½å®ŒæˆReconcilerçš„å·¥ä½œï¼Œæ‰ä¼šç»Ÿä¸€äº¤ç»™Rendererï¼Œæ¸²æŸ“è§†å›¾ã€‚
### Renderer
Rendereræ ¹æ®Reconcilerä¸ºè™šæ‹ŸDOMæ‰“çš„æ ‡è®°ï¼ŒåŒæ­¥æ‰§è¡Œå¯¹åº”çš„DOMæ“ä½œã€‚


# fè™šæ‹ŸDOM fvdom fVirtual DOM
è™šæ‹ŸDOMæœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥å¯¹è±¡æè¿°äº†ä¸€ä¸ªUIç»“ç‚¹æ‰€å¯¹åº”çš„ä¸€äº›å¿…è¦ä¿¡æ¯ã€‚React çš„è™šæ‹ŸDOM å¯ä»¥ç†è§£ä¸º ReactElement å’Œ Fiberï¼Œå› ä¸º DIFF æ˜¯æ¯”è¾ƒè¿™ä¸¤è€…ã€‚
## ä¸ºä»€ä¹ˆéœ€è¦è™šæ‹ŸDOM?
1. çœŸå®DOMçš„å±æ€§å¤ªå¤šäº†ï¼Œå¦‚æœç›´æ¥å¯¹çœŸå®DOMè¿›diffï¼Œæ¶ˆè€—æ€§èƒ½éå¸¸å¤§ã€‚
æ¯”å¦‚ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°å†™ document.createElement('div') å¾—åˆ°ä¸€ä¸ªç»“ç‚¹ï¼Œæ‰“å¼€è¿™ä¸ªç»“ç‚¹ï¼Œä¼šçœ‹åˆ°ä¸Šé¢çš„å±æ€§éå¸¸å¤šï¼Œå¦‚æœç›´æ¥åš diffï¼Œè¦å¯¹æ¯”è¿™ä¹ˆå¤šå±æ€§ï¼Œæ¶ˆè€—çš„æ€§èƒ½å°±éå¸¸å¤§ã€‚è€Œè™šæ‹Ÿ dom ä¸€èˆ¬å°±æ˜¯ { type: 'div', props: {} }, åªéœ€è¦å¯¹æ¯”è¿™å‡ ä¸ªå±æ€§ï¼Œæ€§èƒ½æŸè€—å¤§å¹…é™ä½ã€‚
2. å¯¹çœŸå®DOMè¿›è¡Œcurdå¾ˆæ¶ˆè€—æ€§èƒ½ï¼Œå¯ä»¥ç”¨è™šæ‹ŸDOMä»£æ›¿ã€‚
## è¯´ç”¨é€”
1. æ¸²æŸ“
2. æ¯”å¯¹ dom diff

# fDomDiff fDiff fReactDomDiff fdiffç®—æ³•
Diffç®—æ³•åœ¨æ¯”è¾ƒ`æ›´æ–°å‰è™šæ‹Ÿdomæ ‘`å’Œ`æ›´æ–°åè™šæ‹Ÿdomæ ‘`ï¼Œæ‰¾å‡ºä¸¤è€…ä¹‹é—´çš„å·®å¼‚ã€‚React çš„ DOM DIFFï¼Œæ˜¯å¯¹æ¯”è€ fiber (current.child) å’Œ æ–°äº§ç”Ÿçš„ ReactElementï¼Œä»è€Œç”Ÿæˆ workInProgress.childã€‚
## è¯´ç”¨é€” fä¸ºä»€ä¹ˆéœ€è¦diffç®—æ³•ï¼Ÿ
ä¸ºäº†æé«˜æ¸²æŸ“æ€§èƒ½ï¼Œæ¯æ¬¡æ›´æ–°åº”è¯¥åªæ¸²æŸ“æœ‰å˜åŒ–çš„éƒ¨åˆ†ï¼Œè€Œ`diffç®—æ³•`çš„ç›®çš„å°±æ˜¯è¦æ‰¾å‡ºè¿™ä¸ªå˜åŒ–çš„éƒ¨åˆ†ã€‚
## åˆ¶å®šè§„åˆ™
ä¸ºäº†æé«˜å¯¹æ¯”çš„æ€§èƒ½ï¼ŒReact åœ¨ Dom Diff æ—¶åˆ¶å®šäº†ä¸‰ä¸ªè§„åˆ™:
1. åªæ¯”è¾ƒåŒçº§å…ƒç´ ï¼Œä¸è·¨å±‚çº§å¯¹æ¯”ã€‚
2. ä¸åŒç±»å‹å¯¹åº”ä¸åŒå…ƒç´ ï¼Œå¦‚ div å’Œ spanï¼ŒReact ä¸ä¼šå°è¯•å¤ç”¨ä¸åŒç±»å‹çš„å…ƒç´ ã€‚
3. é€šè¿‡ key æ¥æ ‡è¯†æ›´æ–°å‰åæ˜¯åŒä¸€ä¸ªç»“ç‚¹ã€‚
## æ—¶é—´å¤æ‚åº¦
æ—¶é—´å¤æ‚åº¦ O(N)ï¼ŒN æ˜¯è¿™ä¸€å±‚çš„ç»“ç‚¹ä¸ªæ•°ã€‚å› ä¸ºç®—æ³•æœ¬è´¨å°±æ˜¯éå†ä¸€æ¬¡è€ç»“ç‚¹ï¼Œéå†ä¸€æ¬¡æ–°ç»“ç‚¹ã€‚
è¿™ä¸ªé—®é¢˜å®é™…ä¸Šæ˜¯: åŒä¸€å±‚ä¸Šçš„ç¼–è¾‘è·ç¦»é—®é¢˜ã€‚
## å…·ä½“è¿‡ç¨‹  fDomDiffçš„è¿‡ç¨‹
React çš„ Dom Diff åˆ†ä¸º å•ç»“ç‚¹diff å’Œ å¤šç»“ç‚¹diffã€‚è¿™é‡Œçš„`å•ç»“ç‚¹`æˆ–`å¤šç»“ç‚¹`æŒ‡çš„æ˜¯æ–°ç»“ç‚¹ï¼Œæ–°ç»“ç‚¹åªæœ‰å•ä¸ªå°±æ˜¯å•ç»“ç‚¹diffï¼Œæ–°ç»“ç‚¹æœ‰å¤šä¸ªå°±æ˜¯å¤šç»“ç‚¹diffã€‚
### å•ç»“ç‚¹diff
å› ä¸ºåªæœ‰ä¸€ä¸ªæ–°ç»“ç‚¹ï¼Œæ‰€ä»¥é€šè¿‡ sibling æŒ‡é’ˆéå†è€ç»“ç‚¹å³å¯ï¼Œéå†è¿‡ç¨‹æ¯”è¾ƒæ–°è€ç»“ç‚¹çš„ type å’Œ key, æœ‰ä¸‰ç§æƒ…å†µ:
1. å¦‚æœ type å’Œ key éƒ½ç›¸åŒï¼Œè¯´æ˜è¿™ä¸ªè€ç»“ç‚¹å¯ä»¥å¤ç”¨ï¼Œæ ‡è®°å‰©ä½™çš„è€ç»“ç‚¹ä¸º`åˆ é™¤`ï¼Œè¿”å›è¿™ä¸ªå¯å¤ç”¨çš„è€ç»“ç‚¹ã€‚
2. å¦‚æœ key ç›¸åŒï¼Œä½†æ˜¯ type ä¸åŒï¼Œè‡ªå·±å’Œå¼Ÿå¼Ÿéƒ½æ ‡è®°ä¸ºåˆ é™¤ï¼Œè·³å‡ºéå†ï¼Œç›´æ¥æ–°å»ºä¸€ä¸ªç»“ç‚¹ï¼Œæ ‡è®°`æ’å…¥`ã€‚
3. å¦‚æœ key ä¸åŒï¼Œåˆ é™¤è¿™ä¸ªè€ç»“ç‚¹ï¼Œç»§ç»­éå†ä¸‹ä¸€ä¸ªè€ç»“ç‚¹ã€‚å¦‚æœéå†å®Œäº†è¿˜æ˜¯æ²¡æœ‰ç»“ç‚¹å¯å¤ç”¨ï¼Œé‚£å°±æ–°å»ºä¸€ä¸ªç»“ç‚¹ï¼Œæ ‡è®°`æ’å…¥`ã€‚
ğŸŒ°ä¾‹å­
æ¯”å¦‚: liA,liB,liC => liB
DIFFè¿‡ç¨‹å°±æ˜¯:  
liA => liB âŒ Deletion
liB => liB âœ… å¤ç”¨
liC        âŒ Deletion
### å¤šç»“ç‚¹diff
åˆ†ä¸ºå››æ­¥:
1. åŒæ—¶éå†æ–°è€ç»“ç‚¹ï¼Œå¤„ç†æ›´æ–° (æ–°ç»“ç‚¹ç”¨ç´¢å¼•:newIdx++, è€ç»“ç‚¹ç”¨æŒ‡é’ˆ: oldFiber = oldFiber.sibling)
2. å¦‚æœæœ‰å‰©ä½™çš„è€ç»“ç‚¹ï¼Œåˆ é™¤å¤šä½™çš„è€ç»“ç‚¹ (deleteRemainingChildren)
3. å¦‚æœæœ‰å‰©ä½™çš„æ–°ç»“ç‚¹ï¼Œå¢åŠ æ–°ç»“ç‚¹ 
4. å¤„ç†ç§»åŠ¨çš„æƒ…å†µ

* å¤„ç†ç§»åŠ¨çš„æƒ…å†µ
åœ¨ç¬¬ä¸€æ­¥å¤„ç†æ›´æ–°æ—¶ï¼Œå¯èƒ½å›  key ä¸åŒè€Œç›´æ¥è·³å‡ºå¾ªç¯ï¼Œè¿™æ ·ä¹Ÿè·³è¿‡äº†äºŒã€ä¸‰æ­¥ï¼Œç›´æ¥æ¥åˆ°ç¬¬å››æ­¥å¤„ç†ç§»åŠ¨ã€‚
å¤„ç†ç§»åŠ¨çš„æ­¥éª¤:
1. å°†å‰©ä½™çš„è€ç»“ç‚¹éƒ½æ”¾å…¥ä¸€ä¸ª Map ä¸­ï¼Œä»¥ oldFiber.key æˆ– oldFiber.index ä¸ºé”®ï¼Œä»¥ oldFiberæœ¬èº«ä¸ºå€¼ã€‚
2. è®¾ç½®ä¸€ä¸ª lastPlacedIndex å˜é‡ï¼Œä»£è¡¨æœ€åä¸€ä¸ªå¯å¤ç”¨çš„ç»“ç‚¹åœ¨ oldFibers ä¸­çš„ä½ç½®ç´¢å¼•ã€‚
3. éå†å‰©ä½™çš„æ–°ç»“ç‚¹ï¼Œé€šè¿‡ newChild.key æŸ¥æ‰¾ Map ä¸­æ˜¯å¦æœ‰å¯å¤ç”¨çš„è€ç»“ç‚¹ï¼Œå¯å¤ç”¨æ˜¯æŒ‡ key å’Œ type éƒ½ç›¸åŒ:
  
  * å¦‚æœæœ‰ï¼Œå¤ç”¨è€ç»“ç‚¹ï¼Œç„¶åæ¯”è¾ƒ lastPlacedIndex å’Œ oldFiber.indexï¼Œç”±äºç»“ç‚¹æ˜¯ä»å·¦å¾€å³éå†çš„ï¼Œåœ¨æ²¡æœ‰ç§»åŠ¨çš„æƒ…å†µä¸‹ï¼Œæ–°è€ index åº”è¯¥åŒæ­¥å˜å¤§ï¼Œ
    æœ¬æ¬¡å¤ç”¨çš„ oldFiber åº”è¯¥åœ¨æœ€åä¸€ä¸ªå¯å¤ç”¨çš„ oldFiber å³è¾¹ï¼Œä¹Ÿå°±æ˜¯è¯´ oldFiber.index åº”è¯¥ >= lastPlacedIndexï¼Œä½†æ˜¯æ¯”è¾ƒç»“æœæœ‰ä¸¤ç§æƒ…å†µ:

    - oldFiber.index < lastPlacedIndex, è¯´æ˜ `æœ¬æ¬¡å¤ç”¨çš„oldFiber` åœ¨`æœ€åä¸€ä¸ªå¯å¤ç”¨çš„oldFiber`å·¦è¾¹ï¼Œä¹Ÿå°±è¯´æ˜`æœ¬æ¬¡å¤ç”¨çš„oldFiber`åœ¨æ›´æ–°åå‘å³ç§»åŠ¨äº†ï¼Œæ‰€ä»¥ newFiber æ ‡è®°ä¸º`ç§»åŠ¨`(ç§»åŠ¨ä¹Ÿå°±æ˜¯Placementï¼Œåœ¨è€ç»“ç‚¹å­˜åœ¨çš„æƒ…å†µä¸‹ï¼Œæ’å…¥å°±æ˜¯ç§»åŠ¨), lastPlacedIndex ä¸å˜ã€‚

    - oldFiber.index >= lastPlacedIndex, è¯´æ˜ `æœ¬æ¬¡å¤ç”¨çš„oldFiber` åœ¨`æœ€åä¸€ä¸ªå¯å¤ç”¨çš„oldFiber`å³è¾¹ï¼Œè¿™è¯´æ˜ `æœ¬æ¬¡å¤ç”¨çš„oldFiber` æ²¡æœ‰ç§»åŠ¨, æœ¬æ¬¡å¤ç”¨çš„oldFiber`è¦ä½œä¸º`æœ€åä¸€ä¸ªå¯å¤ç”¨çš„oldFiber`ç»™ä¸‹ä¸€è½®å¾ªç¯çš„ oldFiber ä½œå‚ç…§ç‰©ï¼Œæ‰€ä»¥æ›´æ–° lastPlacedIndex ä¸º oldFiber.indexã€‚

  * å¦‚æœæ²¡æœ‰ï¼Œåˆ›å»ºæ–°çš„ fiberã€‚

### å¤šç»“ç‚¹diffçš„ä¾‹å­
liA,liB,liC,liD,liE,liF  => liA,liC,liE,liB,liG,liD
 0   1   2   3   4   5       0   1   2   3   4   5

1. åŒæ—¶éå†æ–°è€ç»“ç‚¹ï¼ŒliA=>liA å¤ç”¨ï¼ŒliB=>liC key ä¸åŒè·³å‡ºï¼Œè¿›å…¥`å¤„ç†ç§»åŠ¨`çš„ç¯èŠ‚ã€‚
2. å°†è€ liB ä»¥åçš„æ‰€æœ‰è€ç»“ç‚¹æ”¾å…¥ Map, éå†å‰©ä½™çš„æ–°ç»“ç‚¹ã€‚
3. lastPlacedIndex è®¾ç½®ä¸º0ï¼Œåœ¨ Map ä¸­æŸ¥æ‰¾æ–°ç»“ç‚¹ liCï¼Œå‘ç°æœ‰å¯ä»¥å¤ç”¨çš„ç»“ç‚¹ï¼Œäºæ˜¯å¤ç”¨ï¼ŒåŒæ—¶æ›´æ–° lastPlacedIndex ä¸º oldLiC.index = 2ã€‚
4. ç»§ç»­éå†æ–°ç»“ç‚¹ï¼ŒliE å¯å¤ç”¨ï¼Œè€Œä¸” oldLiE.index >= lastPlacedIndexï¼Œæ²¡æœ‰ç§»åŠ¨ï¼Œæ— éœ€æ ‡è®°ï¼Œæ›´æ–° lastPlacedIndex ä¸º oldLiE.index = 4ã€‚
5. ç»§ç»­éå†æ–°ç»“ç‚¹ï¼ŒliB å¯å¤ç”¨ï¼Œä½†æ­¤æ—¶ oldLiB.index < lastPlacedIndexï¼Œè¯´æ˜ liB ç§»åŠ¨äº†ï¼Œæ ‡è®° `Placement`ã€‚
6. ç»§ç»­éå†æ–°ç»“ç‚¹ï¼ŒliG ä¸åœ¨è€ç»“ç‚¹ä¸­ï¼Œæ ‡è®°`Placement`ã€‚
7. ç»§ç»­éå†æ–°ç»“ç‚¹ï¼ŒliD å¯å¤ç”¨ï¼ŒoldLiD.index < lastPlacedIndex, æ ‡è®° `Placement`ã€‚ 

                 A        B       C              D                 E               F   
                 A        C       E              B                 G               D
                å¤ç”¨     å¤ç”¨     å¤ç”¨         å¤ç”¨(ç§»åŠ¨)          ä¸å¯å¤ç”¨(æ’å…¥)    å¤ç”¨(ç§»åŠ¨)
lastPlaceIndex   0        2       4              4                 4               4
                >=       >=      >=    oldIndex < lastPlacedIndex       oldIndex < lastPlacedIndex

### èµ„æ–™
å‰ç«¯ä¸é»‘å®¢å®‰å…¨  01:24:52
Electron+æ¸¸æˆå¼•æ“+å‰ç«¯é»‘å®¢ä¸å®‰å…¨ 00:10:41  Dom Diff: vue vs react


# fuseEffect å’Œ fcomponentDidMount æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ
useEffect çš„å›è°ƒå‡½æ•° create ä¼šåœ¨ commit é˜¶æ®µç»“æŸåï¼Œå¼‚æ­¥æ‰§è¡Œã€‚
componentDidMount ä¼šåœ¨mutationé˜¶æ®µå®Œæˆè§†å›¾æ›´æ–°åï¼Œåœ¨layouté˜¶æ®µåŒæ­¥æ‰§è¡Œã€‚

è¿™é“é¢˜åœ¨æ¢è®¨çš„å…¶å®æ˜¯ useEffect çš„ create å‡½æ•° fn ä¸ cDM çš„æ‰§è¡Œæ—¶æœºæœ‰ä»€ä¹ˆä¸åŒï¼Œè€Œ fn çš„æ‰§è¡Œä¾èµ–äº useEffect çš„ç¬¬äºŒä¸ªå‚æ•° depsã€‚æ‰€ä»¥è¿™é“é¢˜å¯ä»¥æ¦‚æ‹¬ä¸º2ä¸ªé—®é¢˜ï¼š
1 deps å¦‚ä½•å½±å“ fn çš„æ‰§è¡Œï¼Ÿ
2 fn å’Œ cDM çš„æ‰§è¡Œæ—¶æœºï¼Ÿ

* ç¬¬1ä¸ªé—®é¢˜
useEfffectçš„æ ‡è®°æ˜¯ Passiveã€‚
useEffect(fn)      æ¯æ¬¡ç»„ä»¶æ›´æ–°ï¼Œéƒ½ä¼šæ‰“æ ‡è®°
useEffect(fn,[])   åªæœ‰mount ä¼šæ‰“æ ‡è®°
useEffect(fn, deps) åªæœ‰mountæ—¶ï¼Œæˆ–depsé‡Œçš„å…ƒç´ æ”¹äº†æ‰ä¼šæ‰“æ ‡è®°

class ç»„ä»¶ä¼šåœ¨ mountæ—¶æ ‡è®° Placementã€‚

- Placementç»“ç‚¹
åœ¨ mutationé˜¶æ®µè°ƒç”¨ appendChildæ–¹æ³•ï¼Œç„¶ååœ¨ layout é˜¶æ®µè°ƒç”¨ cDMæ–¹æ³•ã€‚
- Passive ç»“ç‚¹
åœ¨ layout é˜¶æ®µç»“æŸåï¼Œå¼‚æ­¥è°ƒç”¨ useEffectçš„createå‡½æ•°ã€‚

* ç¬¬2ä¸ªé—®é¢˜
useEffectçš„å›è°ƒå‡½æ•°create ä¼šåœ¨commit é˜¶æ®µç»“æŸåå¼‚æ­¥æ‰§è¡Œ
cDMä¼šåœ¨mutationé˜¶æ®µå®Œæˆè§†å›¾æ›´æ–°åï¼Œåœ¨layouté˜¶æ®µåŒæ­¥æ‰§è¡Œã€‚

useLayoutEffect å’Œ cDM çš„è°ƒç”¨æ—¶æœºä¸€è‡´ã€‚


==============================  fWebpack  ==============================
# fwebpackç”Ÿå‘½å‘¨æœŸ få·¥ä½œæµç¨‹ fæ„å»ºæµç¨‹
1. åˆå§‹åŒ–å‚æ•°
ä»é…ç½®æ–‡ä»¶å’Œ shell è¯­å¥ä¸­è¯»å–ä¸åˆå¹¶å‚æ•°ï¼Œå¾—å‡ºæœ€ç»ˆçš„å‚æ•°ã€‚
2. å¼€å§‹ç¼–è¯‘
ç”¨ä¸Šä¸€æ­¥å¾—åˆ°çš„å‚æ•°åˆå§‹åŒ– Compiler å¯¹è±¡ï¼ŒåŠ è½½æ‰€æœ‰é…ç½®çš„æ’ä»¶ï¼Œæ‰§è¡Œå¯¹è±¡çš„ run æ–¹æ³•å¼€å§‹ç¼–è¯‘ã€‚
3. å¯»æ‰¾å…¥å£
æ ¹æ® entry æ‰¾åˆ°æ‰€æœ‰ å…¥å£æ–‡ä»¶ã€‚
4. ç¼–è¯‘æ¨¡å—
ä»æ¯ä¸ªå…¥å£æ–‡ä»¶å‡ºå‘ï¼Œè°ƒç”¨æ‰€æœ‰é…ç½®çš„ loader å¯¹æ¨¡å—è¿›è¡Œç¿»è¯‘ï¼Œå†æ‰¾å‡ºè¯¥æ¨¡å—ä¾èµ–çš„æ¨¡å—ï¼Œå†é€’å½’æœ¬æ­¥éª¤ç›´åˆ°æ‰€æœ‰å…¥å£ä¾èµ–çš„æ–‡ä»¶éƒ½ç»è¿‡äº†æœ¬æ­¥éª¤çš„å¤„ç†ã€‚
5. è¾“å‡ºèµ„æº
æ ¹æ®å…¥å£å’Œæ¨¡å—ä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œç»„è£…æˆä¸€ä¸ªä¸ªåŒ…å«å¤šä¸ªæ¨¡å—çš„ chunkï¼Œå†æŠŠæ¯ä¸ª chunk è½¬æ¢æˆä¸€ä¸ªå•ç‹¬çš„æ–‡ä»¶åŠ å…¥åˆ°è¾“å‡ºåˆ—è¡¨ï¼Œè¿™æ­¥æ˜¯å¯ä»¥ä¿®æ”¹è¾“å‡ºå†…å®¹çš„æœ€åæœºä¼šã€‚
6. å†™å…¥ç£ç›˜
åœ¨ç¡®å®šå¥½è¾“å‡ºå†…å®¹åï¼Œæ ¹æ®é…ç½®ç¡®å®šè¾“å‡ºçš„è·¯å¾„å’Œæ–‡ä»¶åï¼ŒæŠŠæ–‡ä»¶å†…å®¹å†™å…¥åˆ°æ–‡ä»¶ç³»ç»Ÿã€‚
åœ¨ä»¥ä¸Šè¿‡ç¨‹ä¸­ï¼Œwebapck ä¼šåœ¨ç‰¹å®šçš„æ—¶é—´ç‚¹å¹¿æ’­å‡ºç‰¹å®šçš„äº‹ä»¶ï¼Œæ’ä»¶åœ¨ç›‘å¬åˆ°æ„Ÿå…´è¶£çš„äº‹ä»¶åä¼šæ‰§è¡Œç‰¹å®šçš„é€»è¾‘ï¼Œä»è€Œå¯ä»¥æ”¹å˜ webpack çš„è¿è¡Œç»“æœã€‚

# fchunk
1. chunk æ˜¯ webpack æ‰“åŒ…è¿‡ç¨‹ä¸­ï¼Œä¸€ç³»åˆ—å…³è” module çš„é›†åˆã€‚æ¯”å¦‚æœ‰ 3 ç§æ–¹å¼å¯ä»¥äº§ç”Ÿ chunk:
*å…¥å£ chunk*
webpack ä»å…¥å£æ¨¡å—å¼€å§‹æ‰“åŒ…ï¼Œå…¥å£æ¨¡å—å¼•ç”¨å…¶ä»–æ¨¡å—ï¼Œæ¨¡å—å†å¼•ç”¨æ¨¡å—ï¼Œä»å…¥å£å¼€å§‹çš„ä¸€ç³»åˆ—æ¨¡å—ï¼Œå°±å½¢æˆäº†ä¸€ä¸ª chunkï¼Œå¤šä¸ªå…¥å£å°±æœ‰å¤šä¸ª chunkã€‚
*æŒ‰éœ€åŠ è½½*
æŒ‰éœ€åŠ è½½çš„æ¨¡å—ï¼Œæ¯”å¦‚ import(..), ä¹Ÿä¼šäº§ç”Ÿ chunkã€‚
*ä»£ç åˆ†å‰²*
åœ¨ webpack ä¸­é…ç½®ä»£ç åˆ†å‰²ï¼Œä¼šäº§ç”Ÿ chunkã€‚
2. chunk åœ¨æ„å»ºå®Œæˆæ—¶ï¼Œå°±å‘ˆç°ä¸º bundleï¼Œä¸€èˆ¬æ¥è¯´ï¼Œä¸€ä¸ª chunk å¯¹åº”ä¸€ä¸ª bundleã€‚ä½†æ˜¯ä¹Ÿæœ‰ä¾‹å¤–ï¼Œæ¯”å¦‚ devtool è®¾ç½®ä¸º source-map æ—¶ï¼Œä¸€ä¸ª chunk ä¼šæ‰“åŒ…å‡º 2 ä¸ª bundleï¼Œä¸€ä¸ªæ˜¯ main.jsï¼Œä¸€ä¸ªæ˜¯ main.js.map, chunk æ˜¯è¿‡ç¨‹ä¸­çš„ä»£ç å—ï¼Œbundle æ˜¯ç»“æœçš„ä»£ç å—ã€‚
## få…¥å£chunk
ä¸‹é¢çš„ä¾‹å­ä¼šç”Ÿæˆ 2 ä¸ª chunk, ä½¿ç”¨ entry çš„ key å‘½åï¼Œæ‰€ä»¥ä¸€ä¸ªå« pageA, ä¸€ä¸ªå« pageBã€‚
```js
module.exports = {
  entry: {
    pageA: ...,
    pageB: ...,
  },
  output: {
    filename: '[name].bundle.js'
  }
}
```
## fæŒ‰éœ€åŠ è½½
åœ¨ä»£ç ä¸­ä½¿ç”¨ import(...)æŒ‰éœ€åŠ è½½ä»£ç ï¼Œåœ¨ webpack é…ç½®ä¸­ä½¿ç”¨ output.chunkFilename ä¸ºå¼‚æ­¥åŠ è½½çš„ chunk å‘½åã€‚
```js
module.exports = {
  entry: ...,
  output: {
    ...,
    chunkFilename: '[name].async.bundle.js'
  }
}
```
## fä»£ç åˆ†å‰²
é…ç½® splitChunks å¯ä»¥å°† entry, å¼‚æ­¥ chunk ç­‰ chunk è¿›ä¸€æ­¥åˆ†å‰²ï¼Œäº§ç”Ÿæ›´å¤š chunkã€‚
```js
module.exports = {
  optimization: {
    splitChunks: {
      ....
    }
  }
}
```

# fTreeShaking fæ‘‡æ ‘ä¼˜åŒ–
Tree-Shaking æ˜¯ä¸€ç§åŸºäº ES Module è§„èŒƒçš„ æ— ç”¨ä»£ç æ¸…é™¤(Dead Code Elimination) æŠ€æœ¯ï¼Œå®ƒä¼šåœ¨è¿è¡Œè¿‡ç¨‹ä¸­é™æ€åˆ†ææ¨¡å—ä¹‹é—´çš„å¯¼å…¥å¯¼å‡ºï¼Œç¡®å®š ESM æ¨¡å—ä¸­å“ªäº›å¯¼å‡ºå€¼æœªæ›¾å…¶å®ƒæ¨¡å—ä½¿ç”¨ï¼Œå¹¶å°†å…¶åˆ é™¤ï¼Œä»¥æ­¤å®ç°æ‰“åŒ…äº§ç‰©çš„ä¼˜åŒ–ã€‚
## få¼€å¯TreeShaking  fåœ¨ webpack ä¸­å¼€å¯ TreeShaking
1. ä½¿ç”¨ ESM è§„èŒƒç¼–å†™æ¨¡å—ä»£ç ã€‚
2. é…ç½® optimization.usedExports ä¸º trueï¼Œå¯åŠ¨æ ‡è®°åŠŸèƒ½ã€‚
3. å¯åŠ¨ä»£ç ä¼˜åŒ–åŠŸèƒ½ï¼Œå¯ä»¥é€šè¿‡å¦‚ä¸‹æ–¹å¼çš„ä»»æ„ä¸€ç§å®ç°:
  - é…ç½® mode = production
  - é…ç½® optimization.minimize = true
  - æä¾› optimization.minimizer æ•°ç»„
ä¾‹å¦‚, åœ¨ webpack.config.js ä¸­:
```js
module.exports = {
  entry: "./src/index",
  mode: "production",
  devtool: false,
  optimization: {
    usedExports: true,
  },
};
```
## fES6æ¨¡å—ç‰¹ç‚¹ fESMè§„èŒƒ
1. åªèƒ½ä½œä¸ºæ¨¡å—é¡¶å±‚çš„è¯­å¥å‡ºç°ã€‚
2. å¯¼å…¥å¯¼å‡ºçš„æ¨¡å—ååªèƒ½æ˜¯å­—ç¬¦ä¸²å¸¸é‡ã€‚
3. å¯¼å…¥çš„å€¼æ˜¯ä¸å¯å˜çš„ã€‚
ä»¥ä¸Šä¸‰ç‚¹ï¼Œå†³å®šäº† ESM æ˜¯å®Œå…¨é™æ€çš„ï¼Œè·Ÿè¿è¡Œæ—¶æ— å…³ï¼Œæ‰€ä»¥å¯ä»¥åœ¨ç¼–è¯‘æ—¶ï¼Œä»ä»£ç å­—é¢é‡ä¸­å°±æ¨æ–­å‡ºå“ªäº›æ¨¡å—å€¼æœªè¢«ä½¿ç”¨ï¼Œè¿™æ˜¯å®ç° Tree Shaking æŠ€æœ¯çš„å¿…è¦æ¡ä»¶ã€‚
```js
// index.js ä¸»æ¨¡å—
import {bar} from './bar';
console.log(bar);  // ä»…ä½¿ç”¨äº† bar, æ²¡æœ‰ä½¿ç”¨ foo
// bar.js æ¨¡å—
export const bar = 'bar';
export const foo = 'foo';   // foo æœªè¢«ä½¿ç”¨, ä¼šè¢«è§†ä½œæ— ç”¨ä»£ç è€Œåˆ é™¤ã€‚
```
## fåŸç† fTreeShakingåŸç†
Webpack ä¸­ï¼ŒTree-shaking åˆ†ä¸ºä¸¤æ­¥:
1. ç¬¬ä¸€æ­¥ã€å…ˆæ ‡è®°å‡ºæ¨¡å—å¯¼å‡ºå€¼ä¸­å“ªäº›æ²¡æœ‰è¢«ç”¨è¿‡ã€‚
2. ç¬¬äºŒæ­¥ã€ä½¿ç”¨ Terseræˆ–UglifyJS ç­‰ DCEå·¥å…· åˆ æ‰è¿™äº›æ²¡è¢«ç”¨åˆ°çš„å¯¼å‡ºè¯­å¥ã€‚
æ ‡è®°è¿‡ç¨‹å¤§è‡´å¯åˆ’åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤:
  - Make é˜¶æ®µï¼Œæ”¶é›†æ¨¡å—å¯¼å‡ºå˜é‡å¹¶è®°å½•åˆ°æ¨¡å—ä¾èµ–å…³ç³»å›¾ ModuleGraph å˜é‡ä¸­ã€‚
  - Seal é˜¶æ®µï¼Œéå† ModuleGraph æ ‡è®°æ¨¡å—å¯¼å‡ºå˜é‡æœ‰æ²¡æœ‰è¢«ä½¿ç”¨ã€‚
  - ç”Ÿæˆäº§ç‰©æ—¶ï¼Œè‹¥å˜é‡æ²¡æœ‰è¢«å…¶å®ƒæ¨¡å—ä½¿ç”¨åˆ™åˆ é™¤å¯¹åº”çš„å¯¼å‡ºè¯­å¥ã€‚

ğŸŒ°ä¾‹å­
```js
{
  // bar æ¨¡å—
  "./src/bar.js":  ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {
    __webpack_require__.d(__webpack_exports__, {
      "bar": () => (/* binding */ bar)
      // è¿™é‡Œå°±æ²¡æœ‰å¯¼å‡º fooï¼Œå› ä¸ºæ ¹æœ¬æ²¡ç”¨åˆ°ã€‚
      // åé¢ Terser æ’ä»¶çš„ DCE åŠŸèƒ½ï¼Œä¼šæŠŠ const foo = 'foo' æ‘‡æ‰ã€‚
    });
    /* unused harmony export foo */
    const bar = 'bar';
    const foo = 'foo';
  })
}
```

# fç¼“å­˜ fwebpackç¼“å­˜
1. cache-loader
2. hard-source-webpack-plugin
3. babel-loader
## hard-source-webpack-plugin
æ¨¡å—è§£æçš„é˜¶æ®µï¼Œç”¨äºä¸­é—´çš„ç¼“å­˜ã€‚
ç¬¬ä¸€æ¬¡æ˜¯æ­£å¸¸çš„æ„å»ºé€Ÿåº¦ï¼Œä½†æ˜¯ä¼šä¿å­˜ç¼“å­˜æ•°æ®åˆ° xxx é‡Œã€‚
ç¬¬äºŒæ¬¡ä½¿ç”¨ç¼“å­˜æ¥æ„å»ºï¼Œé€Ÿåº¦æå‡ã€‚
## babel-loader
è¿è¡Œä»¥åï¼Œä¼šå¢åŠ  node_modules/.cache/babel-loader è¿™ä¸ªæ–‡ä»¶å¤¹ï¼Œå­˜æ”¾ç¼“å­˜çš„æ–‡ä»¶
```js
{
  loader: 'babel-loader',
  options: {
    cacheDirectory: true // å¼€å¯ç¼“å­˜
  }
}
```

# fçƒ­æ›´æ–°ğŸ”¥ fdevServer
å®‰è£… webpack-dev-server, ç„¶ååœ¨å¼€å‘ç¯å¢ƒä¸‹é…ç½®:
```js
devServer: {
  contentBase: join(__dirname, '../dist'),
  hot: true,
  port: 3000
}
```
TODO: åŸç†

## fç³»ç»Ÿçº§é€šçŸ¥
æŒ‰ä¸‹ Ctrl+S, æ— éœ€æŸ¥çœ‹ terminal, ç³»ç»Ÿä¼šé€šçŸ¥ä½ æˆåŠŸ/å¤±è´¥ã€‚åªéœ€å®‰è£… webpack-build-notifier, é…ç½®æ’ä»¶:
```js
plugins: [
  new WebpackBuildNotifierPlugin({
    title: "My Webpack Project",
    logo: path.resolve("./img/favicon.png"),
    suppressSuccess: true,
  })
]
```
