/**
 * æœ€é•¿å…¬å…±å­åºåˆ—

ç»™å®šä¸¤ä¸ªå­—ç¬¦ä¸²str1å’Œstr2ï¼Œ
è¿”å›žè¿™ä¸¤ä¸ªå­—ç¬¦ä¸²çš„æœ€é•¿å…¬å…±å­åºåˆ—é•¿åº¦

æ¯”å¦‚: str1 = â€œa12b3c456dâ€, str2 = â€œ1ef23ghi4j56kâ€
æœ€é•¿å…¬å…±å­åºåˆ—æ˜¯â€œ123456â€ï¼Œæ‰€ä»¥è¿”å›žé•¿åº¦6
 */

function longestCommonSubsequence(str1, str2) {
  if (!str1 || !str2) {
    return 0;
  }
  return dpWays(str1, str2);
  return proc(str1, str2, str1.length - 1, str2.length - 1);
}

function dpWays(str1, str2) {
  const N = str1.length;
  const M = str2.length;
  const dp = Array(N).fill(0).map(_ => new Uint32Array(M));  // N*M

  dp[0][0] = str1[0] === str2[0] ? 1 : 0;

  // ç¬¬ä¸€è¡Œ
  for (let j = 1; j < M; j++) {
    dp[0][j] = str1[0] === str2[j] ? 1 : dp[0][j - 1];
  }

  // ç¬¬ä¸€åˆ—
  for (let i = 1; i < N; i++) {
    dp[i][0] = str1[i] === str2[0] ? 1 : dp[i - 1][0];
  }

  // æ™®éä½ç½®
  for (let i = 1; i < N; i++) {
    for (let j = 1; j < M; j++) {
      const p1 = dp[i - 1][j];
      const p2 = dp[i][j - 1];
      const p3 = str1[i] === str2[j] ? 1 + dp[i - 1][j - 1] : 0;
      dp[i][j] = Math.max(Math.max(p1, p2), p3);
    }
  }

  // ç›®æ ‡æ ¼å­
  return dp[N - 1][M - 1];
}

// è¿™æ˜¯æ ·æœ¬å¯¹åº”æ¨¡åž‹ðŸ”¥, éžå¸¸åœ¨æ„ç»“å°¾ä½ç½®, æ‰€ä»¥å®šå‡ºå°è¯•:
// è¿”å›ž: `str1[0,..,i]è¿™ä¸€æ®µ` å’Œ `str2[0,..,j]è¿™ä¸€æ®µ` ä¸¤ä¸ªå­—ç¬¦ä¸², æœ€é•¿å…¬å…±å­åºåˆ—çš„é•¿åº¦
function proc(str1, str2, i, j) {

  // ç¬¬å››æ­¥
  // base case 1
  if (i === 0 && j === 0) {
    return str1[i] === str2[j] ? 1 : 0;
  }
  // ç¬¬ä¸€æ­¥  (else æ˜¯åŽé¢è¡¥çš„)
  // ä»Žå³å¾€å·¦å°è¯•çš„ï¼Œæ‰€ä»¥ i åˆ° 0 çš„æ—¶å€™è¿”å›ž
  else if (i === 0) {
    // ç¬¬äºŒæ­¥
    // str1åªå‰©ä¸€ä¸ªå­—ç¬¦, str2[0,..,j]
    // `æ ·æœ¬æ¨¡åž‹å¯¹åº”ç»“å°¾`
    if (str1[i] === str2[j]) {
      return 1;
    }
    // ç¬¬ä¸‰æ­¥
    // æœ‰ str2[j] æ²¡ str2[j] éƒ½ä¸€æ ·, ç»§ç»­å°è¯•
    // æ­¤æ—¶iæ˜¯0ï¼Œä½†æ˜¯ j-1 å¯èƒ½è¶Šç•Œï¼Œæ‰€ä»¥è¡¥ base case 1
    return proc(str1, str2, i, j - 1);
  }
  else if (j === 0) {
    // åŒ i === 0
    if (str1[i] === str2[j]) {
      return 1;
    }
    return proc(str1, str2, i - 1, j);
  }
  else {
    // æ ·æœ¬å¯¹åº”æ¨¡åž‹å¾€å¾€è®¨`ç»“å°¾ä½ç½®ðŸ”¥`ï¼Œè¿™æ˜¯ä¸€ä¸ªç»éªŒ

    // å¯èƒ½æ€§1
    // æœ€é•¿å…¬å…±å­åºåˆ—ä¸ä»¥iç»“å°¾ï¼Œæœ‰å¯èƒ½ä»¥jç»“å°¾ï¼Œ æ¯”å¦‚"123d"å’Œ"1a23"(ä»¥jç»“å°¾)ã€"123d"å’Œ"123c"(ä¸ä»¥jç»“å°¾)
    // ä¸ºå•¥è¦å®šæˆ`å¯èƒ½ä»¥jç»“å°¾`?  å› ä¸ºå¦‚æžœå®šæˆ`ä¸€å®šä»¥jç»“å°¾`ï¼Œå°±è¦åŽ»éªŒè¯ str1[0,..,i] é‡Œæœ‰æ²¡æœ‰ str2[j] å­—ç¬¦ï¼Œè¿™ä»¶äº‹å°±å˜å¾—å¾ˆéº»çƒ¦ã€‚
    const p1 = proc(str1, str2, i - 1, j);

    // å¯èƒ½æ€§2
    // æœ€é•¿å…¬å…±å­åºåˆ—æœ‰å¯èƒ½ä»¥iç»“å°¾ï¼Œä¸ä»¥jç»“å°¾ï¼Œ æ¯”å¦‚"a123d"å’Œ"e123f"(ä¸ä»¥iç»“å°¾)ã€"a123"å’Œ"e123f"(ä»¥iç»“å°¾)
    const p2 = proc(str1, str2, i, j - 1);

    // å¯èƒ½æ€§1å’Œå¯èƒ½æ€§2æ˜¯æœ‰äº¤é›†çš„ï¼Œä½†æ˜¯ç›®æ ‡æ˜¯æœ€é•¿çš„åºåˆ—ï¼Œäº¤é›†åˆå¦‚ä½•ï¼Ÿä¸å½±å“æ‰¾åˆ°ç­”æ¡ˆã€‚
    // äº¤é›†æ˜¯: ä¸ä»¥iç»“å°¾ï¼Œä¹Ÿä¸ä»¥jç»“å°¾ï¼Œ æ¯”å¦‚"123d"å’Œ"a123e"

    // å¯èƒ½æ€§3
    // æœ€é•¿å…¬å…±å­åºåˆ—ä»¥iç»“å°¾ï¼Œä»¥jç»“å°¾ï¼Œ æ¯”å¦‚"a123d"å’Œ"e123d"
    const p3 = str1[i] === str2[j] ? (1 + proc(str1, str2, i - 1, j - 1)) : 0;

    // é€‰æœ€é•¿çš„
    return Math.max(Math.max(p1, p2), p3);
  }
}
